{"version":3,"sources":["webpack://forgerock/webpack/universalModuleDefinition","webpack://forgerock/webpack/bootstrap","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/config/constants.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/config/enums.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/config/index.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/util/timeout.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/util/url.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/util/realm.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/util/middleware.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/auth/enums.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/auth/index.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/shared/constants.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/event/index.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-policy/enums.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-policy/message-creator.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/event/helpers.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/util/strings.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-policy/helpers.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/enums.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-policy/index.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/fr-login-failure.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/attribute-input-callback.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/fr-login-success.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/index.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/choice-callback.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/confirmation-callback.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/device-profile-callback.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/hidden-value-callback.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/kba-create-callback.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/metadata-callback.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/name-callback.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/password-callback.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/polling-wait-callback.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/recaptcha-callback.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/terms-and-conditions-callback.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/text-output-callback.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/validated-create-password-callback.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/validated-create-username-callback.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/factory.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/fr-step.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/index.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-device/defaults.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-device/collector.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-device/index.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/token-storage/constants.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/token-storage/indexed-db.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/token-storage/local-storage.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/token-storage/session-storage.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/token-storage/index.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/util/http.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/util/pkce.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/oauth2-client/enums.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/oauth2-client/index.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/util/nonce.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-webauthn/enums.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/token-manager/index.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/user-manager/index.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-user/index.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-webauthn/helpers.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-webauthn/script-parser.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/fr-webauthn/index.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/http-client/util.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/http-client/index.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/session-manager/index.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/util/deferred.js","webpack://forgerock/./node_modules/@forgerock/javascript-sdk/lib-esm/util/storage.js","webpack://forgerock/./src/util/dom.ts","webpack://forgerock/./src/fr-step-handler-base.ts","webpack://forgerock/./src/util/deferred.ts","webpack://forgerock/./src/components/button.ts","webpack://forgerock/./src/basic/renderers/errors.ts","webpack://forgerock/./src/express/enums.ts","webpack://forgerock/./src/components/password-input.ts","webpack://forgerock/./src/basic/index.ts","webpack://forgerock/./src/basic/enums.ts","webpack://forgerock/./src/basic/renderers/boolean.ts","webpack://forgerock/./src/basic/renderers/choice.ts","webpack://forgerock/./src/basic/renderers/confirmation.ts","webpack://forgerock/./src/basic/renderers/generic.ts","webpack://forgerock/./src/basic/renderers/kba-create.ts","webpack://forgerock/./src/basic/renderers/password.ts","webpack://forgerock/./src/basic/renderers/polling-wait.ts","webpack://forgerock/./src/basic/renderers/recaptcha.ts","webpack://forgerock/./src/basic/renderers/terms.ts","webpack://forgerock/./src/index.ts","webpack://forgerock/./src/basic/handlers/basic.ts","webpack://forgerock/./src/basic/renderers/text.ts","webpack://forgerock/./src/basic/views/form.html","webpack://forgerock/./src/basic/handlers/webauthn.ts","webpack://forgerock/./src/basic/views/webauthn.html","webpack://forgerock/./src/express/index.ts","webpack://forgerock/./src/express/handlers/choice.ts","webpack://forgerock/./src/util/template.ts","webpack://forgerock/./src/express/views/device-registration-choice.html","webpack://forgerock/./src/express/views/passwordless-choice.html","webpack://forgerock/./src/express/views/second-factor-choice.html","webpack://forgerock/./src/express/handlers/device-authentication.ts","webpack://forgerock/./src/express/views/device-authentication.html","webpack://forgerock/./src/express/handlers/device-registration.ts","webpack://forgerock/./src/express/views/device-registration.html","webpack://forgerock/./src/express/handlers/password.ts","webpack://forgerock/./src/express/views/one-time-password-email.html","webpack://forgerock/./src/express/views/one-time-password-sms.html","webpack://forgerock/./src/express/views/user-password.html","webpack://forgerock/./src/express/handlers/registration-user-info.ts","webpack://forgerock/./src/express/views/registration.html","webpack://forgerock/./src/express/handlers/username.ts","webpack://forgerock/./src/express/views/username.html","webpack://forgerock/./src/express/handlers/username-password.ts","webpack://forgerock/./src/express/views/username-password.html","webpack://forgerock/./src/fr-ui.ts","webpack://forgerock/./src/constants.ts","webpack://forgerock/./src/enums.ts"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","ActionTypes","__assign","assign","arguments","length","apply","this","Config","set","options","isValid","Error","serverConfig","validateServerConfig","merged","baseUrl","timeout","url","charAt","withTimeout","promise","effectiveTimeout","Promise","race","_","reject","setTimeout","__spreadArrays","il","Array","k","a","j","jl","getBaseUrl","port","protocol","indexOf","hostname","getEndpointPath","endpoint","realmPath","customPaths","realmUrlPath","names","split","map","x","trim","filter","unshift","join","getRealmUrlPath","defaultPaths","authenticate","authorize","accessToken","endSession","userInfo","revoke","sessions","path","URL","startsWith","basePath","pathname","destPath","newPath","slice","stringify","data","pairs","push","encodeURIComponent","ErrorCode","CallbackType","request","type","payload","middleware","isArray","action","freeze","mwareCopy","fn","iterator","next","shift","__awaiter","thisArg","_arguments","P","generator","resolve","fulfilled","step","e","rejected","result","done","then","__generator","body","f","y","g","label","sent","trys","ops","verb","v","op","TypeError","pop","Auth","previousStep","_a","tree","query","req","res","_b","constructUrl","init","configureRequest","Authenticate","StartAuthenticate","fetch","toString","getResponseJson","treeParams","authIndexType","authIndexValue","undefined","params","queryString","keys","paths","JSON","credentials","headers","accept","method","contentType","json","status","ok","PolicyKey","Dispatcher","callbacks","addEventListener","listener","container","add","removeEventListener","index","splice","remove","clearEventListeners","forEach","clear","dispatchEvent","event","_i","plural","singularText","pluralText","getProp","obj","prop","defaultValue","StepType","CannotContainCharacters","CannotContainDuplicates","CannotContainOthers","LeastCapitalLetters","numCaps","LeastNumbers","numNums","MatchRegexp","MaximumLength","maxLength","MaximumNumber","MinimumLength","minLength","MinimumNumber","Required","Unique","UnknownPolicy","ValidArrayItems","ValidDate","ValidEmailAddress","ValidNameFormat","ValidNumber","ValidPhoneFormat","ValidQueryFilter","ValidType","FRPolicy","parseErrors","err","messageCreator","_this","errors","detail","failedPolicyRequirements","messages","parseFailedPolicyRequirement","failedPolicy","policyRequirements","policyRequirement","parsePolicyRequirement","policy","policyObject","parse","extendStatics","FRLoginFailure","LoginFailure","getCode","Number","code","getDetail","getMessage","message","getProcessedMessage","getReason","reason","FRLoginSuccess","LoginSuccess","getRealm","realm","getSessionToken","tokenId","getSuccessUrl","successUrl","FRCallback","getType","getInputValue","selector","getArrayElement","input","setInputValue","getOutputValue","output","getOutputByName","find","array","__extends","b","setPrototypeOf","__proto__","__","constructor","_super","AttributeInputCallback","getName","getPrompt","isRequired","getFailedPolicies","getPolicies","setValue","ChoiceCallback","getDefaultChoice","getChoices","setChoiceIndex","setChoiceValue","ConfirmationCallback","getDefaultOption","getMessageType","getOptions","getOptionType","setOptionIndex","setOptionValue","DeviceProfileCallback","isMetadataRequired","isLocationRequired","setProfile","profile","HiddenValueCallback","KbaCreateCallback","getPredefinedQuestions","setQuestion","question","setAnswer","answer","endsWith","MetadataCallback","getData","NameCallback","setName","PasswordCallback","setPassword","password","PollingWaitCallback","getWaitTime","ReCaptchaCallback","getSiteKey","setResult","TermsAndConditionsCallback","getTerms","getVersion","getCreateDate","date","Date","setAccepted","accepted","TextOutputCallback","ValidatedCreatePasswordCallback","ValidatedCreateUsernameCallback","callback","BooleanAttributeInputCallback","StringAttributeInputCallback","FRStep","callbackFactory","Step","convertCallbacks","getCallbackOfType","getCallbacksOfType","setCallbackValue","getDescription","description","getHeader","header","getStage","stage","FRAuth","nextPayload","authId","browserProps","configurableCategories","devicePlatforms","mac","windows","ios","displayProps","fontNames","hardwareProps","platformProps","Collector","reduceToObject","props","src","reduce","prev","curr","includes","propArr","prop1","prop2","reduceToString","filename","FRDevice","config","getBrowserMeta","navigator","console","warn","getBrowserPluginsNames","plugins","getDeviceName","userAgent","platform","test","getDisplayMeta","screen","getHardwareMeta","getIdentifier","crypto","getRandomValues","localStorage","id","getItem","Uint32Array","setItem","getInstalledFonts","canvas","document","createElement","context","getContext","text","font","baseWidth","measureText","width","getLocationCoordinates","geolocation","getCurrentPosition","position","latitude","coords","longitude","error","enableHighAccuracy","maximumAge","getOSMeta","getProfile","location","metadata","_c","identifier","hardware","display","browser","deviceName","fonts","timezone","getTimezoneOffset","DB_NAME","IndexedDBWrapper","clientId","onError","openReq","indexedDB","open","onsuccess","objectStoreNames","contains","close","getReq","transaction","objectStore","target","onerror","onupgradeneeded","tokens","onSetSuccess","onUpgradeNeeded","createObjectStore","onOpenSuccess","version","txnReq","putReq","put","removeReq","delete","LocalStorageWrapper","tokenString","removeItem","SessionStorageWrapper","sessionStorage","TokenStorage","tokenStore","getClientConfig","isOkOr4xx","response","Math","floor","ResponseType","PKCE","createVerifier","size","Uint8Array","base64UrlEncode","createChallenge","verifier","sha256","numbers","btoa","String","fromCharCode","replace","uint8Array","hashBuffer","TextEncoder","encode","subtle","digest","OAuth2Client","getAuthorizeUrl","redirectUri","scope","requestParams","challenge","client_id","redirect_uri","response_type","responseType","state","code_challenge","code_challenge_method","getUrl","Authorize","cleanUp","iframe","noop","onLoad","clearTimeout","contentWindow","newHref","href","containsAuthCode","style","appendChild","getOAuth2Tokens","responseBody","responseObject","authorizationCode","grant_type","code_verifier","getBody","parseError","access_token","idToken","id_token","refreshToken","refresh_token","getUserInfo","id_token_hint","revokeToken","token","includeToken","getActionType","ExchangeToken","Logout","RevokeToken","UserInfo","Headers","error_description","WebAuthnOutcome","WebAuthnStepType","last","repeat","now","pow","substr","TokenManager","getTokens","error_1","authorizeUrlOptions","authorizeUrl","parsedQuery","getTokensOptions","error_2","forceRenew","Code","searchParams","deleteTokens","UserManager","getCurrentUser","FRUser","login","handler","info","loginWithUI","ui","getSession","logout","ensureArray","arr","getClientDataJson","credential","clientDataJSON","TextDecoder","decode","getIndexOne","parseCredentials","idArray","matches","exec","parseNumberArray","Int8Array","buffer","parsePubKeyArray","parseRelyingPartyId","relyingPartyId","FRWebAuthn","getWebAuthnStepType","outcomeCallback","getOutcomeCallback","metadataCallback","getMetadataCallback","textOutputCallback","getTextOutputCallback","allowCredentials","Authentication","Registration","None","hiddenCallback","outcome","publicKey","meta","getCallbacks","createAuthenticationPublicKey","allowCredentialsText","match","str","idArr","idJSON","challengeArr","challengeJSON","rpId","getAuthenticationCredential","getAuthenticationOutcome","getErrorOutcome","register","createRegistrationPublicKey","txtEncoder","attestation","userVerification","rp","rpName","user","userId","userName","userDisplayName","pubKeyCredParams","authenticatorSelection","excludeCredentials","displayName","parseWebAuthnRegisterText","getRegistrationCredential","getRegistrationOutcome","returnObj","cb","PublicKeyCredential","Unsupported","assertionResponse","authenticatorData","signature","error_3","attestationResponse","attestationObject","from","atob","charCodeAt","attestationPreference","relyingPartyName","examineForRESTAuthz","clone","advices","getXMLValueFromURL","urlString","parser","DOMParser","decodedValue","decodeURIComponent","el","parseFromString","querySelector","innerHTML","isAuthzStep","normalizeRESTJSON","HttpClient","authorizationJSON","hasIG","authzOptions","authUrl","authInit","initialStep","err_2","_request","requiresNewToken","newTokenRequired","authorization","handleStep","redirected","examineForIGAuthz","AuthenticateToServiceConditionAdvice","TransactionConditionAdvice","resource","actions","attributes","ttl","normalizeIGJSON","authzObj","baseURL","treeAuthAdvices","txnAuthAdvices","attributeValue","attributeName","fullXML","buildAuthzOptions","stepIterator","updatedURL","txId","append","addAuthzInfoToURL","addAuthzInfoToHeaders","setAuthHeaders","jsonRes","handleNext","bypassAuthentication","SessionManager","LocalStorage","persist","storage","tagName","className","completeStep","render","getRefs","ready","deferred","getTemplate","findElement","required","FRStepHandlerBase","Deferred","button","enable","disabled","disable","onClick","unbind","Button","renderErrors","failedPolicies","list","item","ExpressStage","toggler","onToggle","togglerIcon","innerText","group","closest","PasswordInput","BasicStepHandler","rendererFactory","webAuthnStepType","webAuthnMode","WebAuthnMode","onChange","destroy","onInput","focus","formGroup","checked","prompt","htmlFor","errorList","BooleanAttributeCallbackRenderer","defaultIndex","option","selected","ChoiceCallbackRenderer","buttons","element","ConfirmationCallbackRenderer","formLabelGroup","placeholder","GenericCallbackRenderer","TEXT","kbaIndex","select","onQuestionChange","custom","hasQuestion","isCustomQuestion","hasAnswer","predefinedQuestions","questionText","allOptions","selectedIndex","selectWrap","createOption","customWrap","customLabel","answerWrap","answerLabel","setView","classList","KbaCreateCallbackRenderer","toggle","toggleView","formLabelGroupInput","formInputGroupAppend","toggleIcon","showPassword","PasswordCallbackRenderer","onInjected","waitTime","PollingWaitCallbackRenderer","grecaptcha","sitekey","ReCaptchaCallbackRenderer","formCheck","TermsAndConditionsCallbackRenderer","defaultMessageCreator","basicStepHandlerFactory","expressStepHandlerFactory","FRUI","callbacksThatDontRequireSubmitButton","formTarget","buttonTarget","setHeader","renderers","createRenderers","firstFocusable","requiresSubmitButton","submit","createSubmitButton","h1","createRenderer","renderer","attrCallback","choiceCallback","passwordCallback","termsCallback","setSubmitButton","some","TextOutputCallbackRenderer","messageDiv","WebAuthnStepHandler","DeviceRegistrationChoice","PasswordlessChoice","SecondFactorChoice","OneTimePasswordEmail","OneTimePasswordSMS","UserPassword","Username","UsernamePassword","DeviceAuthentication","DeviceRegistration","RegistrationUserInfo","retry","renderSecondFactorChoiceTemplate","srcElement","getAttribute","choiceIndex","getCallback","template","choices","model","updateChoiceStrings","choicesMarkup","getChoicesMarkup","subtitleMarkup","getSubtitleMarkup","replaceTokens","CHOICES","SUBTITLE","numChoices","icon","twoChoices","choice","toLowerCase","ChoiceStepHandler","RegExp","heading","invokeWebAuthn","DeviceAuthenticationStepHandler","DeviceRegistrationStepHandler","retryMessage","onSubmit","passwordInput","PasswordStepHandler","username","addAttributeInputs","formGroups","formLabel","firstChild","removeChild","elem","RegistrationUserInfoStepHandler","UsernameStepHandler","UsernamePasswordStepHandler","handlerFactory","targetId","TARGET_ID","successfulStages","nextStep","clearState","firstStepTimedOut","isFirstStep","isTimeoutError","Timeout","getNewFirstAuthId","getElementById","thisStep","FREventType","StepChange","StepError"],"mappings":"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","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"forgerock\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"forgerock\"] = factory();\n\telse\n\t\troot[\"forgerock\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 19);\n","/** @hidden */\nvar DEFAULT_TIMEOUT = 60 * 1000;\nexport { DEFAULT_TIMEOUT };\n//# sourceMappingURL=constants.js.map","export var ActionTypes;\n(function (ActionTypes) {\n    ActionTypes[\"Authenticate\"] = \"AUTHENTICATE\";\n    ActionTypes[\"Authorize\"] = \"AUTHORIZE\";\n    ActionTypes[\"Logout\"] = \"LOGOUT\";\n    ActionTypes[\"ExchangeToken\"] = \"EXCHANGE_TOKEN\";\n    ActionTypes[\"RefreshToken\"] = \"REFRESH_TOKEN\";\n    ActionTypes[\"RevokeToken\"] = \"REVOKE_TOKEN\";\n    ActionTypes[\"StartAuthenticate\"] = \"START_AUTHENTICATE\";\n    ActionTypes[\"UserInfo\"] = \"USER_INFO\";\n})(ActionTypes || (ActionTypes = {}));\n//# sourceMappingURL=enums.js.map","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { DEFAULT_TIMEOUT } from './constants';\n/**\n * Utility for merging configuration defaults with one-off options.\n *\n * Example:\n *\n * ```js\n * // Establish configuration defaults\n * Config.set({\n *   clientId: 'myApp',\n *   serverConfig: { baseUrl: 'https://openam-domain.com/am' },\n *   tree: 'UsernamePassword'\n * });\n *\n * // Specify overrides as needed\n * const configOverrides = { tree: 'PasswordlessWebAuthn' };\n * const step = await FRAuth.next(undefined, configOverrides);\n */\nvar Config = /** @class */ (function () {\n    function Config() {\n    }\n    /**\n     * Sets the default options.\n     *\n     * @param options The options to use as defaults\n     */\n    Config.set = function (options) {\n        if (!this.isValid(options)) {\n            throw new Error('Configuration is invalid');\n        }\n        if (options.serverConfig) {\n            this.validateServerConfig(options.serverConfig);\n        }\n        this.options = __assign({}, options);\n    };\n    /**\n     * Merges the provided options with the default options.  Ensures a server configuration exists.\n     *\n     * @param options The options to merge with defaults\n     */\n    Config.get = function (options) {\n        if (!this.options && !options) {\n            throw new Error('Configuration has not been set');\n        }\n        var merged = __assign(__assign({}, this.options), options);\n        if (!merged.serverConfig || !merged.serverConfig.baseUrl) {\n            throw new Error('Server configuration has not been set');\n        }\n        return merged;\n    };\n    Config.isValid = function (options) {\n        return !!(options && options.serverConfig);\n    };\n    Config.validateServerConfig = function (serverConfig) {\n        if (!serverConfig.timeout) {\n            serverConfig.timeout = DEFAULT_TIMEOUT;\n        }\n        var url = serverConfig.baseUrl;\n        if (url && url.charAt(url.length - 1) !== '/') {\n            serverConfig.baseUrl = url + '/';\n        }\n    };\n    return Config;\n}());\nexport default Config;\nexport { DEFAULT_TIMEOUT };\n//# sourceMappingURL=index.js.map","import { DEFAULT_TIMEOUT } from '../config';\n/** @hidden */\nfunction withTimeout(promise, timeout) {\n    if (timeout === void 0) { timeout = DEFAULT_TIMEOUT; }\n    var effectiveTimeout = timeout || DEFAULT_TIMEOUT;\n    return Promise.race([\n        promise,\n        new Promise(function (_, reject) {\n            return window.setTimeout(function () { return reject(new Error('Timeout')); }, effectiveTimeout);\n        }),\n    ]);\n}\nexport { withTimeout };\n//# sourceMappingURL=timeout.js.map","var __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { getRealmUrlPath } from '../util/realm';\n/**\n * Returns the base URL including protocol, hostname and any non-standard port.\n * The returned URL does not include a trailing slash.\n */\nfunction getBaseUrl(url) {\n    var isNonStandardPort = (url.protocol === 'http:' && ['', '80'].indexOf(url.port) === -1) ||\n        (url.protocol === 'https:' && ['', '443'].indexOf(url.port) === -1);\n    var port = isNonStandardPort ? \":\" + url.port : '';\n    var baseUrl = url.protocol + \"//\" + url.hostname + port;\n    return baseUrl;\n}\nfunction getEndpointPath(endpoint, realmPath, customPaths) {\n    var realmUrlPath = getRealmUrlPath(realmPath);\n    var defaultPaths = {\n        authenticate: \"json/\" + realmUrlPath + \"/authenticate\",\n        authorize: \"oauth2/\" + realmUrlPath + \"/authorize\",\n        accessToken: \"oauth2/\" + realmUrlPath + \"/access_token\",\n        endSession: \"oauth2/\" + realmUrlPath + \"/connect/endSession\",\n        userInfo: \"oauth2/\" + realmUrlPath + \"/userinfo\",\n        revoke: \"oauth2/\" + realmUrlPath + \"/token/revoke\",\n        sessions: \"json/\" + realmUrlPath + \"/sessions/\",\n    };\n    if (customPaths && customPaths[endpoint]) {\n        // TypeScript is not correctly reading the condition above\n        // It's thinking that customPaths[endpoint] may result in undefined\n        // eslint-disable-next-line @typescript-eslint/ban-ts-ignore\n        // @ts-ignore\n        return customPaths[endpoint];\n    }\n    else {\n        return defaultPaths[endpoint];\n    }\n}\nfunction resolve(baseUrl, path) {\n    var url = new URL(baseUrl);\n    if (path.startsWith('/')) {\n        return \"\" + getBaseUrl(url) + path;\n    }\n    var basePath = url.pathname.split('/');\n    var destPath = path.split('/').filter(function (x) { return !!x; });\n    var newPath = __spreadArrays(basePath.slice(0, -1), destPath).join('/');\n    return \"\" + getBaseUrl(url) + newPath;\n}\nfunction parseQuery(fullUrl) {\n    var url = new URL(fullUrl);\n    var query = {};\n    url.searchParams.forEach(function (v, k) { return (query[k] = v); });\n    return query;\n}\nfunction stringify(data) {\n    var pairs = [];\n    for (var k in data) {\n        if (data[k]) {\n            pairs.push(k + '=' + encodeURIComponent(data[k]));\n        }\n    }\n    return pairs.join('&');\n}\nexport { getBaseUrl, getEndpointPath, parseQuery, resolve, stringify };\n//# sourceMappingURL=url.js.map","/** @hidden */\nfunction getRealmUrlPath(realmPath) {\n    // Split the path and scrub segments\n    var names = (realmPath || '')\n        .split('/')\n        .map(function (x) { return x.trim(); })\n        .filter(function (x) { return x !== ''; });\n    // Ensure 'root' is the first realm\n    if (names[0] !== 'root') {\n        names.unshift('root');\n    }\n    // Concatenate into a URL path\n    var urlPath = names.map(function (x) { return \"realms/\" + x; }).join('/');\n    return urlPath;\n}\nexport { getRealmUrlPath };\n//# sourceMappingURL=realm.js.map","import Config from '../config';\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction middlewareWrapper(request, type, payload) {\n    var middleware = Config.get().middleware;\n    if (!Array.isArray(middleware)) {\n        return request;\n    }\n    // no mutation and no reassignment\n    var action = Object.freeze({ type: type, payload: payload });\n    // Copy middleware so the `shift` below doesn't mutate source\n    var mwareCopy = middleware.map(function (fn) { return fn; });\n    function iterator() {\n        var next = mwareCopy.shift();\n        next && next(request, action, iterator);\n        return request;\n    }\n    return iterator();\n}\nexport default middlewareWrapper;\n//# sourceMappingURL=middleware.js.map","/**\n * Known errors that can occur during authentication.\n */\nvar ErrorCode;\n(function (ErrorCode) {\n    ErrorCode[\"BadRequest\"] = \"BAD_REQUEST\";\n    ErrorCode[\"Timeout\"] = \"TIMEOUT\";\n    ErrorCode[\"Unauthorized\"] = \"UNAUTHORIZED\";\n    ErrorCode[\"Unknown\"] = \"UNKNOWN\";\n})(ErrorCode || (ErrorCode = {}));\n/**\n * Types of callbacks directly supported by the SDK.\n */\nvar CallbackType;\n(function (CallbackType) {\n    CallbackType[\"BooleanAttributeInputCallback\"] = \"BooleanAttributeInputCallback\";\n    CallbackType[\"ChoiceCallback\"] = \"ChoiceCallback\";\n    CallbackType[\"ConfirmationCallback\"] = \"ConfirmationCallback\";\n    CallbackType[\"DeviceProfileCallback\"] = \"DeviceProfileCallback\";\n    CallbackType[\"HiddenValueCallback\"] = \"HiddenValueCallback\";\n    CallbackType[\"KbaCreateCallback\"] = \"KbaCreateCallback\";\n    CallbackType[\"MetadataCallback\"] = \"MetadataCallback\";\n    CallbackType[\"NameCallback\"] = \"NameCallback\";\n    CallbackType[\"PasswordCallback\"] = \"PasswordCallback\";\n    CallbackType[\"PollingWaitCallback\"] = \"PollingWaitCallback\";\n    CallbackType[\"ReCaptchaCallback\"] = \"ReCaptchaCallback\";\n    CallbackType[\"StringAttributeInputCallback\"] = \"StringAttributeInputCallback\";\n    CallbackType[\"TermsAndConditionsCallback\"] = \"TermsAndConditionsCallback\";\n    CallbackType[\"TextOutputCallback\"] = \"TextOutputCallback\";\n    CallbackType[\"ValidatedCreatePasswordCallback\"] = \"ValidatedCreatePasswordCallback\";\n    CallbackType[\"ValidatedCreateUsernameCallback\"] = \"ValidatedCreateUsernameCallback\";\n})(CallbackType || (CallbackType = {}));\nexport { CallbackType, ErrorCode };\n//# sourceMappingURL=enums.js.map","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport Config from '../config';\nimport { ActionTypes } from '../config/enums';\nimport { REQUESTED_WITH } from '../shared/constants';\nimport { withTimeout } from '../util/timeout';\nimport { getEndpointPath, resolve, stringify } from '../util/url';\nimport middlewareWrapper from '../util/middleware';\n/**\n * Provides direct access to the OpenAM authentication tree API.\n */\nvar Auth = /** @class */ (function () {\n    function Auth() {\n    }\n    /**\n     * Gets the next step in the authentication tree.\n     *\n     * @param {Step} previousStep The previous step, including any required input.\n     * @param {StepOptions} options Configuration default overrides.\n     * @return {Step} The next step in the authentication tree.\n     */\n    Auth.next = function (previousStep, options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, realmPath, serverConfig, tree, type, query, url, req, res, json;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = Config.get(options), realmPath = _a.realmPath, serverConfig = _a.serverConfig, tree = _a.tree, type = _a.type;\n                        query = options ? options.query : {};\n                        url = this.constructUrl(serverConfig, realmPath, tree, query);\n                        req = middlewareWrapper({\n                            url: new URL(url),\n                            init: this.configureRequest(previousStep),\n                        }, previousStep ? ActionTypes.Authenticate : ActionTypes.StartAuthenticate, {\n                            tree: tree,\n                            type: type ? type : 'service',\n                        });\n                        return [4 /*yield*/, withTimeout(fetch(req.url.toString(), req.init), serverConfig.timeout)];\n                    case 1:\n                        res = _b.sent();\n                        return [4 /*yield*/, this.getResponseJson(res)];\n                    case 2:\n                        json = _b.sent();\n                        return [2 /*return*/, json];\n                }\n            });\n        });\n    };\n    Auth.constructUrl = function (serverConfig, realmPath, tree, query) {\n        var treeParams = tree ? { authIndexType: 'service', authIndexValue: tree } : undefined;\n        var params = __assign(__assign({}, query), treeParams);\n        var queryString = Object.keys(params).length > 0 ? \"?\" + stringify(params) : '';\n        var path = getEndpointPath('authenticate', realmPath, serverConfig.paths);\n        var url = resolve(serverConfig.baseUrl, \"\" + path + queryString);\n        return url;\n    };\n    Auth.configureRequest = function (step) {\n        var init = {\n            body: step ? JSON.stringify(step) : undefined,\n            credentials: 'include',\n            headers: {\n                accept: 'application/json',\n                'accept-api-version': 'protocol=1.0,resource=2.1',\n                'content-type': 'application/json',\n                'x-requested-with': REQUESTED_WITH,\n            },\n            method: 'POST',\n        };\n        return init;\n    };\n    Auth.getResponseJson = function (res) {\n        return __awaiter(this, void 0, void 0, function () {\n            var contentType, isJson, json, _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        contentType = res.headers.get('content-type');\n                        isJson = contentType && contentType.indexOf('application/json') > -1;\n                        if (!isJson) return [3 /*break*/, 2];\n                        return [4 /*yield*/, res.json()];\n                    case 1:\n                        _a = _b.sent();\n                        return [3 /*break*/, 3];\n                    case 2:\n                        _a = {};\n                        _b.label = 3;\n                    case 3:\n                        json = _a;\n                        json.status = res.status;\n                        json.ok = res.ok;\n                        return [2 /*return*/, json];\n                }\n            });\n        });\n    };\n    return Auth;\n}());\nexport default Auth;\n//# sourceMappingURL=index.js.map","/** @hidden */\nvar REQUESTED_WITH = 'forgerock-sdk';\nexport { REQUESTED_WITH };\n//# sourceMappingURL=constants.js.map","import { add, clear, remove } from './helpers';\n/**\n * Event dispatcher for subscribing and publishing categorized events.\n */\nvar Dispatcher = /** @class */ (function () {\n    function Dispatcher() {\n        this.callbacks = {};\n    }\n    /**\n     * Subscribes to an event type.\n     *\n     * @param type The event type\n     * @param listener The function to subscribe to events of this type\n     */\n    Dispatcher.prototype.addEventListener = function (type, listener) {\n        add(this.callbacks, type, listener);\n    };\n    /**\n     * Unsubscribes from an event type.\n     *\n     * @param type The event type\n     * @param listener The function to unsubscribe from events of this type\n     */\n    Dispatcher.prototype.removeEventListener = function (type, listener) {\n        remove(this.callbacks, type, listener);\n    };\n    /**\n     * Unsubscribes all listener functions to a single event type or all event types.\n     *\n     * @param type The event type, or all event types if not specified\n     */\n    Dispatcher.prototype.clearEventListeners = function (type) {\n        clear(this.callbacks, type);\n    };\n    /**\n     * Publishes an event.\n     *\n     * @param event The event object to publish\n     */\n    Dispatcher.prototype.dispatchEvent = function (event) {\n        if (!this.callbacks[event.type]) {\n            return;\n        }\n        for (var _i = 0, _a = this.callbacks[event.type]; _i < _a.length; _i++) {\n            var listener = _a[_i];\n            listener(event);\n        }\n    };\n    return Dispatcher;\n}());\nexport default Dispatcher;\n//# sourceMappingURL=index.js.map","var PolicyKey;\n(function (PolicyKey) {\n    PolicyKey[\"CannotContainCharacters\"] = \"CANNOT_CONTAIN_CHARACTERS\";\n    PolicyKey[\"CannotContainDuplicates\"] = \"CANNOT_CONTAIN_DUPLICATES\";\n    PolicyKey[\"CannotContainOthers\"] = \"CANNOT_CONTAIN_OTHERS\";\n    PolicyKey[\"LeastCapitalLetters\"] = \"AT_LEAST_X_CAPITAL_LETTERS\";\n    PolicyKey[\"LeastNumbers\"] = \"AT_LEAST_X_NUMBERS\";\n    PolicyKey[\"MatchRegexp\"] = \"MATCH_REGEXP\";\n    PolicyKey[\"MaximumLength\"] = \"MAX_LENGTH\";\n    PolicyKey[\"MaximumNumber\"] = \"MAXIMUM_NUMBER_VALUE\";\n    PolicyKey[\"MinimumLength\"] = \"MIN_LENGTH\";\n    PolicyKey[\"MinimumNumber\"] = \"MINIMUM_NUMBER_VALUE\";\n    PolicyKey[\"Required\"] = \"REQUIRED\";\n    PolicyKey[\"Unique\"] = \"UNIQUE\";\n    PolicyKey[\"UnknownPolicy\"] = \"UNKNOWN_POLICY\";\n    PolicyKey[\"ValidArrayItems\"] = \"VALID_ARRAY_ITEMS\";\n    PolicyKey[\"ValidDate\"] = \"VALID_DATE\";\n    PolicyKey[\"ValidEmailAddress\"] = \"VALID_EMAIL_ADDRESS_FORMAT\";\n    PolicyKey[\"ValidNameFormat\"] = \"VALID_NAME_FORMAT\";\n    PolicyKey[\"ValidNumber\"] = \"VALID_NUMBER\";\n    PolicyKey[\"ValidPhoneFormat\"] = \"VALID_PHONE_FORMAT\";\n    PolicyKey[\"ValidQueryFilter\"] = \"VALID_QUERY_FILTER\";\n    PolicyKey[\"ValidType\"] = \"VALID_TYPE\";\n})(PolicyKey || (PolicyKey = {}));\nexport { PolicyKey };\n//# sourceMappingURL=enums.js.map","var _a;\nimport { plural } from '../util/strings';\nimport { PolicyKey } from './enums';\nimport { getProp } from './helpers';\nvar defaultMessageCreator = (_a = {},\n    _a[PolicyKey.CannotContainCharacters] = function (property, params) {\n        var forbiddenChars = getProp(params, 'forbiddenChars', '');\n        return property + \" must not contain following characters: \\\"\" + forbiddenChars + \"\\\"\";\n    },\n    _a[PolicyKey.CannotContainDuplicates] = function (property, params) {\n        var duplicateValue = getProp(params, 'duplicateValue', '');\n        return property + \"  must not contain duplicates: \\\"\" + duplicateValue + \"\\\"\";\n    },\n    _a[PolicyKey.CannotContainOthers] = function (property, params) {\n        var disallowedFields = getProp(params, 'disallowedFields', '');\n        return property + \" must not contain: \\\"\" + disallowedFields + \"\\\"\";\n    },\n    _a[PolicyKey.LeastCapitalLetters] = function (property, params) {\n        var numCaps = getProp(params, 'numCaps', 0);\n        return property + \" must contain at least \" + numCaps + \" capital \" + plural(numCaps, 'letter');\n    },\n    _a[PolicyKey.LeastNumbers] = function (property, params) {\n        var numNums = getProp(params, 'numNums', 0);\n        return property + \" must contain at least \" + numNums + \" numeric \" + plural(numNums, 'value');\n    },\n    _a[PolicyKey.MatchRegexp] = function (property) { return property + \" has failed the \\\"MATCH_REGEXP\\\" policy\"; },\n    _a[PolicyKey.MaximumLength] = function (property, params) {\n        var maxLength = getProp(params, 'maxLength', 0);\n        return property + \" must be at most \" + maxLength + \" \" + plural(maxLength, 'character');\n    },\n    _a[PolicyKey.MaximumNumber] = function (property) {\n        return property + \" has failed the \\\"MAXIMUM_NUMBER_VALUE\\\" policy\";\n    },\n    _a[PolicyKey.MinimumLength] = function (property, params) {\n        var minLength = getProp(params, 'minLength', 0);\n        return property + \" must be at least \" + minLength + \" \" + plural(minLength, 'character');\n    },\n    _a[PolicyKey.MinimumNumber] = function (property) {\n        return property + \" has failed the \\\"MINIMUM_NUMBER_VALUE\\\" policy\";\n    },\n    _a[PolicyKey.Required] = function (property) { return property + \" is required\"; },\n    _a[PolicyKey.Unique] = function (property) { return property + \" must be unique\"; },\n    _a[PolicyKey.UnknownPolicy] = function (property, params) {\n        var policyRequirement = getProp(params, 'policyRequirement', 'Unknown');\n        return property + \": Unknown policy requirement \\\"\" + policyRequirement + \"\\\"\";\n    },\n    _a[PolicyKey.ValidArrayItems] = function (property) {\n        return property + \" has failed the \\\"VALID_ARRAY_ITEMS\\\" policy\";\n    },\n    _a[PolicyKey.ValidDate] = function (property) { return property + \" has an invalid date\"; },\n    _a[PolicyKey.ValidEmailAddress] = function (property) { return property + \" has an invalid email address\"; },\n    _a[PolicyKey.ValidNameFormat] = function (property) { return property + \" has an invalid name format\"; },\n    _a[PolicyKey.ValidNumber] = function (property) { return property + \" has an invalid number\"; },\n    _a[PolicyKey.ValidPhoneFormat] = function (property) { return property + \" has an invalid phone number\"; },\n    _a[PolicyKey.ValidQueryFilter] = function (property) {\n        return property + \" has failed the \\\"VALID_QUERY_FILTER\\\" policy\";\n    },\n    _a[PolicyKey.ValidType] = function (property) { return property + \" has failed the \\\"VALID_TYPE\\\" policy\"; },\n    _a);\nexport default defaultMessageCreator;\n//# sourceMappingURL=message-creator.js.map","/** @hidden */\nfunction add(container, type, listener) {\n    container[type] = container[type] || [];\n    if (container[type].indexOf(listener) < 0) {\n        container[type].push(listener);\n    }\n}\n/** @hidden */\nfunction remove(container, type, listener) {\n    if (!container[type]) {\n        return;\n    }\n    var index = container[type].indexOf(listener);\n    if (index >= 0) {\n        container[type].splice(index, 1);\n    }\n}\n/** @hidden */\nfunction clear(container, type) {\n    Object.keys(container).forEach(function (k) {\n        if (!type || k === type) {\n            delete container[k];\n        }\n    });\n}\nexport { add, clear, remove };\n//# sourceMappingURL=helpers.js.map","/** @hidden */\nexport function plural(n, singularText, pluralText) {\n    if (n === 1) {\n        return singularText;\n    }\n    return pluralText !== undefined ? pluralText : singularText + 's';\n}\n//# sourceMappingURL=strings.js.map","function getProp(obj, prop, defaultValue) {\n    if (!obj || obj[prop] === undefined) {\n        return defaultValue;\n    }\n    return obj[prop];\n}\nexport { getProp };\n//# sourceMappingURL=helpers.js.map","/**\n * Types of steps returned by the authentication tree.\n */\nvar StepType;\n(function (StepType) {\n    StepType[\"LoginFailure\"] = \"LoginFailure\";\n    StepType[\"LoginSuccess\"] = \"LoginSuccess\";\n    StepType[\"Step\"] = \"Step\";\n})(StepType || (StepType = {}));\nexport { StepType };\n//# sourceMappingURL=enums.js.map","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { PolicyKey } from './enums';\nimport defaultMessageCreator from './message-creator';\n/**\n * Utility for processing policy failures into human readable messages.\n *\n * Example:\n *\n * ```js\n * // Create message overrides and extensions as needed\n * const messageCreator = {\n *   [PolicyKey.unique]: (property: string) => (\n *     `this is a custom message for \"UNIQUE\" policy of ${property}`\n *   ),\n *   CUSTOM_POLICY: (property: string, params: any) => (\n *     `this is a custom message for \"${params.policyRequirement}\" policy of ${property}`\n *   ),\n * };\n *\n * const thisStep = await FRAuth.next(previousStep);\n *\n * if (thisStep.type === StepType.LoginFailure) {\n *   const messagesStepMethod = thisStep.getProcessedMessage(messageCreator);\n *   const messagesClassMethod = FRPolicy.parseErrors(thisStep, messageCreator)\n * }\n */\nvar FRPolicy = /** @class */ (function () {\n    function FRPolicy() {\n    }\n    /**\n     * Parses policy errors and generates human readable error messages.\n     *\n     * @param {Step} err The step containing the error.\n     * @param {MessageCreator} messageCreator\n     * Extensible and overridable custom error messages for policy failures.\n     * @return {ProcessedPropertyError[]} Array of objects containing all processed policy errors.\n     */\n    FRPolicy.parseErrors = function (err, messageCreator) {\n        var _this = this;\n        var errors = [];\n        if (err.detail && err.detail.failedPolicyRequirements) {\n            err.detail.failedPolicyRequirements.map(function (x) {\n                errors.push.apply(errors, [\n                    {\n                        detail: x,\n                        messages: _this.parseFailedPolicyRequirement(x, messageCreator),\n                    },\n                ]);\n            });\n        }\n        return errors;\n    };\n    /**\n     * Parses a failed policy and returns a string array of error messages.\n     *\n     * @param {FailedPolicyRequirement} failedPolicy The detail data of the failed policy.\n     * @param {MessageCreator} customMessage\n     * Extensible and overridable custom error messages for policy failures.\n     * @return {string[]} Array of strings with all processed policy errors.\n     */\n    FRPolicy.parseFailedPolicyRequirement = function (failedPolicy, messageCreator) {\n        var _this = this;\n        var errors = [];\n        failedPolicy.policyRequirements.map(function (policyRequirement) {\n            errors.push(_this.parsePolicyRequirement(failedPolicy.property, policyRequirement, messageCreator));\n        });\n        return errors;\n    };\n    /**\n     * Parses a policy error into a human readable error message.\n     *\n     * @param {string} property The property with the policy failure.\n     * @param {PolicyRequirement} policy The policy failure data.\n     * @param {MessageCreator} customMessage\n     * Extensible and overridable custom error messages for policy failures.\n     * @return {string} Human readable error message.\n     */\n    FRPolicy.parsePolicyRequirement = function (property, policy, messageCreator) {\n        if (messageCreator === void 0) { messageCreator = {}; }\n        // AM is returning policy requirement failures as JSON strings\n        var policyObject = typeof policy === 'string' ? JSON.parse(policy) : __assign({}, policy);\n        var policyRequirement = policyObject.policyRequirement;\n        // Determine which message creator function to use\n        var effectiveMessageCreator = messageCreator[policyRequirement] ||\n            defaultMessageCreator[policyRequirement] ||\n            defaultMessageCreator[PolicyKey.UnknownPolicy];\n        // Flatten the parameters and create the message\n        var params = policyObject.params\n            ? __assign(__assign({}, policyObject.params), { policyRequirement: policyRequirement }) : { policyRequirement: policyRequirement };\n        var message = effectiveMessageCreator(property, params);\n        return message;\n    };\n    return FRPolicy;\n}());\nexport default FRPolicy;\nexport { PolicyKey };\n//# sourceMappingURL=index.js.map","import FRPolicy from '../fr-policy';\nimport { StepType } from './enums';\nvar FRLoginFailure = /** @class */ (function () {\n    /**\n     * @param payload The raw payload returned by OpenAM\n     */\n    function FRLoginFailure(payload) {\n        this.payload = payload;\n        /**\n         * The type of step.\n         */\n        this.type = StepType.LoginFailure;\n    }\n    /**\n     * Gets the error code.\n     */\n    FRLoginFailure.prototype.getCode = function () {\n        return Number(this.payload.code);\n    };\n    /**\n     * Gets the failure details.\n     */\n    FRLoginFailure.prototype.getDetail = function () {\n        return this.payload.detail;\n    };\n    /**\n     * Gets the failure message.\n     */\n    FRLoginFailure.prototype.getMessage = function () {\n        return this.payload.message;\n    };\n    /**\n     * Gets processed failure message.\n     */\n    FRLoginFailure.prototype.getProcessedMessage = function (messageCreator) {\n        return FRPolicy.parseErrors(this.payload, messageCreator);\n    };\n    /**\n     * Gets the failure reason.\n     */\n    FRLoginFailure.prototype.getReason = function () {\n        return this.payload.reason;\n    };\n    return FRLoginFailure;\n}());\nexport default FRLoginFailure;\n//# sourceMappingURL=fr-login-failure.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport FRCallback from '.';\n/**\n * Represents a callback used to collect attributes.\n *\n * @typeparam T Maps to StringAttributeInputCallback and BooleanAttributeInputCallback, respectively\n */\nvar AttributeInputCallback = /** @class */ (function (_super) {\n    __extends(AttributeInputCallback, _super);\n    /**\n     * @param payload The raw payload returned by OpenAM\n     */\n    function AttributeInputCallback(payload) {\n        var _this = _super.call(this, payload) || this;\n        _this.payload = payload;\n        return _this;\n    }\n    /**\n     * Gets the attribute name.\n     */\n    AttributeInputCallback.prototype.getName = function () {\n        return this.getOutputByName('name', '');\n    };\n    /**\n     * Gets the attribute prompt.\n     */\n    AttributeInputCallback.prototype.getPrompt = function () {\n        return this.getOutputByName('prompt', '');\n    };\n    /**\n     * Gets whether the attribute is required.\n     */\n    AttributeInputCallback.prototype.isRequired = function () {\n        return this.getOutputByName('required', false);\n    };\n    /**\n     * Gets the callback's failed policies.\n     */\n    AttributeInputCallback.prototype.getFailedPolicies = function () {\n        return this.getOutputByName('failedPolicies', []);\n    };\n    /**\n     * Gets the callback's applicable policies.\n     */\n    AttributeInputCallback.prototype.getPolicies = function () {\n        return this.getOutputByName('policies', []);\n    };\n    /**\n     * Sets the attribute's value.\n     */\n    AttributeInputCallback.prototype.setValue = function (value) {\n        this.setInputValue(value);\n    };\n    return AttributeInputCallback;\n}(FRCallback));\nexport default AttributeInputCallback;\n//# sourceMappingURL=attribute-input-callback.js.map","import { StepType } from './enums';\nvar FRLoginSuccess = /** @class */ (function () {\n    /**\n     * @param payload The raw payload returned by OpenAM\n     */\n    function FRLoginSuccess(payload) {\n        this.payload = payload;\n        /**\n         * The type of step.\n         */\n        this.type = StepType.LoginSuccess;\n    }\n    /**\n     * Gets the step's realm.\n     */\n    FRLoginSuccess.prototype.getRealm = function () {\n        return this.payload.realm;\n    };\n    /**\n     * Gets the step's session token.\n     */\n    FRLoginSuccess.prototype.getSessionToken = function () {\n        return this.payload.tokenId;\n    };\n    /**\n     * Gets the step's success URL.\n     */\n    FRLoginSuccess.prototype.getSuccessUrl = function () {\n        return this.payload.successUrl;\n    };\n    return FRLoginSuccess;\n}());\nexport default FRLoginSuccess;\n//# sourceMappingURL=fr-login-success.js.map","/**\n * Base class for authentication tree callback wrappers.\n */\nvar FRCallback = /** @class */ (function () {\n    /**\n     * @param payload The raw payload returned by OpenAM\n     */\n    function FRCallback(payload) {\n        this.payload = payload;\n    }\n    /**\n     * Gets the name of this callback type.\n     */\n    FRCallback.prototype.getType = function () {\n        return this.payload.type;\n    };\n    /**\n     * Gets the value of the specified input element, or the first element if `selector` is not\n     * provided.\n     *\n     * @param selector The index position or name of the desired element\n     */\n    FRCallback.prototype.getInputValue = function (selector) {\n        if (selector === void 0) { selector = 0; }\n        return this.getArrayElement(this.payload.input, selector).value;\n    };\n    /**\n     * Sets the value of the specified input element, or the first element if `selector` is not\n     * provided.\n     *\n     * @param selector The index position or name of the desired element\n     */\n    FRCallback.prototype.setInputValue = function (value, selector) {\n        if (selector === void 0) { selector = 0; }\n        this.getArrayElement(this.payload.input, selector).value = value;\n    };\n    /**\n     * Gets the value of the specified output element, or the first element if `selector`\n     * is not provided.\n     *\n     * @param selector The index position or name of the desired element\n     */\n    FRCallback.prototype.getOutputValue = function (selector) {\n        if (selector === void 0) { selector = 0; }\n        return this.getArrayElement(this.payload.output, selector).value;\n    };\n    /**\n     * Gets the value of the first output element with the specified name or the\n     * specified default value.\n     *\n     * @param name The name of the desired element\n     */\n    FRCallback.prototype.getOutputByName = function (name, defaultValue) {\n        var output = this.payload.output.find(function (x) { return x.name === name; });\n        return output ? output.value : defaultValue;\n    };\n    FRCallback.prototype.getArrayElement = function (array, selector) {\n        if (selector === void 0) { selector = 0; }\n        if (array === undefined) {\n            throw new Error(\"No NameValue array was provided to search (selector \" + selector + \")\");\n        }\n        if (typeof selector === 'number') {\n            if (selector < 0 || selector > array.length - 1) {\n                throw new Error(\"Selector index \" + selector + \" is out of range\");\n            }\n            return array[selector];\n        }\n        if (typeof selector === 'string') {\n            var input = array.find(function (x) { return x.name === selector; });\n            if (!input) {\n                throw new Error(\"Missing callback input entry \\\"\" + selector + \"\\\"\");\n            }\n            return input;\n        }\n        throw new Error('Invalid selector value type');\n    };\n    return FRCallback;\n}());\nexport default FRCallback;\n//# sourceMappingURL=index.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport FRCallback from '.';\n/**\n * Represents a callback used to collect an answer to a choice.\n */\nvar ChoiceCallback = /** @class */ (function (_super) {\n    __extends(ChoiceCallback, _super);\n    /**\n     * @param payload The raw payload returned by OpenAM\n     */\n    function ChoiceCallback(payload) {\n        var _this = _super.call(this, payload) || this;\n        _this.payload = payload;\n        return _this;\n    }\n    /**\n     * Gets the choice's prompt.\n     */\n    ChoiceCallback.prototype.getPrompt = function () {\n        return this.getOutputByName('prompt', '');\n    };\n    /**\n     * Gets the choice's default answer.\n     */\n    ChoiceCallback.prototype.getDefaultChoice = function () {\n        return this.getOutputByName('defaultChoice', 0);\n    };\n    /**\n     * Gets the choice's possible answers.\n     */\n    ChoiceCallback.prototype.getChoices = function () {\n        return this.getOutputByName('choices', []);\n    };\n    /**\n     * Sets the choice's answer by index position.\n     */\n    ChoiceCallback.prototype.setChoiceIndex = function (index) {\n        var length = this.getChoices().length;\n        if (index < 0 || index > length - 1) {\n            throw new Error(index + \" is out of bounds\");\n        }\n        this.setInputValue(index);\n    };\n    /**\n     * Sets the choice's answer by value.\n     */\n    ChoiceCallback.prototype.setChoiceValue = function (value) {\n        var index = this.getChoices().indexOf(value);\n        if (index === -1) {\n            throw new Error(\"\\\"\" + value + \"\\\" is not a valid choice\");\n        }\n        this.setInputValue(index);\n    };\n    return ChoiceCallback;\n}(FRCallback));\nexport default ChoiceCallback;\n//# sourceMappingURL=choice-callback.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport FRCallback from '.';\n/**\n * Represents a callback used to collect a confirmation to a message.\n */\nvar ConfirmationCallback = /** @class */ (function (_super) {\n    __extends(ConfirmationCallback, _super);\n    /**\n     * @param payload The raw payload returned by OpenAM\n     */\n    function ConfirmationCallback(payload) {\n        var _this = _super.call(this, payload) || this;\n        _this.payload = payload;\n        return _this;\n    }\n    /**\n     * Gets the index position of the confirmation's default answer.\n     */\n    ConfirmationCallback.prototype.getDefaultOption = function () {\n        return Number(this.getOutputByName('defaultOption', 0));\n    };\n    /**\n     * Gets the confirmation's message type.\n     */\n    ConfirmationCallback.prototype.getMessageType = function () {\n        return Number(this.getOutputByName('messageType', 0));\n    };\n    /**\n     * Gets the confirmation's possible answers.\n     */\n    ConfirmationCallback.prototype.getOptions = function () {\n        return this.getOutputByName('options', []);\n    };\n    /**\n     * Gets the confirmation's option type.\n     */\n    ConfirmationCallback.prototype.getOptionType = function () {\n        return Number(this.getOutputByName('optionType', 0));\n    };\n    /**\n     * Gets the confirmation's prompt.\n     */\n    ConfirmationCallback.prototype.getPrompt = function () {\n        return this.getOutputByName('prompt', '');\n    };\n    /**\n     * Set option index.\n     */\n    ConfirmationCallback.prototype.setOptionIndex = function (index) {\n        if (index !== 0 && index !== 1) {\n            throw new Error(\"\\\"\" + index + \"\\\" is not a valid choice\");\n        }\n        this.setInputValue(index);\n    };\n    /**\n     * Set option value.\n     */\n    ConfirmationCallback.prototype.setOptionValue = function (value) {\n        var index = this.getOptions().indexOf(value);\n        if (index === -1) {\n            throw new Error(\"\\\"\" + value + \"\\\" is not a valid choice\");\n        }\n        this.setInputValue(index);\n    };\n    return ConfirmationCallback;\n}(FRCallback));\nexport default ConfirmationCallback;\n//# sourceMappingURL=confirmation-callback.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport FRCallback from '.';\n/**\n * Represents a callback used to collect device profile data.\n */\nvar DeviceProfileCallback = /** @class */ (function (_super) {\n    __extends(DeviceProfileCallback, _super);\n    /**\n     * @param payload The raw payload returned by OpenAM\n     */\n    function DeviceProfileCallback(payload) {\n        var _this = _super.call(this, payload) || this;\n        _this.payload = payload;\n        return _this;\n    }\n    /**\n     * Gets the callback's data.\n     */\n    DeviceProfileCallback.prototype.getMessage = function () {\n        return this.getOutputByName('message', '');\n    };\n    /**\n     * Does callback require metadata?\n     */\n    DeviceProfileCallback.prototype.isMetadataRequired = function () {\n        return this.getOutputByName('metadata', false);\n    };\n    /**\n     * Does callback require location data?\n     */\n    DeviceProfileCallback.prototype.isLocationRequired = function () {\n        return this.getOutputByName('location', false);\n    };\n    /**\n     * Sets the profile.\n     */\n    DeviceProfileCallback.prototype.setProfile = function (profile) {\n        this.setInputValue(JSON.stringify(profile));\n    };\n    return DeviceProfileCallback;\n}(FRCallback));\nexport default DeviceProfileCallback;\n//# sourceMappingURL=device-profile-callback.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport FRCallback from '.';\n/**\n * Represents a callback used to collect information indirectly from the user.\n */\nvar HiddenValueCallback = /** @class */ (function (_super) {\n    __extends(HiddenValueCallback, _super);\n    /**\n     * @param payload The raw payload returned by OpenAM\n     */\n    function HiddenValueCallback(payload) {\n        var _this = _super.call(this, payload) || this;\n        _this.payload = payload;\n        return _this;\n    }\n    return HiddenValueCallback;\n}(FRCallback));\nexport default HiddenValueCallback;\n//# sourceMappingURL=hidden-value-callback.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport FRCallback from '.';\n/**\n * Represents a callback used to collect KBA-style security questions and answers.\n */\nvar KbaCreateCallback = /** @class */ (function (_super) {\n    __extends(KbaCreateCallback, _super);\n    /**\n     * @param payload The raw payload returned by OpenAM\n     */\n    function KbaCreateCallback(payload) {\n        var _this = _super.call(this, payload) || this;\n        _this.payload = payload;\n        return _this;\n    }\n    /**\n     * Gets the callback prompt.\n     */\n    KbaCreateCallback.prototype.getPrompt = function () {\n        return this.getOutputByName('prompt', '');\n    };\n    /**\n     * Gets the callback's list of pre-defined security questions.\n     */\n    KbaCreateCallback.prototype.getPredefinedQuestions = function () {\n        return this.getOutputByName('predefinedQuestions', []);\n    };\n    /**\n     * Sets the callback's security question.\n     */\n    KbaCreateCallback.prototype.setQuestion = function (question) {\n        this.setValue('question', question);\n    };\n    /**\n     * Sets the callback's security question answer.\n     */\n    KbaCreateCallback.prototype.setAnswer = function (answer) {\n        this.setValue('answer', answer);\n    };\n    KbaCreateCallback.prototype.setValue = function (type, value) {\n        if (!this.payload.input) {\n            throw new Error('KBA payload is missing input');\n        }\n        var input = this.payload.input.find(function (x) { return x.name.endsWith(type); });\n        if (!input) {\n            throw new Error(\"No input has name ending in \\\"\" + type + \"\\\"\");\n        }\n        input.value = value;\n    };\n    return KbaCreateCallback;\n}(FRCallback));\nexport default KbaCreateCallback;\n//# sourceMappingURL=kba-create-callback.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport FRCallback from '.';\n/**\n * Represents a callback used to deliver and collect miscellaneous data.\n */\nvar MetadataCallback = /** @class */ (function (_super) {\n    __extends(MetadataCallback, _super);\n    /**\n     * @param payload The raw payload returned by OpenAM\n     */\n    function MetadataCallback(payload) {\n        var _this = _super.call(this, payload) || this;\n        _this.payload = payload;\n        return _this;\n    }\n    /**\n     * Gets the callback's data.\n     */\n    MetadataCallback.prototype.getData = function () {\n        return this.getOutputByName('data', {});\n    };\n    return MetadataCallback;\n}(FRCallback));\nexport default MetadataCallback;\n//# sourceMappingURL=metadata-callback.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport FRCallback from '.';\n/**\n * Represents a callback used to collect a username.\n */\nvar NameCallback = /** @class */ (function (_super) {\n    __extends(NameCallback, _super);\n    /**\n     * @param payload The raw payload returned by OpenAM\n     */\n    function NameCallback(payload) {\n        var _this = _super.call(this, payload) || this;\n        _this.payload = payload;\n        return _this;\n    }\n    /**\n     * Gets the callback's prompt.\n     */\n    NameCallback.prototype.getPrompt = function () {\n        return this.getOutputByName('prompt', '');\n    };\n    /**\n     * Sets the username.\n     */\n    NameCallback.prototype.setName = function (name) {\n        this.setInputValue(name);\n    };\n    return NameCallback;\n}(FRCallback));\nexport default NameCallback;\n//# sourceMappingURL=name-callback.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport FRCallback from '.';\n/**\n * Represents a callback used to collect a password.\n */\nvar PasswordCallback = /** @class */ (function (_super) {\n    __extends(PasswordCallback, _super);\n    /**\n     * @param payload The raw payload returned by OpenAM\n     */\n    function PasswordCallback(payload) {\n        var _this = _super.call(this, payload) || this;\n        _this.payload = payload;\n        return _this;\n    }\n    /**\n     * Gets the callback's failed policies.\n     */\n    PasswordCallback.prototype.getFailedPolicies = function () {\n        return this.getOutputByName('failedPolicies', []);\n    };\n    /**\n     * Gets the callback's applicable policies.\n     */\n    PasswordCallback.prototype.getPolicies = function () {\n        return this.getOutputByName('policies', []);\n    };\n    /**\n     * Gets the callback's prompt.\n     */\n    PasswordCallback.prototype.getPrompt = function () {\n        return this.getOutputByName('prompt', '');\n    };\n    /**\n     * Sets the password.\n     */\n    PasswordCallback.prototype.setPassword = function (password) {\n        this.setInputValue(password);\n    };\n    return PasswordCallback;\n}(FRCallback));\nexport default PasswordCallback;\n//# sourceMappingURL=password-callback.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport FRCallback from '.';\n/**\n * Represents a callback used to instruct the system to poll while a backend process completes.\n */\nvar PollingWaitCallback = /** @class */ (function (_super) {\n    __extends(PollingWaitCallback, _super);\n    /**\n     * @param payload The raw payload returned by OpenAM\n     */\n    function PollingWaitCallback(payload) {\n        var _this = _super.call(this, payload) || this;\n        _this.payload = payload;\n        return _this;\n    }\n    /**\n     * Gets the message to display while polling.\n     */\n    PollingWaitCallback.prototype.getMessage = function () {\n        return this.getOutputByName('message', '');\n    };\n    /**\n     * Gets the polling interval in seconds.\n     */\n    PollingWaitCallback.prototype.getWaitTime = function () {\n        return Number(this.getOutputByName('waitTime', 0));\n    };\n    return PollingWaitCallback;\n}(FRCallback));\nexport default PollingWaitCallback;\n//# sourceMappingURL=polling-wait-callback.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport FRCallback from '.';\n/**\n * Represents a callback used to integrate reCAPTCHA.\n */\nvar ReCaptchaCallback = /** @class */ (function (_super) {\n    __extends(ReCaptchaCallback, _super);\n    /**\n     * @param payload The raw payload returned by OpenAM\n     */\n    function ReCaptchaCallback(payload) {\n        var _this = _super.call(this, payload) || this;\n        _this.payload = payload;\n        return _this;\n    }\n    /**\n     * Gets the reCAPTCHA site key.\n     */\n    ReCaptchaCallback.prototype.getSiteKey = function () {\n        return this.getOutputByName('recaptchaSiteKey', '');\n    };\n    /**\n     * Sets the reCAPTCHA result.\n     */\n    ReCaptchaCallback.prototype.setResult = function (result) {\n        this.setInputValue(result);\n    };\n    return ReCaptchaCallback;\n}(FRCallback));\nexport default ReCaptchaCallback;\n//# sourceMappingURL=recaptcha-callback.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport FRCallback from '.';\n/**\n * Represents a callback used to collect acceptance of terms and conditions.\n */\nvar TermsAndConditionsCallback = /** @class */ (function (_super) {\n    __extends(TermsAndConditionsCallback, _super);\n    /**\n     * @param payload The raw payload returned by OpenAM\n     */\n    function TermsAndConditionsCallback(payload) {\n        var _this = _super.call(this, payload) || this;\n        _this.payload = payload;\n        return _this;\n    }\n    /**\n     * Gets the terms and conditions content.\n     */\n    TermsAndConditionsCallback.prototype.getTerms = function () {\n        return this.getOutputByName('terms', '');\n    };\n    /**\n     * Gets the version of the terms and conditions.\n     */\n    TermsAndConditionsCallback.prototype.getVersion = function () {\n        return this.getOutputByName('version', '');\n    };\n    /**\n     * Gets the date of the terms and conditions.\n     */\n    TermsAndConditionsCallback.prototype.getCreateDate = function () {\n        var date = this.getOutputByName('createDate', '');\n        return new Date(date);\n    };\n    /**\n     * Sets the callback's acceptance.\n     */\n    TermsAndConditionsCallback.prototype.setAccepted = function (accepted) {\n        if (accepted === void 0) { accepted = true; }\n        this.setInputValue(accepted);\n    };\n    return TermsAndConditionsCallback;\n}(FRCallback));\nexport default TermsAndConditionsCallback;\n//# sourceMappingURL=terms-and-conditions-callback.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport FRCallback from '.';\n/**\n * Represents a callback used to display a message.\n */\nvar TextOutputCallback = /** @class */ (function (_super) {\n    __extends(TextOutputCallback, _super);\n    /**\n     * @param payload The raw payload returned by OpenAM\n     */\n    function TextOutputCallback(payload) {\n        var _this = _super.call(this, payload) || this;\n        _this.payload = payload;\n        return _this;\n    }\n    /**\n     * Gets the message content.\n     */\n    TextOutputCallback.prototype.getMessage = function () {\n        return this.getOutputByName('message', '');\n    };\n    /**\n     * Gets the message type.\n     */\n    TextOutputCallback.prototype.getMessageType = function () {\n        return this.getOutputByName('messageType', '');\n    };\n    return TextOutputCallback;\n}(FRCallback));\nexport default TextOutputCallback;\n//# sourceMappingURL=text-output-callback.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport FRCallback from '.';\n/**\n * Represents a callback used to collect a valid platform password.\n */\nvar ValidatedCreatePasswordCallback = /** @class */ (function (_super) {\n    __extends(ValidatedCreatePasswordCallback, _super);\n    /**\n     * @param payload The raw payload returned by OpenAM\n     */\n    function ValidatedCreatePasswordCallback(payload) {\n        var _this = _super.call(this, payload) || this;\n        _this.payload = payload;\n        return _this;\n    }\n    /**\n     * Gets the callback's failed policies.\n     */\n    ValidatedCreatePasswordCallback.prototype.getFailedPolicies = function () {\n        return this.getOutputByName('failedPolicies', []);\n    };\n    /**\n     * Gets the callback's applicable policies.\n     */\n    ValidatedCreatePasswordCallback.prototype.getPolicies = function () {\n        return this.getOutputByName('policies', []);\n    };\n    /**\n     * Gets the callback's prompt.\n     */\n    ValidatedCreatePasswordCallback.prototype.getPrompt = function () {\n        return this.getOutputByName('prompt', '');\n    };\n    /**\n     * Gets whether the password is required.\n     */\n    ValidatedCreatePasswordCallback.prototype.isRequired = function () {\n        return this.getOutputByName('required', false);\n    };\n    /**\n     * Sets the callback's password.\n     */\n    ValidatedCreatePasswordCallback.prototype.setPassword = function (password) {\n        this.setInputValue(password);\n    };\n    return ValidatedCreatePasswordCallback;\n}(FRCallback));\nexport default ValidatedCreatePasswordCallback;\n//# sourceMappingURL=validated-create-password-callback.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport FRCallback from '.';\n/**\n * Represents a callback used to collect a valid platform username.\n */\nvar ValidatedCreateUsernameCallback = /** @class */ (function (_super) {\n    __extends(ValidatedCreateUsernameCallback, _super);\n    /**\n     * @param payload The raw payload returned by OpenAM\n     */\n    function ValidatedCreateUsernameCallback(payload) {\n        var _this = _super.call(this, payload) || this;\n        _this.payload = payload;\n        return _this;\n    }\n    /**\n     * Gets the callback's prompt.\n     */\n    ValidatedCreateUsernameCallback.prototype.getPrompt = function () {\n        return this.getOutputByName('prompt', '');\n    };\n    /**\n     * Gets the callback's failed policies.\n     */\n    ValidatedCreateUsernameCallback.prototype.getFailedPolicies = function () {\n        return this.getOutputByName('failedPolicies', []);\n    };\n    /**\n     * Gets the callback's applicable policies.\n     */\n    ValidatedCreateUsernameCallback.prototype.getPolicies = function () {\n        return this.getOutputByName('policies', []);\n    };\n    /**\n     * Gets whether the username is required.\n     */\n    ValidatedCreateUsernameCallback.prototype.isRequired = function () {\n        return this.getOutputByName('required', false);\n    };\n    /**\n     * Sets the callback's username.\n     */\n    ValidatedCreateUsernameCallback.prototype.setName = function (name) {\n        this.setInputValue(name);\n    };\n    return ValidatedCreateUsernameCallback;\n}(FRCallback));\nexport default ValidatedCreateUsernameCallback;\n//# sourceMappingURL=validated-create-username-callback.js.map","import FRCallback from '.';\nimport { CallbackType } from '../../auth/enums';\nimport AttributeInputCallback from './attribute-input-callback';\nimport ChoiceCallback from './choice-callback';\nimport ConfirmationCallback from './confirmation-callback';\nimport DeviceProfileCallback from './device-profile-callback';\nimport HiddenValueCallback from './hidden-value-callback';\nimport KbaCreateCallback from './kba-create-callback';\nimport MetadataCallback from './metadata-callback';\nimport NameCallback from './name-callback';\nimport PasswordCallback from './password-callback';\nimport PollingWaitCallback from './polling-wait-callback';\nimport ReCaptchaCallback from './recaptcha-callback';\nimport TermsAndConditionsCallback from './terms-and-conditions-callback';\nimport TextOutputCallback from './text-output-callback';\nimport ValidatedCreatePasswordCallback from './validated-create-password-callback';\nimport ValidatedCreateUsernameCallback from './validated-create-username-callback';\n/**\n * @hidden\n */\nfunction createCallback(callback) {\n    switch (callback.type) {\n        case CallbackType.BooleanAttributeInputCallback:\n            return new AttributeInputCallback(callback);\n        case CallbackType.ChoiceCallback:\n            return new ChoiceCallback(callback);\n        case CallbackType.ConfirmationCallback:\n            return new ConfirmationCallback(callback);\n        case CallbackType.DeviceProfileCallback:\n            return new DeviceProfileCallback(callback);\n        case CallbackType.HiddenValueCallback:\n            return new HiddenValueCallback(callback);\n        case CallbackType.KbaCreateCallback:\n            return new KbaCreateCallback(callback);\n        case CallbackType.MetadataCallback:\n            return new MetadataCallback(callback);\n        case CallbackType.NameCallback:\n            return new NameCallback(callback);\n        case CallbackType.PasswordCallback:\n            return new PasswordCallback(callback);\n        case CallbackType.PollingWaitCallback:\n            return new PollingWaitCallback(callback);\n        case CallbackType.ReCaptchaCallback:\n            return new ReCaptchaCallback(callback);\n        case CallbackType.StringAttributeInputCallback:\n            return new AttributeInputCallback(callback);\n        case CallbackType.TermsAndConditionsCallback:\n            return new TermsAndConditionsCallback(callback);\n        case CallbackType.TextOutputCallback:\n            return new TextOutputCallback(callback);\n        case CallbackType.ValidatedCreatePasswordCallback:\n            return new ValidatedCreatePasswordCallback(callback);\n        case CallbackType.ValidatedCreateUsernameCallback:\n            return new ValidatedCreateUsernameCallback(callback);\n        default:\n            return new FRCallback(callback);\n    }\n}\nexport default createCallback;\n//# sourceMappingURL=factory.js.map","import createCallback from './callbacks/factory';\nimport { StepType } from './enums';\n/**\n * Represents a single step of an authentication tree.\n */\nvar FRStep = /** @class */ (function () {\n    /**\n     * @param payload The raw payload returned by OpenAM\n     * @param callbackFactory A function that returns am implementation of FRCallback\n     */\n    function FRStep(payload, callbackFactory) {\n        this.payload = payload;\n        /**\n         * The type of step.\n         */\n        this.type = StepType.Step;\n        /**\n         * The callbacks contained in this step.\n         */\n        this.callbacks = [];\n        if (payload.callbacks) {\n            this.callbacks = this.convertCallbacks(payload.callbacks, callbackFactory);\n        }\n    }\n    /**\n     * Gets the first callback of the specified type in this step.\n     *\n     * @param type The type of callback to find.\n     */\n    FRStep.prototype.getCallbackOfType = function (type) {\n        var callbacks = this.getCallbacksOfType(type);\n        if (callbacks.length !== 1) {\n            throw new Error(\"Expected 1 callback of type \\\"\" + type + \"\\\", but found \" + callbacks.length);\n        }\n        return callbacks[0];\n    };\n    /**\n     * Gets all callbacks of the specified type in this step.\n     *\n     * @param type The type of callback to find.\n     */\n    FRStep.prototype.getCallbacksOfType = function (type) {\n        return this.callbacks.filter(function (x) { return x.getType() === type; });\n    };\n    /**\n     * Sets the value of the first callback of the specified type in this step.\n     *\n     * @param type The type of callback to find.\n     * @param value The value to set for the callback.\n     */\n    FRStep.prototype.setCallbackValue = function (type, value) {\n        var callbacks = this.getCallbacksOfType(type);\n        if (callbacks.length !== 1) {\n            throw new Error(\"Expected 1 callback of type \\\"\" + type + \"\\\", but found \" + callbacks.length);\n        }\n        callbacks[0].setInputValue(value);\n    };\n    /**\n     * Gets the step's description.\n     */\n    FRStep.prototype.getDescription = function () {\n        return this.payload.description;\n    };\n    /**\n     * Gets the step's header.\n     */\n    FRStep.prototype.getHeader = function () {\n        return this.payload.header;\n    };\n    /**\n     * Gets the step's stage.\n     */\n    FRStep.prototype.getStage = function () {\n        return this.payload.stage;\n    };\n    FRStep.prototype.convertCallbacks = function (callbacks, callbackFactory) {\n        var converted = callbacks.map(function (x) {\n            // This gives preference to the provided factory and falls back to our default implementation\n            return (callbackFactory || createCallback)(x) || createCallback(x);\n        });\n        return converted;\n    };\n    return FRStep;\n}());\nexport default FRStep;\n//# sourceMappingURL=fr-step.js.map","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport Auth from '../auth/index';\nimport FRLoginFailure from './fr-login-failure';\nimport FRLoginSuccess from './fr-login-success';\nimport FRStep from './fr-step';\n/**\n * Provides access to the OpenAM authentication tree API.\n *\n * Call `FRAuth.next()` recursively.  At each step, check for session token or error, otherwise\n * populate the step's callbacks and call `next()` again.\n *\n * Example:\n *\n * ```js\n * async function nextStep(previousStep) {\n *   const thisStep = await FRAuth.next(previousStep);\n *\n *   switch (thisStep.type) {\n *     case StepType.LoginSuccess:\n *       const token = thisStep.getSessionToken();\n *       break;\n *     case StepType.LoginFailure:\n *       const detail = thisStep.getDetail();\n *       break;\n *     case StepType.Step:\n *       // Populate `thisStep` callbacks here, and then continue\n *       thisStep.setInputValue('foo');\n *       nextStep(thisStep);\n *       break;\n *   }\n * }\n * ```\n */\nvar FRAuth = /** @class */ (function () {\n    function FRAuth() {\n    }\n    /**\n     * Requests the next step in the authentication tree.\n     *\n     * @param previousStep The previous step with its callback values populated\n     * @param options Configuration overrides\n     * @return The next step in the authentication tree\n     */\n    FRAuth.next = function (previousStep, options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var nextPayload, callbackFactory;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, Auth.next(previousStep ? previousStep.payload : undefined, options)];\n                    case 1:\n                        nextPayload = _a.sent();\n                        if (nextPayload.authId) {\n                            callbackFactory = options ? options.callbackFactory : undefined;\n                            return [2 /*return*/, new FRStep(nextPayload, callbackFactory)];\n                        }\n                        if (!nextPayload.authId && nextPayload.ok) {\n                            // If there's no authId, and the response is OK, tree is complete\n                            return [2 /*return*/, new FRLoginSuccess(nextPayload)];\n                        }\n                        // If there's no authId, and the response is no OK, tree has failure\n                        return [2 /*return*/, new FRLoginFailure(nextPayload)];\n                }\n            });\n        });\n    };\n    return FRAuth;\n}());\nexport default FRAuth;\n//# sourceMappingURL=index.js.map","var browserProps = [\n    'userAgent',\n    'appName',\n    'appCodeName',\n    'appVersion',\n    'appMinorVersion',\n    'buildID',\n    'product',\n    'productSub',\n    'vendor',\n    'vendorSub',\n    'browserLanguage',\n];\nvar configurableCategories = [\n    'fontNames',\n    'displayProps',\n    'browserProps',\n    'hardwareProps',\n    'platformProps',\n];\nvar delay = 30 * 1000;\nvar devicePlatforms = {\n    mac: ['Macintosh', 'MacIntel', 'MacPPC', 'Mac68K'],\n    windows: ['Win32', 'Win64', 'Windows', 'WinCE'],\n    ios: ['iPhone', 'iPad', 'iPod'],\n};\nvar displayProps = ['width', 'height', 'pixelDepth', 'orientation.angle'];\nvar fontNames = [\n    'cursive',\n    'monospace',\n    'serif',\n    'sans-serif',\n    'fantasy',\n    'Arial',\n    'Arial Black',\n    'Arial Narrow',\n    'Arial Rounded MT Bold',\n    'Bookman Old Style',\n    'Bradley Hand ITC',\n    'Century',\n    'Century Gothic',\n    'Comic Sans MS',\n    'Courier',\n    'Courier New',\n    'Georgia',\n    'Gentium',\n    'Impact',\n    'King',\n    'Lucida Console',\n    'Lalit',\n    'Modena',\n    'Monotype Corsiva',\n    'Papyrus',\n    'Tahoma',\n    'TeX',\n    'Times',\n    'Times New Roman',\n    'Trebuchet MS',\n    'Verdana',\n    'Verona',\n];\nvar hardwareProps = [\n    'cpuClass',\n    'deviceMemory',\n    'hardwareConcurrency',\n    'maxTouchPoints',\n    'oscpu',\n];\nvar platformProps = ['language', 'platform', 'userLanguage', 'systemLanguage'];\nexport { browserProps, configurableCategories, delay, devicePlatforms, displayProps, fontNames, hardwareProps, platformProps, };\n//# sourceMappingURL=defaults.js.map","/**\n * @class Collector - base class for FRDevice\n * Generic collector functions for collecting a device profile attributes\n */\nvar Collector = /** @class */ (function () {\n    function Collector() {\n    }\n    /**\n     * @method reduceToObject - goes one to two levels into source to collect attribute\n     * @param props - array of strings; can use dot notation for two level lookup\n     * @param src - source of attributes to check\n     */\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    Collector.prototype.reduceToObject = function (props, src) {\n        return props.reduce(function (prev, curr) {\n            if (curr.includes('.')) {\n                var propArr = curr.split('.');\n                var prop1 = propArr[0];\n                var prop2 = propArr[1];\n                var prop = src[prop1] && src[prop1][prop2];\n                prev[prop2] = prop != undefined ? prop : '';\n            }\n            else {\n                prev[curr] = src[curr] != undefined ? src[curr] : null;\n            }\n            return prev;\n        }, {});\n    };\n    /**\n     * @method reduceToString - goes one level into source to collect attribute\n     * @param props - array of strings\n     * @param src - source of attributes to check\n     */\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    Collector.prototype.reduceToString = function (props, src) {\n        return props.reduce(function (prev, curr) {\n            prev = \"\" + prev + src[curr].filename + \";\";\n            return prev;\n        }, '');\n    };\n    return Collector;\n}());\nexport default Collector;\n//# sourceMappingURL=collector.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { browserProps, configurableCategories, delay, devicePlatforms, displayProps, fontNames, hardwareProps, platformProps, } from './defaults';\nimport Collector from './collector';\n/**\n * @class FRDevice - Collects user device metadata\n *\n * Example:\n *\n * ```js\n * // Instantiate new device object (w/optional config, if needed)\n * const device = new forgerock.FRDevice(\n *   // optional configuration\n * );\n * // override any instance methods, if needed\n * // e.g.: device.getDisplayMeta = () => {};\n *\n * // Call getProfile with required argument obj of boolean properties\n * // of location and metadata\n * const profile = await device.getProfile({\n *   location: isLocationRequired,\n *   metadata: isMetadataRequired,\n * });\n * ```\n */\nvar FRDevice = /** @class */ (function (_super) {\n    __extends(FRDevice, _super);\n    function FRDevice(config) {\n        var _this = _super.call(this) || this;\n        _this.config = {\n            fontNames: fontNames,\n            devicePlatforms: devicePlatforms,\n            displayProps: displayProps,\n            browserProps: browserProps,\n            hardwareProps: hardwareProps,\n            platformProps: platformProps,\n        };\n        if (config) {\n            Object.keys(config).forEach(function (key) {\n                if (!configurableCategories.includes(key)) {\n                    throw new Error('Device profile configuration category does not exist.');\n                }\n                _this.config[key] = config[key];\n            });\n        }\n        return _this;\n    }\n    FRDevice.prototype.getBrowserMeta = function () {\n        if (!navigator) {\n            console.warn('Cannot collect browser metadata. navigator is not defined.');\n            return {};\n        }\n        return this.reduceToObject(this.config.browserProps, navigator);\n    };\n    FRDevice.prototype.getBrowserPluginsNames = function () {\n        if (!(navigator && navigator.plugins)) {\n            console.warn('Cannot collect browser plugin information. navigator.plugins is not defined.');\n            return '';\n        }\n        return this.reduceToString(Object.keys(navigator.plugins), navigator.plugins);\n    };\n    FRDevice.prototype.getDeviceName = function () {\n        if (!navigator) {\n            console.warn('Cannot collect device name. navigator is not defined.');\n            return '';\n        }\n        var userAgent = navigator.userAgent;\n        var platform = navigator.platform;\n        switch (true) {\n            case this.config.devicePlatforms.mac.includes(platform):\n                return 'Mac (Browser)';\n            case this.config.devicePlatforms.ios.includes(platform):\n                return platform + \" (Browser)\";\n            case this.config.devicePlatforms.windows.includes(platform):\n                return 'Windows (Browser)';\n            case /Android/.test(platform) || /Android/.test(userAgent):\n                return 'Android (Browser)';\n            case /CrOS/.test(userAgent) || /Chromebook/.test(userAgent):\n                return 'Chrome OS (Browser)';\n            case /Linux/.test(platform):\n                return 'Linux (Browser)';\n            default:\n                return (platform || 'Unknown') + \" (Browser)\";\n        }\n    };\n    FRDevice.prototype.getDisplayMeta = function () {\n        if (!screen) {\n            console.warn('Cannot collect screen information. screen is not defined.');\n        }\n        return this.reduceToObject(this.config.displayProps, screen);\n    };\n    FRDevice.prototype.getHardwareMeta = function () {\n        if (!navigator) {\n            console.warn('Cannot collect OS metadata. Navigator is not defined.');\n            return {};\n        }\n        return this.reduceToObject(this.config.hardwareProps, navigator);\n    };\n    FRDevice.prototype.getIdentifier = function () {\n        if (!(window.crypto && window.crypto.getRandomValues)) {\n            console.warn('Cannot generate profile ID. Crypto and/or getRandomValues is not supported.');\n            return '';\n        }\n        if (!localStorage) {\n            console.warn('Cannot store profile ID. localStorage is not supported.');\n            return '';\n        }\n        var id = localStorage.getItem('profile-id');\n        if (!id) {\n            // generate ID, 3 sections of random numbers: \"714524572-2799534390-3707617532\"\n            id = window.crypto.getRandomValues(new Uint32Array(3)).join('-');\n            localStorage.setItem('profile-id', id);\n        }\n        return id;\n    };\n    FRDevice.prototype.getInstalledFonts = function () {\n        var canvas = document.createElement('canvas');\n        if (!canvas) {\n            console.warn('Cannot collect font data. Browser does not support canvas element');\n            return '';\n        }\n        var context = canvas.getContext && canvas.getContext('2d');\n        if (!context) {\n            console.warn('Cannot collect font data. Browser does not support 2d canvas context');\n            return '';\n        }\n        var text = 'abcdefghi0123456789';\n        context.font = '72px Comic Sans';\n        var baseWidth = context.measureText(text).width;\n        var installedFonts = this.config.fontNames.reduce(function (prev, curr) {\n            context.font = \"72px \" + curr + \", Comic Sans\";\n            var newWidth = context.measureText(text).width;\n            if (newWidth !== baseWidth) {\n                prev = \"\" + prev + curr + \";\";\n            }\n            return prev;\n        }, '');\n        return installedFonts;\n    };\n    FRDevice.prototype.getLocationCoordinates = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                if (!(navigator && navigator.geolocation)) {\n                    console.warn('Cannot collect geolocation information. navigator.geolocation is not defined.');\n                    return [2 /*return*/, Promise.resolve({})];\n                }\n                return [2 /*return*/, new Promise(function (resolve) { return __awaiter(_this, void 0, void 0, function () {\n                        return __generator(this, function (_a) {\n                            navigator.geolocation.getCurrentPosition(function (position) {\n                                return resolve({\n                                    latitude: position.coords.latitude,\n                                    longitude: position.coords.longitude,\n                                });\n                            }, function (error) {\n                                console.warn('Cannot collect geolocation information. ' + error.code + ': ' + error.message);\n                                resolve({});\n                            }, {\n                                enableHighAccuracy: true,\n                                timeout: delay,\n                                maximumAge: 0,\n                            });\n                            return [2 /*return*/];\n                        });\n                    }); })];\n            });\n        });\n    };\n    FRDevice.prototype.getOSMeta = function () {\n        if (!navigator) {\n            console.warn('Cannot collect OS metadata. navigator is not defined.');\n            return {};\n        }\n        return this.reduceToObject(this.config.platformProps, navigator);\n    };\n    FRDevice.prototype.getProfile = function (_a) {\n        var location = _a.location, metadata = _a.metadata;\n        return __awaiter(this, void 0, void 0, function () {\n            var profile, _b;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        profile = {\n                            identifier: this.getIdentifier(),\n                        };\n                        if (metadata) {\n                            profile.metadata = {\n                                hardware: __assign(__assign({}, this.getHardwareMeta()), { display: this.getDisplayMeta() }),\n                                browser: __assign(__assign({}, this.getBrowserMeta()), { plugins: this.getBrowserPluginsNames() }),\n                                platform: __assign(__assign({}, this.getOSMeta()), { deviceName: this.getDeviceName(), fonts: this.getInstalledFonts(), timezone: this.getTimezoneOffset() }),\n                            };\n                        }\n                        if (!location) return [3 /*break*/, 2];\n                        _b = profile;\n                        return [4 /*yield*/, this.getLocationCoordinates()];\n                    case 1:\n                        _b.location = _c.sent();\n                        _c.label = 2;\n                    case 2: return [2 /*return*/, profile];\n                }\n            });\n        });\n    };\n    FRDevice.prototype.getTimezoneOffset = function () {\n        try {\n            return new Date().getTimezoneOffset();\n        }\n        catch (err) {\n            console.warn('Cannot collect timezone information. getTimezoneOffset is not defined.');\n            return null;\n        }\n    };\n    return FRDevice;\n}(Collector));\nexport default FRDevice;\n//# sourceMappingURL=index.js.map","/** @hidden */\nvar DB_NAME = 'forgerock-sdk';\n/** @hidden */\nvar TOKEN_KEY = 'tokens';\nexport { DB_NAME, TOKEN_KEY };\n//# sourceMappingURL=constants.js.map","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { DB_NAME, TOKEN_KEY } from './constants';\n/**\n * Provides wrapper for tokens with IndexedDB.\n */\nvar IndexedDBWrapper = /** @class */ (function () {\n    function IndexedDBWrapper() {\n    }\n    /**\n     * Retrieve tokens.\n     */\n    IndexedDBWrapper.get = function (clientId) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, new Promise(function (resolve, reject) {\n                        var onError = function () { return reject(); };\n                        var openReq = window.indexedDB.open(DB_NAME);\n                        openReq.onsuccess = function () {\n                            if (!openReq.result.objectStoreNames.contains(clientId)) {\n                                openReq.result.close();\n                                return resolve(undefined);\n                            }\n                            var getReq = openReq.result\n                                .transaction(clientId, 'readonly')\n                                .objectStore(clientId)\n                                .get(TOKEN_KEY);\n                            getReq.onsuccess = function (event) {\n                                if (!event || !event.target) {\n                                    throw new Error('Missing storage event target');\n                                }\n                                openReq.result.close();\n                                resolve(event.target.result);\n                            };\n                            getReq.onerror = onError;\n                        };\n                        openReq.onupgradeneeded = function () {\n                            openReq.result.close();\n                            resolve(undefined);\n                        };\n                        openReq.onerror = onError;\n                    })];\n            });\n        });\n    };\n    /**\n     * Saves tokens.\n     */\n    IndexedDBWrapper.set = function (clientId, tokens) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, new Promise(function (resolve, reject) {\n                        var openReq = window.indexedDB.open(DB_NAME);\n                        var onSetSuccess = function () {\n                            openReq.result.close();\n                            resolve();\n                        };\n                        var onError = function () { return reject(); };\n                        var onUpgradeNeeded = function () {\n                            openReq.result.createObjectStore(clientId);\n                        };\n                        var onOpenSuccess = function () {\n                            if (!openReq.result.objectStoreNames.contains(clientId)) {\n                                var version = openReq.result.version + 1;\n                                openReq.result.close();\n                                openReq = window.indexedDB.open(DB_NAME, version);\n                                openReq.onupgradeneeded = onUpgradeNeeded;\n                                openReq.onsuccess = onOpenSuccess;\n                                openReq.onerror = onError;\n                                return;\n                            }\n                            var txnReq = openReq.result.transaction(clientId, 'readwrite');\n                            txnReq.onerror = onError;\n                            var objectStore = txnReq.objectStore(clientId);\n                            var putReq = objectStore.put(tokens, TOKEN_KEY);\n                            putReq.onsuccess = onSetSuccess;\n                            putReq.onerror = onError;\n                        };\n                        openReq.onupgradeneeded = onUpgradeNeeded;\n                        openReq.onsuccess = onOpenSuccess;\n                        openReq.onerror = onError;\n                    })];\n            });\n        });\n    };\n    /**\n     * Removes stored tokens.\n     */\n    IndexedDBWrapper.remove = function (clientId) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, new Promise(function (resolve, reject) {\n                        var onError = function () { return reject(); };\n                        var openReq = window.indexedDB.open(DB_NAME);\n                        openReq.onsuccess = function () {\n                            if (!openReq.result.objectStoreNames.contains(clientId)) {\n                                return resolve();\n                            }\n                            var removeReq = openReq.result\n                                .transaction(clientId, 'readwrite')\n                                .objectStore(clientId)\n                                .delete(TOKEN_KEY);\n                            removeReq.onsuccess = function () {\n                                resolve();\n                            };\n                            removeReq.onerror = onError;\n                        };\n                        openReq.onerror = onError;\n                    })];\n            });\n        });\n    };\n    return IndexedDBWrapper;\n}());\nexport default IndexedDBWrapper;\n//# sourceMappingURL=indexed-db.js.map","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { DB_NAME } from './constants';\n/**\n * Provides wrapper for tokens with localStorage.\n */\nvar LocalStorageWrapper = /** @class */ (function () {\n    function LocalStorageWrapper() {\n    }\n    /**\n     * Retrieve tokens.\n     */\n    LocalStorageWrapper.get = function (clientId) {\n        return __awaiter(this, void 0, void 0, function () {\n            var tokenString;\n            return __generator(this, function (_a) {\n                tokenString = localStorage.getItem(DB_NAME + \"-\" + clientId);\n                try {\n                    return [2 /*return*/, Promise.resolve(JSON.parse(tokenString || ''))];\n                }\n                catch (err) {\n                    console.warn('Could not parse token from localStorage. This could be due to accessing a removed token');\n                    // Original behavior had an untyped return of undefined for no token\n                    // eslint-disable-next-line @typescript-eslint/ban-ts-ignore\n                    // @ts-ignore\n                    return [2 /*return*/, undefined];\n                }\n                return [2 /*return*/];\n            });\n        });\n    };\n    /**\n     * Saves tokens.\n     */\n    LocalStorageWrapper.set = function (clientId, tokens) {\n        return __awaiter(this, void 0, void 0, function () {\n            var tokenString;\n            return __generator(this, function (_a) {\n                tokenString = JSON.stringify(tokens);\n                localStorage.setItem(DB_NAME + \"-\" + clientId, tokenString);\n                return [2 /*return*/];\n            });\n        });\n    };\n    /**\n     * Removes stored tokens.\n     */\n    LocalStorageWrapper.remove = function (clientId) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                localStorage.removeItem(DB_NAME + \"-\" + clientId);\n                return [2 /*return*/];\n            });\n        });\n    };\n    return LocalStorageWrapper;\n}());\nexport default LocalStorageWrapper;\n//# sourceMappingURL=local-storage.js.map","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { DB_NAME } from './constants';\n/**\n * Provides wrapper for tokens with sessionStorage.\n */\nvar SessionStorageWrapper = /** @class */ (function () {\n    function SessionStorageWrapper() {\n    }\n    /**\n     * Retrieve tokens.\n     */\n    SessionStorageWrapper.get = function (clientId) {\n        return __awaiter(this, void 0, void 0, function () {\n            var tokenString;\n            return __generator(this, function (_a) {\n                tokenString = sessionStorage.getItem(DB_NAME + \"-\" + clientId);\n                try {\n                    return [2 /*return*/, Promise.resolve(JSON.parse(tokenString || ''))];\n                }\n                catch (err) {\n                    console.warn('Could not parse token from sessionStorage. This could be due to accessing a removed token');\n                    // Original behavior had an untyped return of undefined for no token\n                    // eslint-disable-next-line @typescript-eslint/ban-ts-ignore\n                    // @ts-ignore\n                    return [2 /*return*/, undefined];\n                }\n                return [2 /*return*/];\n            });\n        });\n    };\n    /**\n     * Saves tokens.\n     */\n    SessionStorageWrapper.set = function (clientId, tokens) {\n        return __awaiter(this, void 0, void 0, function () {\n            var tokenString;\n            return __generator(this, function (_a) {\n                tokenString = JSON.stringify(tokens);\n                sessionStorage.setItem(DB_NAME + \"-\" + clientId, tokenString);\n                return [2 /*return*/];\n            });\n        });\n    };\n    /**\n     * Removes stored tokens.\n     */\n    SessionStorageWrapper.remove = function (clientId) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                sessionStorage.removeItem(DB_NAME + \"-\" + clientId);\n                return [2 /*return*/];\n            });\n        });\n    };\n    return SessionStorageWrapper;\n}());\nexport default SessionStorageWrapper;\n//# sourceMappingURL=session-storage.js.map","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport Config from '../config/index';\nimport IndexedDBWrapper from './indexed-db';\nimport LocalStorageWrapper from './local-storage';\nimport SessionStorageWrapper from './session-storage';\n/**\n * Provides access to the token storage API.\n */\nvar TokenStorage = /** @class */ (function () {\n    function TokenStorage() {\n    }\n    /**\n     * Gets stored tokens.\n     */\n    TokenStorage.get = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, clientId, tokenStore;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = this.getClientConfig(), clientId = _a.clientId, tokenStore = _a.tokenStore;\n                        if (!(tokenStore === 'sessionStorage')) return [3 /*break*/, 2];\n                        return [4 /*yield*/, SessionStorageWrapper.get(clientId)];\n                    case 1: return [2 /*return*/, _b.sent()];\n                    case 2:\n                        if (!(tokenStore === 'localStorage')) return [3 /*break*/, 4];\n                        return [4 /*yield*/, LocalStorageWrapper.get(clientId)];\n                    case 3: return [2 /*return*/, _b.sent()];\n                    case 4:\n                        if (!(tokenStore === 'indexedDB')) return [3 /*break*/, 6];\n                        return [4 /*yield*/, IndexedDBWrapper.get(clientId)];\n                    case 5: return [2 /*return*/, _b.sent()];\n                    case 6:\n                        if (!(tokenStore && tokenStore.get)) return [3 /*break*/, 8];\n                        return [4 /*yield*/, tokenStore.get(clientId)];\n                    case 7: \n                    // User supplied token store\n                    return [2 /*return*/, _b.sent()];\n                    case 8: return [4 /*yield*/, IndexedDBWrapper.get(clientId)];\n                    case 9: \n                    // if tokenStore is undefined, default to previous behavior\n                    return [2 /*return*/, _b.sent()];\n                }\n            });\n        });\n    };\n    /**\n     * Saves tokens.\n     */\n    TokenStorage.set = function (tokens) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, clientId, tokenStore;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = this.getClientConfig(), clientId = _a.clientId, tokenStore = _a.tokenStore;\n                        if (!(tokenStore === 'sessionStorage')) return [3 /*break*/, 2];\n                        return [4 /*yield*/, SessionStorageWrapper.set(clientId, tokens)];\n                    case 1: return [2 /*return*/, _b.sent()];\n                    case 2:\n                        if (!(tokenStore === 'localStorage')) return [3 /*break*/, 4];\n                        return [4 /*yield*/, LocalStorageWrapper.set(clientId, tokens)];\n                    case 3: return [2 /*return*/, _b.sent()];\n                    case 4:\n                        if (!(tokenStore === 'indexedDB')) return [3 /*break*/, 6];\n                        return [4 /*yield*/, IndexedDBWrapper.set(clientId, tokens)];\n                    case 5: return [2 /*return*/, _b.sent()];\n                    case 6:\n                        if (!(tokenStore && tokenStore.set)) return [3 /*break*/, 8];\n                        return [4 /*yield*/, tokenStore.set(clientId, tokens)];\n                    case 7: \n                    // User supplied token store\n                    return [2 /*return*/, _b.sent()];\n                    case 8: return [4 /*yield*/, IndexedDBWrapper.set(clientId, tokens)];\n                    case 9: \n                    // if tokenStore is undefined, default to previous behavior\n                    return [2 /*return*/, _b.sent()];\n                }\n            });\n        });\n    };\n    /**\n     * Removes stored tokens.\n     */\n    TokenStorage.remove = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, clientId, tokenStore;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = this.getClientConfig(), clientId = _a.clientId, tokenStore = _a.tokenStore;\n                        if (!(tokenStore === 'sessionStorage')) return [3 /*break*/, 2];\n                        return [4 /*yield*/, SessionStorageWrapper.remove(clientId)];\n                    case 1: return [2 /*return*/, _b.sent()];\n                    case 2:\n                        if (!(tokenStore === 'localStorage')) return [3 /*break*/, 4];\n                        return [4 /*yield*/, LocalStorageWrapper.remove(clientId)];\n                    case 3: return [2 /*return*/, _b.sent()];\n                    case 4:\n                        if (!(tokenStore === 'indexedDB')) return [3 /*break*/, 6];\n                        return [4 /*yield*/, IndexedDBWrapper.remove(clientId)];\n                    case 5: return [2 /*return*/, _b.sent()];\n                    case 6:\n                        if (!(tokenStore && tokenStore.remove)) return [3 /*break*/, 8];\n                        return [4 /*yield*/, tokenStore.remove(clientId)];\n                    case 7: \n                    // User supplied token store\n                    return [2 /*return*/, _b.sent()];\n                    case 8: return [4 /*yield*/, IndexedDBWrapper.remove(clientId)];\n                    case 9: \n                    // if tokenStore is undefined, default to previous behavior\n                    return [2 /*return*/, _b.sent()];\n                }\n            });\n        });\n    };\n    TokenStorage.getClientConfig = function () {\n        var _a = Config.get(), clientId = _a.clientId, tokenStore = _a.tokenStore;\n        if (!clientId) {\n            throw new Error('clientId is required to manage token storage');\n        }\n        return { clientId: clientId, tokenStore: tokenStore };\n    };\n    return TokenStorage;\n}());\nexport default TokenStorage;\n//# sourceMappingURL=index.js.map","/** @hidden */\nfunction isOkOr4xx(response) {\n    return response.ok || Math.floor(response.status / 100) === 4;\n}\nexport { isOkOr4xx };\n//# sourceMappingURL=http.js.map","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\n/**\n * Helper class for generating verifier and challenge strings used for\n * Proof Key for Code Exchange (PKCE).\n */\nvar PKCE = /** @class */ (function () {\n    function PKCE() {\n    }\n    /**\n     * Creates a random verifier.\n     *\n     * @param size The length of the verifier (default 32 characters)\n     */\n    PKCE.createVerifier = function (size) {\n        if (size === void 0) { size = 32; }\n        var array = new Uint8Array(size);\n        window.crypto.getRandomValues(array);\n        var verifier = this.base64UrlEncode(array);\n        return verifier;\n    };\n    /**\n     * Creates a SHA-256 hash of the verifier.\n     *\n     * @param verifier The verifier to hash\n     */\n    PKCE.createChallenge = function (verifier) {\n        return __awaiter(this, void 0, void 0, function () {\n            var sha256, challenge;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.sha256(verifier)];\n                    case 1:\n                        sha256 = _a.sent();\n                        challenge = this.base64UrlEncode(sha256);\n                        return [2 /*return*/, challenge];\n                }\n            });\n        });\n    };\n    /**\n     * Creates a base64 encoded, URL-friendly version of the specified array.\n     *\n     * @param array The array of numbers to encode\n     */\n    PKCE.base64UrlEncode = function (array) {\n        var numbers = Array.prototype.slice.call(array);\n        var ascii = window.btoa(String.fromCharCode.apply(null, numbers));\n        var urlEncoded = ascii.replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=/g, '');\n        return urlEncoded;\n    };\n    /**\n     * Creates a SHA-256 hash of the specified string.\n     *\n     * @param value The string to hash\n     */\n    PKCE.sha256 = function (value) {\n        return __awaiter(this, void 0, void 0, function () {\n            var uint8Array, hashBuffer, hashArray;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        uint8Array = new TextEncoder().encode(value);\n                        return [4 /*yield*/, window.crypto.subtle.digest('SHA-256', uint8Array)];\n                    case 1:\n                        hashBuffer = _a.sent();\n                        hashArray = new Uint8Array(hashBuffer);\n                        return [2 /*return*/, hashArray];\n                }\n            });\n        });\n    };\n    return PKCE;\n}());\nexport default PKCE;\n//# sourceMappingURL=pkce.js.map","/**\n * Specifies the type of OAuth flow to invoke.\n */\nvar ResponseType;\n(function (ResponseType) {\n    ResponseType[\"Code\"] = \"code\";\n    ResponseType[\"Token\"] = \"token\";\n})(ResponseType || (ResponseType = {}));\nexport { ResponseType };\n//# sourceMappingURL=enums.js.map","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { ActionTypes } from '../config/enums';\nimport Config from '../config/index';\nimport TokenStorage from '../token-storage';\nimport { isOkOr4xx } from '../util/http';\nimport PKCE from '../util/pkce';\nimport { withTimeout } from '../util/timeout';\nimport { getEndpointPath, resolve, stringify } from '../util/url';\nimport { ResponseType } from './enums';\nimport middlewareWrapper from '../util/middleware';\n/**\n * OAuth 2.0 client.\n */\nvar OAuth2Client = /** @class */ (function () {\n    function OAuth2Client() {\n    }\n    /**\n     * Gets the authorization URL configured in OpenAM, optionally using PKCE.\n     */\n    OAuth2Client.getAuthorizeUrl = function (options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, serverConfig, clientId, redirectUri, scope, requestParams, challenge, url;\n            var _this = this;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = Config.get(options), serverConfig = _a.serverConfig, clientId = _a.clientId, redirectUri = _a.redirectUri, scope = _a.scope;\n                        requestParams = {\n                            client_id: clientId,\n                            redirect_uri: redirectUri,\n                            response_type: options.responseType,\n                            scope: scope,\n                            state: options.state,\n                        };\n                        if (!options.verifier) return [3 /*break*/, 2];\n                        return [4 /*yield*/, PKCE.createChallenge(options.verifier)];\n                    case 1:\n                        challenge = _b.sent();\n                        /* eslint-disable @typescript-eslint/camelcase */\n                        requestParams.code_challenge = challenge;\n                        requestParams.code_challenge_method = 'S256';\n                        _b.label = 2;\n                    case 2:\n                        url = middlewareWrapper({\n                            url: new URL(this.getUrl('authorize', requestParams, options)),\n                            init: {},\n                        }, ActionTypes.Authorize).url;\n                        return [2 /*return*/, new Promise(function (resolve, reject) {\n                                var iframe = document.createElement('iframe');\n                                // Define these here to avoid linter warnings\n                                var noop = function () {\n                                    return;\n                                };\n                                var onLoad = noop;\n                                var cleanUp = noop;\n                                var timeout = 0;\n                                cleanUp = function () {\n                                    window.clearTimeout(timeout);\n                                    iframe.removeEventListener('load', onLoad);\n                                    iframe.remove();\n                                };\n                                onLoad = function () {\n                                    if (iframe.contentWindow) {\n                                        var newHref = iframe.contentWindow.location.href;\n                                        if (_this.containsAuthCode(newHref)) {\n                                            cleanUp();\n                                            resolve(newHref);\n                                        }\n                                    }\n                                };\n                                timeout = window.setTimeout(function () {\n                                    cleanUp();\n                                    reject('Timeout');\n                                }, serverConfig.timeout);\n                                iframe.style.display = 'none';\n                                iframe.addEventListener('load', onLoad);\n                                document.body.appendChild(iframe);\n                                iframe.src = url.toString();\n                            })];\n                }\n            });\n        });\n    };\n    /**\n     * Exchanges an authorization code for OAuth tokens.\n     */\n    OAuth2Client.getOAuth2Tokens = function (options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, clientId, redirectUri, requestParams, body, init, response, responseBody, message, responseObject;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = Config.get(options), clientId = _a.clientId, redirectUri = _a.redirectUri;\n                        requestParams = {\n                            client_id: clientId,\n                            code: options.authorizationCode,\n                            grant_type: 'authorization_code',\n                            redirect_uri: redirectUri,\n                        };\n                        /* eslint-enable @typescript-eslint/camelcase */\n                        if (options.verifier) {\n                            // eslint-disable-next-line @typescript-eslint/camelcase\n                            requestParams.code_verifier = options.verifier;\n                        }\n                        body = stringify(requestParams);\n                        init = {\n                            body: body,\n                            headers: {\n                                'content-length': body.length.toString(),\n                                'content-type': 'application/x-www-form-urlencoded',\n                            },\n                            method: 'POST',\n                        };\n                        return [4 /*yield*/, this.request('accessToken', undefined, false, init, options)];\n                    case 1:\n                        response = _b.sent();\n                        return [4 /*yield*/, this.getBody(response)];\n                    case 2:\n                        responseBody = _b.sent();\n                        if (response.status !== 200) {\n                            message = typeof responseBody === 'string'\n                                ? \"Expected 200, received \" + response.status\n                                : this.parseError(responseBody);\n                            throw new Error(message);\n                        }\n                        responseObject = responseBody;\n                        if (!responseObject.access_token) {\n                            throw new Error('Access token not found in response');\n                        }\n                        return [2 /*return*/, {\n                                accessToken: responseObject.access_token,\n                                idToken: responseObject.id_token,\n                                refreshToken: responseObject.refresh_token,\n                            }];\n                }\n            });\n        });\n    };\n    /**\n     * Gets OIDC user information.\n     */\n    OAuth2Client.getUserInfo = function (options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var response, json;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.request('userInfo', undefined, true, undefined, options)];\n                    case 1:\n                        response = _a.sent();\n                        if (response.status !== 200) {\n                            throw new Error(\"Failed to get user info; received \" + response.status);\n                        }\n                        return [4 /*yield*/, response.json()];\n                    case 2:\n                        json = _a.sent();\n                        return [2 /*return*/, json];\n                }\n            });\n        });\n    };\n    /**\n     * Invokes the OIDC end session endpoint.\n     */\n    OAuth2Client.endSession = function (options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var idToken, query, response;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, TokenStorage.get()];\n                    case 1:\n                        idToken = (_a.sent()).idToken;\n                        query = {};\n                        if (idToken) {\n                            // eslint-disable-next-line @typescript-eslint/camelcase\n                            query.id_token_hint = idToken;\n                        }\n                        return [4 /*yield*/, this.request('endSession', query, true, undefined, options)];\n                    case 2:\n                        response = _a.sent();\n                        if (!isOkOr4xx(response)) {\n                            throw new Error(\"Failed to end session; received \" + response.status);\n                        }\n                        return [2 /*return*/, response];\n                }\n            });\n        });\n    };\n    /**\n     * Immediately revokes the stored access token.\n     */\n    OAuth2Client.revokeToken = function (options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var clientId, accessToken, init, response;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        clientId = Config.get(options).clientId;\n                        return [4 /*yield*/, TokenStorage.get()];\n                    case 1:\n                        accessToken = (_a.sent()).accessToken;\n                        init = {\n                            // eslint-disable-next-line @typescript-eslint/camelcase\n                            body: stringify({ client_id: clientId, token: accessToken }),\n                            credentials: 'include',\n                            headers: { 'content-type': 'application/x-www-form-urlencoded' },\n                            method: 'POST',\n                        };\n                        return [4 /*yield*/, this.request('revoke', undefined, false, init, options)];\n                    case 2:\n                        response = _a.sent();\n                        if (!isOkOr4xx(response)) {\n                            throw new Error(\"Failed to revoke token; received \" + response.status);\n                        }\n                        return [2 /*return*/, response];\n                }\n            });\n        });\n    };\n    OAuth2Client.request = function (endpoint, query, includeToken, init, options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var serverConfig, url, getActionType, accessToken, req;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        serverConfig = Config.get(options).serverConfig;\n                        url = this.getUrl(endpoint, query, options);\n                        getActionType = function (endpoint) {\n                            switch (endpoint) {\n                                case 'accessToken':\n                                    return ActionTypes.ExchangeToken;\n                                case 'endSession':\n                                    return ActionTypes.Logout;\n                                case 'revoke':\n                                    return ActionTypes.RevokeToken;\n                                default:\n                                    return ActionTypes.UserInfo;\n                            }\n                        };\n                        init = init || {};\n                        if (!includeToken) return [3 /*break*/, 2];\n                        return [4 /*yield*/, TokenStorage.get()];\n                    case 1:\n                        accessToken = (_a.sent()).accessToken;\n                        init.credentials = 'include';\n                        init.headers = (init.headers || new Headers());\n                        init.headers.set('authorization', \"Bearer \" + accessToken);\n                        _a.label = 2;\n                    case 2:\n                        req = middlewareWrapper({ url: new URL(url), init: init }, getActionType(endpoint));\n                        return [4 /*yield*/, withTimeout(fetch(req.url.toString(), req.init), serverConfig.timeout)];\n                    case 3: return [2 /*return*/, _a.sent()];\n                }\n            });\n        });\n    };\n    OAuth2Client.containsAuthCode = function (url) {\n        return !!url && /code=([^&]+)/.test(url);\n    };\n    OAuth2Client.getBody = function (response) {\n        return __awaiter(this, void 0, void 0, function () {\n            var contentType;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        contentType = response.headers.get('content-type');\n                        if (!(contentType && contentType.indexOf('application/json') > -1)) return [3 /*break*/, 2];\n                        return [4 /*yield*/, response.json()];\n                    case 1: return [2 /*return*/, _a.sent()];\n                    case 2: return [4 /*yield*/, response.text()];\n                    case 3: return [2 /*return*/, _a.sent()];\n                }\n            });\n        });\n    };\n    OAuth2Client.parseError = function (json) {\n        if (json) {\n            if (json.error && json.error_description) {\n                return json.error + \": \" + json.error_description;\n            }\n            if (json.code && json.message) {\n                return json.code + \": \" + json.message;\n            }\n        }\n        return undefined;\n    };\n    OAuth2Client.getUrl = function (endpoint, query, options) {\n        var _a = Config.get(options), realmPath = _a.realmPath, serverConfig = _a.serverConfig;\n        var path = getEndpointPath(endpoint, realmPath, serverConfig.paths);\n        var url = resolve(serverConfig.baseUrl, path);\n        if (query) {\n            url += \"?\" + stringify(query);\n        }\n        return url;\n    };\n    return OAuth2Client;\n}());\nexport default OAuth2Client;\nexport { ResponseType };\n//# sourceMappingURL=index.js.map","/**\n * Returns a factory function to produce numbers intended for one-time use.\n *\n * @param length The number of digits to generate\n */\nfunction nonce(length) {\n    if (length === void 0) { length = 15; }\n    var last = -1;\n    var repeat = 0;\n    if (length < 4 || length > 15) {\n        throw new Error('Invalid nonce length');\n    }\n    return function () {\n        var now = Math.pow(10, 2) * +new Date();\n        if (now === last) {\n            repeat++;\n        }\n        else {\n            repeat = 0;\n            last = now;\n        }\n        var s = (now + repeat).toString();\n        return +s.substr(s.length - length);\n    };\n}\nexport default nonce;\n//# sourceMappingURL=nonce.js.map","var WebAuthnOutcome;\n(function (WebAuthnOutcome) {\n    WebAuthnOutcome[\"Error\"] = \"ERROR\";\n    WebAuthnOutcome[\"Unsupported\"] = \"unsupported\";\n})(WebAuthnOutcome || (WebAuthnOutcome = {}));\nvar WebAuthnStepType;\n(function (WebAuthnStepType) {\n    WebAuthnStepType[WebAuthnStepType[\"None\"] = 0] = \"None\";\n    WebAuthnStepType[WebAuthnStepType[\"Authentication\"] = 1] = \"Authentication\";\n    WebAuthnStepType[WebAuthnStepType[\"Registration\"] = 2] = \"Registration\";\n})(WebAuthnStepType || (WebAuthnStepType = {}));\nexport { WebAuthnOutcome, WebAuthnStepType };\n//# sourceMappingURL=enums.js.map","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport OAuth2Client, { ResponseType } from '../oauth2-client';\nimport TokenStorage from '../token-storage';\nimport nonce from '../util/nonce';\nimport PKCE from '../util/pkce';\nimport { parseQuery } from '../util/url';\nvar TokenManager = /** @class */ (function () {\n    function TokenManager() {\n    }\n    TokenManager.getTokens = function (options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var tokens, error_1, verifier, state, authorizeUrlOptions, authorizeUrl, parsedQuery, authorizationCode, getTokensOptions, error_2;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!(!options || !options.forceRenew)) return [3 /*break*/, 4];\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, TokenStorage.get()];\n                    case 2:\n                        tokens = _a.sent();\n                        if (tokens) {\n                            return [2 /*return*/, tokens];\n                        }\n                        return [3 /*break*/, 4];\n                    case 3:\n                        error_1 = _a.sent();\n                        console.error('Failed to retrieve stored tokens', error_1);\n                        return [3 /*break*/, 4];\n                    case 4:\n                        verifier = PKCE.createVerifier();\n                        state = nonce()().toString();\n                        authorizeUrlOptions = __assign(__assign({}, options), { responseType: ResponseType.Code, state: state, verifier: verifier });\n                        return [4 /*yield*/, OAuth2Client.getAuthorizeUrl(authorizeUrlOptions)];\n                    case 5:\n                        authorizeUrl = _a.sent();\n                        parsedQuery = parseQuery(authorizeUrl);\n                        if (parsedQuery.state !== state) {\n                            throw new Error('State mismatch');\n                        }\n                        if (!parsedQuery.code || Array.isArray(parsedQuery.code)) {\n                            throw new Error('Failed to acquire authorization code');\n                        }\n                        authorizationCode = parsedQuery.code;\n                        getTokensOptions = __assign(__assign({}, options), { authorizationCode: authorizationCode, verifier: verifier });\n                        return [4 /*yield*/, OAuth2Client.getOAuth2Tokens(getTokensOptions)];\n                    case 6:\n                        tokens = _a.sent();\n                        _a.label = 7;\n                    case 7:\n                        _a.trys.push([7, 9, , 10]);\n                        return [4 /*yield*/, TokenStorage.set(tokens)];\n                    case 8:\n                        _a.sent();\n                        return [3 /*break*/, 10];\n                    case 9:\n                        error_2 = _a.sent();\n                        console.error('Failed to store tokens', error_2);\n                        return [3 /*break*/, 10];\n                    case 10: return [2 /*return*/, tokens];\n                }\n            });\n        });\n    };\n    TokenManager.deleteTokens = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, TokenStorage.remove()];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return TokenManager;\n}());\nexport default TokenManager;\n//# sourceMappingURL=index.js.map","import OAuth2Client from '../oauth2-client';\n/**\n * Provides access to the current user's profile.\n */\nvar UserManager = /** @class */ (function () {\n    function UserManager() {\n    }\n    /**\n     * Gets the current user's profile.\n     */\n    UserManager.getCurrentUser = function () {\n        return OAuth2Client.getUserInfo();\n    };\n    return UserManager;\n}());\nexport default UserManager;\n//# sourceMappingURL=index.js.map","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport OAuth2Client from '../oauth2-client';\nimport TokenManager from '../token-manager';\nimport UserManager from '../user-manager';\n/**\n * High-level API for logging a user in/out and getting profile information.\n */\nvar FRUser = /** @class */ (function () {\n    function FRUser() {\n    }\n    /**\n     * Logs the user in with the specified step handler, acquires OAuth tokens, and retrieves\n     * user profile.  **Currently not implemented.**\n     *\n     * @typeparam T The type of user object expected\n     * @param handler The function to invoke when handling authentication steps\n     * @param options Configuration overrides\n     */\n    FRUser.login = function (handler, options) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                console.info(handler, options); // Avoid lint errors\n                throw new Error('FRUser.login() not implemented');\n            });\n        });\n    };\n    /**\n     * Logs the user in with the specified UI, acquires OAuth tokens, and retrieves user profile.\n     *\n     * @typeparam T The type of user object expected\n     * @param ui The UI instance to use to acquire a session\n     * @param options Configuration overrides\n     */\n    FRUser.loginWithUI = function (ui, options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var currentUser, error_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 4, , 5]);\n                        return [4 /*yield*/, ui.getSession(options)];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, TokenManager.getTokens({ forceRenew: true })];\n                    case 2:\n                        _a.sent();\n                        return [4 /*yield*/, UserManager.getCurrentUser()];\n                    case 3:\n                        currentUser = _a.sent();\n                        return [2 /*return*/, currentUser];\n                    case 4:\n                        error_1 = _a.sent();\n                        throw new Error('Login failed');\n                    case 5: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n     * Ends the user's session and revokes OAuth tokens.\n     *\n     * @param options Configuration overrides\n     */\n    FRUser.logout = function (options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var error_2;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 4, , 5]);\n                        // TODO: Determine if we're using logout() or endSession(). logout() removes\n                        //       the cookie, but fails with CORS issues currently.\n                        // await SessionManager.logout();\n                        return [4 /*yield*/, OAuth2Client.endSession(options)];\n                    case 1:\n                        // TODO: Determine if we're using logout() or endSession(). logout() removes\n                        //       the cookie, but fails with CORS issues currently.\n                        // await SessionManager.logout();\n                        _a.sent();\n                        return [4 /*yield*/, OAuth2Client.revokeToken(options)];\n                    case 2:\n                        _a.sent();\n                        return [4 /*yield*/, TokenManager.deleteTokens()];\n                    case 3:\n                        _a.sent();\n                        return [3 /*break*/, 5];\n                    case 4:\n                        error_2 = _a.sent();\n                        throw new Error('Logout failed');\n                    case 5: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return FRUser;\n}());\nexport default FRUser;\n//# sourceMappingURL=index.js.map","function ensureArray(arr) {\n    return arr || [];\n}\nfunction getClientDataJson(credential) {\n    // https://goo.gl/yabPex - To future-proof, we'll pass along whatever the browser\n    // gives us and let AM disregard randomly-injected properties\n    var uint8Array = new Uint8Array(credential.response.clientDataJSON);\n    var txtDecoder = new TextDecoder();\n    var json = txtDecoder.decode(uint8Array);\n    return json;\n}\nfunction getIndexOne(arr) {\n    return arr ? arr[1] : '';\n}\n// TODO: Remove this once AM is providing fully-serialized JSON\nfunction parseCredentials(value) {\n    try {\n        var creds = value\n            .split('}')\n            .filter(function (x) { return !!x && x !== ']'; })\n            .map(function (x) {\n            // eslint-disable-next-line @typescript-eslint/no-use-before-define\n            var idArray = parseNumberArray(x);\n            return {\n                id: new Int8Array(idArray).buffer,\n                type: 'public-key',\n            };\n        });\n        return creds;\n    }\n    catch (error) {\n        throw new Error('Failed to parse credentials');\n    }\n}\nfunction parseNumberArray(value) {\n    var matches = /new Int8Array\\((.+)\\)/.exec(value);\n    if (matches === null || matches.length < 2) {\n        return [];\n    }\n    return JSON.parse(matches[1]);\n}\nfunction parsePubKeyArray(value) {\n    if (!value) {\n        return undefined;\n    }\n    if (Array.isArray(value)) {\n        return value;\n    }\n    if (typeof value !== 'string') {\n        return undefined;\n    }\n    if (value && value[0] === '[') {\n        return JSON.parse(value);\n    }\n    value = value.replace(/(\\w+):/g, '\"$1\":');\n    return JSON.parse(\"[\" + value + \"]\");\n}\nfunction parseAllowCredentialsArray(value) {\n    if (!value) {\n        return undefined;\n    }\n    if (Array.isArray(value)) {\n        return value;\n    }\n    if (typeof value !== 'string') {\n        return undefined;\n    }\n    if (value && value[0] === '[') {\n        return JSON.parse(value);\n    }\n    value = value.replace(/(\\w+):/g, '\"$1\":');\n    return JSON.parse(\"[\" + value + \"]\");\n}\n/**\n * AM is currently serializing RP as one of the following formats, depending on\n * whether RP ID has been configured:\n *   \"relyingPartyId\":\"\"\n *   \"relyingPartyId\":\"rpId: \\\"foo\\\",\"\n * This regex handles both formats, but should be removed once AM is fixed.\n */\nfunction parseRelyingPartyId(relyingPartyId) {\n    if (relyingPartyId.includes('rpId')) {\n        return relyingPartyId.replace(/rpId: \"(.+)\",/, '$1');\n    }\n    else {\n        return relyingPartyId.replace(/id: \"(.+)\",/, '$1');\n    }\n}\nexport { ensureArray, getClientDataJson, getIndexOne, parseCredentials, parseNumberArray, parseAllowCredentialsArray, parsePubKeyArray, parseRelyingPartyId, };\n//# sourceMappingURL=helpers.js.map","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { ensureArray, getIndexOne, parsePubKeyArray } from './helpers';\nfunction parseWebAuthnRegisterText(text) {\n    var txtEncoder = new TextEncoder();\n    // e.g. `attestation: \"none\"`\n    var attestation = getIndexOne(text.match(/attestation:\\s{0,}\"(\\w+)\"/));\n    // e.g. `timeout: 60000`\n    var timeout = Number(getIndexOne(text.match(/timeout:\\s{0,}(\\d+)/)));\n    // e.g. `\"userVerification\":\"preferred\"`\n    var userVerification = getIndexOne(text.match(/\"userVerification\":\\s{0,}\"(\\w+)\"/));\n    // e.g. `rp: {\\n id: \\\"https://user.example.com:3002\\\",\\n name: \\\"ForgeRock\\\"\\n }`\n    var rp = getIndexOne(text.match(/rp:\\s{0,}{([^}]+)}/)).trim();\n    // e.g. `id: \\\"https://user.example.com:3002\\\"\n    var rpId = getIndexOne(rp.match(/id:\\s{0,}\"([^\"]*)\"/));\n    // e.g. `name: \\\"ForgeRock\\\"`\n    var rpName = getIndexOne(rp.match(/name:\\s{0,}\"([^\"]*)\"/));\n    // e.g. `user: {\\n id: Uint8Array.from(\\\"NTdhN...RiNjI5\\\",\n    // function (c) { return c.charCodeAt(0) }),\\n\n    // name: \\\"57a5b4e4-...-a4f2e5d4b629\\\",\\n\n    // displayName: \\\"57a5b4e4-...-a4f2e5d4b629\\\"\\n }`\n    var user = getIndexOne(text.match(/user:\\s{0,}{([^]{0,})},/)).trim();\n    // e.g `id: Uint8Array.from(\\\"NTdhN...RiNjI5\\\",`\n    var userId = getIndexOne(user.match(/id:\\s{0,}Uint8Array.from\\(\"([^\"]+)\"/));\n    // e.g. `name: \\\"57a5b4e4-...-a4f2e5d4b629\\\",`\n    var userName = getIndexOne(user.match(/name:\\s{0,}\"([\\d\\w._-]+)\"/));\n    // e.g. `displayName: \\\"57a5b4e4-...-a4f2e5d4b629\\\"`\n    var userDisplayName = getIndexOne(user.match(/displayName:\\s{0,}\"([\\d\\w._-]+)\"/));\n    // e.g. `pubKeyCredParams: [\n    // { \\\"type\\\": \\\"public-key\\\", \\\"alg\\\": -257 }, { \\\"type\\\": \\\"public-key\\\", \\\"alg\\\": -7 }\n    // ]`\n    var pubKeyCredParamsString = getIndexOne(text.match(/pubKeyCredParams:\\s{0,}\\[([^]+) ]/)).trim();\n    // e.g. `{ \\\"type\\\": \\\"public-key\\\", \\\"alg\\\": -257 }, { \\\"type\\\": \\\"public-key\\\", \\\"alg\\\": -7 }`\n    var pubKeyCredParams = parsePubKeyArray(pubKeyCredParamsString);\n    if (!pubKeyCredParams) {\n        throw new Error('Missing pubKeyCredParams');\n    }\n    // e.g. `challenge: new Int8Array([87, -95, 18, ... -3,  49, 12, 81]).buffer,`\n    var challengeArr = ensureArray(text.match(/challenge:\\s{0,}new\\s{0,}(Uint|Int)8Array\\(([^\\)]+)/));\n    // e.g. `[87, -95, 18, ... -3,  49, 12, 81]`\n    var challengeJSON = JSON.parse(challengeArr[2]);\n    // e.g. [87, -95, 18, ... -3,  49, 12, 81]\n    var challenge = new Int8Array(challengeJSON).buffer;\n    return {\n        attestation: attestation,\n        authenticatorSelection: {\n            userVerification: userVerification,\n        },\n        challenge: challenge,\n        excludeCredentials: [],\n        pubKeyCredParams: pubKeyCredParams,\n        rp: {\n            id: rpId,\n            name: rpName,\n        },\n        timeout: timeout,\n        user: {\n            displayName: userDisplayName,\n            id: txtEncoder.encode(userId),\n            name: userName,\n        },\n    };\n}\nfunction parseWebAuthnAuthenticateText(text) {\n    // e.g. `allowCredentials: [\n    // { \\\"type\\\": \\\"public-key\\\",\n    // \\\"id\\\": new Int8Array([-107, 93, 68, -67, ... -19, 7, 4]).buffer }\n    // ]`\n    var allowCredentialsText = getIndexOne(text.match(/allowCredentials:\\s{0,}\\[([^]+)\\s{0,}]/)).trim();\n    // Splitting objects in array in case the user has multiple keys\n    var allowCredentialArr = allowCredentialsText.split('},') || [allowCredentialsText];\n    // Iterating over array of substrings\n    var allowCredentials = allowCredentialArr.map(function (str) {\n        // e.g. `{ \\\"type\\\": \\\"public-key\\\",\n        var type = getIndexOne(str.match(/\"type\":\\s{0,}\"([\\w-]+)\"/));\n        // e.g. \\\"id\\\": new Int8Array([-107, 93, 68, -67, ... -19, 7, 4]).buffer\n        var idArr = ensureArray(text.match(/\"id\":\\s{0,}new\\s{0,}(Uint|Int)8Array\\(([^\\)]+)/));\n        // e.g. `[-107, 93, 68, -67, ... -19, 7, 4]`\n        var idJSON = JSON.parse(idArr[2]);\n        // e.g. [-107, 93, 68, -67, ... -19, 7, 4]\n        var id = new Int8Array(idJSON).buffer;\n        return {\n            type: type,\n            id: id,\n        };\n    });\n    // e.g. `timeout: 60000`\n    var timeout = Number(getIndexOne(text.match(/timeout:\\s{0,}(\\d+)/)));\n    // e.g. `challenge: new Int8Array([87, -95, 18, ... -3,  49, 12, 81]).buffer,`\n    var challengeArr = ensureArray(text.match(/challenge:\\s{0,}new\\s{0,}(Uint|Int)8Array\\(([^\\)]+)/));\n    // e.g. `[87, -95, 18, ... -3,  49, 12, 81]`\n    var challengeJSON = JSON.parse(challengeArr[2]);\n    // e.g. [87, -95, 18, ... -3,  49, 12, 81]\n    var challenge = new Int8Array(challengeJSON).buffer;\n    // e.g. `rpId: \"user.example.com\",`\n    var rpId = getIndexOne(text.match(/rpId:\\s{0,}\\[([^]+)\\s{0,}]/));\n    return __assign({ allowCredentials: allowCredentials,\n        challenge: challenge,\n        timeout: timeout }, (rpId && { id: rpId }));\n}\nexport { parseWebAuthnAuthenticateText, parseWebAuthnRegisterText };\n//# sourceMappingURL=script-parser.js.map","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { CallbackType } from '../auth/enums';\nimport { WebAuthnOutcome, WebAuthnStepType } from './enums';\nimport { getClientDataJson, parseCredentials, parsePubKeyArray, parseRelyingPartyId, } from './helpers';\nimport { parseWebAuthnAuthenticateText, parseWebAuthnRegisterText } from './script-parser';\n/**\n * Utility for integrating a web browser's WebAuthn API.\n *\n * Example:\n *\n * ```js\n * // Determine if a step is a WebAuthn step\n * const stepType = FRWebAuthn.getWebAuthnStepType(step);\n * if (stepType === WebAuthnStepType.Registration) {\n *   // Register a new device\n *   await FRWebAuthn.register(step);\n * } else if (stepType === WebAuthnStepType.Authentication) {\n *   // Authenticate with a registered device\n *   await FRWebAuthn.authenticate(step);\n * }\n */\nvar FRWebAuthn = /** @class */ (function () {\n    function FRWebAuthn() {\n    }\n    /**\n     * Determines if the given step is a WebAuthn step.\n     *\n     * @param step The step to evaluate\n     * @return A WebAuthnStepType value\n     */\n    FRWebAuthn.getWebAuthnStepType = function (step) {\n        var outcomeCallback = this.getOutcomeCallback(step);\n        var metadataCallback = this.getMetadataCallback(step);\n        var textOutputCallback = this.getTextOutputCallback(step);\n        if (outcomeCallback && metadataCallback) {\n            var metadata = metadataCallback.getOutputValue('data');\n            if (metadata.allowCredentials) {\n                return WebAuthnStepType.Authentication;\n            }\n            return WebAuthnStepType.Registration;\n        }\n        else if (outcomeCallback && textOutputCallback) {\n            var message = textOutputCallback.getMessage();\n            if (message.includes('allowCredentials')) {\n                return WebAuthnStepType.Authentication;\n            }\n            return WebAuthnStepType.Registration;\n        }\n        else {\n            return WebAuthnStepType.None;\n        }\n    };\n    /**\n     * Populates the step with the necessary authentication outcome.\n     *\n     * @param step The step that contains WebAuthn authentication data\n     * @return The populated step\n     */\n    FRWebAuthn.authenticate = function (step) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, hiddenCallback, metadataCallback, textOutputCallback, outcome, publicKey, meta, credential, error_1;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = this.getCallbacks(step), hiddenCallback = _a.hiddenCallback, metadataCallback = _a.metadataCallback, textOutputCallback = _a.textOutputCallback;\n                        if (!(hiddenCallback && (metadataCallback || textOutputCallback))) return [3 /*break*/, 5];\n                        outcome = void 0;\n                        _b.label = 1;\n                    case 1:\n                        _b.trys.push([1, 3, , 4]);\n                        publicKey = void 0;\n                        if (metadataCallback) {\n                            meta = metadataCallback.getOutputValue('data');\n                            publicKey = this.createAuthenticationPublicKey(meta);\n                        }\n                        else if (textOutputCallback) {\n                            publicKey = parseWebAuthnAuthenticateText(textOutputCallback.getMessage());\n                        }\n                        return [4 /*yield*/, this.getAuthenticationCredential(publicKey)];\n                    case 2:\n                        credential = _b.sent();\n                        outcome = this.getAuthenticationOutcome(credential);\n                        return [3 /*break*/, 4];\n                    case 3:\n                        error_1 = _b.sent();\n                        outcome = this.getErrorOutcome(error_1);\n                        return [3 /*break*/, 4];\n                    case 4:\n                        hiddenCallback.setInputValue(outcome);\n                        return [2 /*return*/, step];\n                    case 5: throw new Error('Invalid webauthn payload');\n                }\n            });\n        });\n    };\n    /**\n     * Populates the step with the necessary registration outcome.\n     *\n     * @param step The step that contains WebAuthn registration data\n     * @return The populated step\n     */\n    FRWebAuthn.register = function (step) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, hiddenCallback, metadataCallback, textOutputCallback, outcome, publicKey, meta, credential, error_2;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = this.getCallbacks(step), hiddenCallback = _a.hiddenCallback, metadataCallback = _a.metadataCallback, textOutputCallback = _a.textOutputCallback;\n                        if (!(hiddenCallback && (metadataCallback || textOutputCallback))) return [3 /*break*/, 5];\n                        outcome = void 0;\n                        _b.label = 1;\n                    case 1:\n                        _b.trys.push([1, 3, , 4]);\n                        publicKey = void 0;\n                        if (metadataCallback) {\n                            meta = metadataCallback.getOutputValue('data');\n                            publicKey = this.createRegistrationPublicKey(meta);\n                        }\n                        else if (textOutputCallback) {\n                            publicKey = parseWebAuthnRegisterText(textOutputCallback.getMessage());\n                        }\n                        return [4 /*yield*/, this.getRegistrationCredential(publicKey)];\n                    case 2:\n                        credential = _b.sent();\n                        outcome = this.getRegistrationOutcome(credential);\n                        return [3 /*break*/, 4];\n                    case 3:\n                        error_2 = _b.sent();\n                        outcome = this.getErrorOutcome(error_2);\n                        return [3 /*break*/, 4];\n                    case 4:\n                        hiddenCallback.setInputValue(outcome);\n                        return [2 /*return*/, step];\n                    case 5: throw new Error('Invalid webauthn payload');\n                }\n            });\n        });\n    };\n    /**\n     * Returns an object containing the two WebAuthn callbacks.\n     *\n     * @param step The step that contains WebAuthn callbacks\n     * @return The WebAuthn callbacks\n     */\n    FRWebAuthn.getCallbacks = function (step) {\n        var hiddenCallback = this.getOutcomeCallback(step);\n        var metadataCallback = this.getMetadataCallback(step);\n        var textOutputCallback = this.getTextOutputCallback(step);\n        var returnObj = {\n            hiddenCallback: hiddenCallback,\n        };\n        if (metadataCallback) {\n            returnObj.metadataCallback = metadataCallback;\n        }\n        else if (textOutputCallback) {\n            returnObj.textOutputCallback = textOutputCallback;\n        }\n        return returnObj;\n    };\n    /**\n     * Returns the WebAuthn metadata callback containing data to pass to the browser\n     * Web Authentication API.\n     *\n     * @param step The step that contains WebAuthn callbacks\n     * @return The metadata callback\n     */\n    FRWebAuthn.getMetadataCallback = function (step) {\n        return step.getCallbacksOfType(CallbackType.MetadataCallback).find(function (x) {\n            var cb = x.getOutputByName('data', undefined);\n            return cb && cb.hasOwnProperty('relyingPartyId');\n        });\n    };\n    /**\n     * Returns the WebAuthn hidden value callback where the outcome should be populated.\n     *\n     * @param step The step that contains WebAuthn callbacks\n     * @return The hidden value callback\n     */\n    FRWebAuthn.getOutcomeCallback = function (step) {\n        return step\n            .getCallbacksOfType(CallbackType.HiddenValueCallback)\n            .find(function (x) { return x.getOutputByName('id', '') === 'webAuthnOutcome'; });\n    };\n    /**\n     * Returns the WebAuthn metadata callback containing data to pass to the browser\n     * Web Authentication API.\n     *\n     * @param step The step that contains WebAuthn callbacks\n     * @return The metadata callback\n     */\n    FRWebAuthn.getTextOutputCallback = function (step) {\n        return step\n            .getCallbacksOfType(CallbackType.TextOutputCallback)\n            .find(function (x) {\n            var cb = x.getOutputByName('message', undefined);\n            return cb && cb.includes('webAuthnOutcome');\n        });\n    };\n    /**\n     * Retrieves the credential from the browser Web Authentication API.\n     *\n     * @param options The public key options associated with the request\n     * @return The credential\n     */\n    FRWebAuthn.getAuthenticationCredential = function (options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var credential;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, navigator.credentials.get({ publicKey: options })];\n                    case 1:\n                        credential = _a.sent();\n                        return [2 /*return*/, credential];\n                }\n            });\n        });\n    };\n    /**\n     * Converts an authentication credential into the outcome expected by OpenAM.\n     *\n     * @param credential The credential to convert\n     * @return The outcome string\n     */\n    FRWebAuthn.getAuthenticationOutcome = function (credential) {\n        if (!window.PublicKeyCredential) {\n            return WebAuthnOutcome.Unsupported;\n        }\n        try {\n            if (credential === null) {\n                throw new Error('No credential provided');\n            }\n            var clientDataJSON = getClientDataJson(credential);\n            var assertionResponse = credential.response;\n            var authenticatorData = new Int8Array(assertionResponse.authenticatorData).toString();\n            var signature = new Int8Array(assertionResponse.signature).toString();\n            return clientDataJSON + \"::\" + authenticatorData + \"::\" + signature + \"::\" + credential.id;\n        }\n        catch (error) {\n            return this.getErrorOutcome(error);\n        }\n    };\n    /**\n     * Retrieves the credential from the browser Web Authentication API.\n     *\n     * @param options The public key options associated with the request\n     * @return The credential\n     */\n    FRWebAuthn.getRegistrationCredential = function (options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var credential, error_3;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 2, , 3]);\n                        return [4 /*yield*/, navigator.credentials.create({ publicKey: options })];\n                    case 1:\n                        credential = _a.sent();\n                        return [3 /*break*/, 3];\n                    case 2:\n                        error_3 = _a.sent();\n                        throw new Error(error_3.message);\n                    case 3: return [2 /*return*/, credential];\n                }\n            });\n        });\n    };\n    /**\n     * Converts a registration credential into the outcome expected by OpenAM.\n     *\n     * @param credential The credential to convert\n     * @return The outcome string\n     */\n    FRWebAuthn.getRegistrationOutcome = function (credential) {\n        if (!window.PublicKeyCredential) {\n            return WebAuthnOutcome.Unsupported;\n        }\n        try {\n            if (credential === null) {\n                throw new Error('No credential provided');\n            }\n            var clientDataJSON = getClientDataJson(credential);\n            var attestationResponse = credential.response;\n            var attestationObject = new Int8Array(attestationResponse.attestationObject).toString();\n            return clientDataJSON + \"::\" + attestationObject + \"::\" + credential.id;\n        }\n        catch (error) {\n            return this.getErrorOutcome(error);\n        }\n    };\n    /**\n     * Converts authentication tree metadata into options required by the browser\n     * Web Authentication API.\n     *\n     * @param metadata The metadata provided in the authentication tree MetadataCallback\n     * @return The Web Authentication API request options\n     */\n    FRWebAuthn.createAuthenticationPublicKey = function (metadata) {\n        var allowCredentials = metadata.allowCredentials, challenge = metadata.challenge, relyingPartyId = metadata.relyingPartyId, timeout = metadata.timeout;\n        var rpId = parseRelyingPartyId(relyingPartyId);\n        return __assign({ allowCredentials: parseCredentials(allowCredentials), challenge: Uint8Array.from(atob(challenge), function (c) { return c.charCodeAt(0); }).buffer, timeout: timeout }, (rpId && { rpId: rpId }));\n    };\n    /**\n     * Converts authentication tree metadata into options required by the browser\n     * Web Authentication API.\n     *\n     * @param metadata The metadata provided in the authentication tree MetadataCallback\n     * @return The Web Authentication API request options\n     */\n    FRWebAuthn.createRegistrationPublicKey = function (metadata) {\n        var pubKeyCredParamsString = metadata.pubKeyCredParams;\n        var pubKeyCredParams = parsePubKeyArray(pubKeyCredParamsString);\n        if (!pubKeyCredParams) {\n            throw new Error('Missing pubKeyCredParams');\n        }\n        var attestationPreference = metadata.attestationPreference, authenticatorSelection = metadata.authenticatorSelection, challenge = metadata.challenge, relyingPartyId = metadata.relyingPartyId, relyingPartyName = metadata.relyingPartyName, timeout = metadata.timeout, userId = metadata.userId, userName = metadata.userName;\n        var rpId = parseRelyingPartyId(relyingPartyId);\n        var rp = __assign({ name: relyingPartyName }, (rpId && { id: rpId }));\n        return {\n            attestation: attestationPreference,\n            authenticatorSelection: JSON.parse(authenticatorSelection),\n            challenge: Uint8Array.from(atob(challenge), function (c) { return c.charCodeAt(0); }).buffer,\n            pubKeyCredParams: pubKeyCredParams,\n            rp: rp,\n            timeout: timeout,\n            user: {\n                displayName: userName,\n                id: Int8Array.from(userId.split('').map(function (c) { return c.charCodeAt(0); })),\n                name: userName,\n            },\n        };\n    };\n    FRWebAuthn.getErrorOutcome = function (error) {\n        var name = error.name ? error.name + \":\" : '';\n        return WebAuthnOutcome.Error + \"::\" + name + error.message;\n    };\n    return FRWebAuthn;\n}());\nexport default FRWebAuthn;\nexport { WebAuthnOutcome, WebAuthnStepType, };\n//# sourceMappingURL=index.js.map","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { getEndpointPath, resolve, stringify } from '../util/url';\nexport function addAuthzInfoToHeaders(init, advices, tokens) {\n    var headers = new Headers(init.headers);\n    if (advices.AuthenticateToServiceConditionAdvice) {\n        headers.set('x-tree', advices.AuthenticateToServiceConditionAdvice[0]);\n    }\n    else if (advices.TransactionConditionAdvice) {\n        headers.set('x-txid', advices.TransactionConditionAdvice[0]);\n    }\n    if (tokens && tokens.idToken) {\n        headers.set('x-idtoken', tokens.idToken);\n    }\n    return headers;\n}\nexport function addAuthzInfoToURL(url, advices, tokens) {\n    var updatedURL = new URL(url);\n    // Only modify URL for Transactional Authorization\n    if (advices.TransactionConditionAdvice) {\n        var txId = advices.TransactionConditionAdvice[0];\n        // Add Txn ID to *original* request options as URL param\n        updatedURL.searchParams.append('_txid', txId);\n    }\n    // If tokens are used, send idToken (OIDC)\n    if (tokens && tokens.idToken) {\n        updatedURL.searchParams.append('_idtoken', tokens.idToken);\n    }\n    // FYI: in certain circumstances, the URL may be returned unchanged\n    return updatedURL.toString();\n}\nexport function buildAuthzOptions(authzObj, baseURL, timeout, realmPath, customPaths) {\n    var treeAuthAdvices = authzObj.advices && authzObj.advices.AuthenticateToServiceConditionAdvice;\n    var txnAuthAdvices = authzObj.advices && authzObj.advices.TransactionConditionAdvice;\n    var attributeValue = '';\n    var attributeName = '';\n    if (treeAuthAdvices) {\n        attributeValue = treeAuthAdvices.reduce(function (prev, curr) {\n            var prevWithSpace = prev ? \" \" + prev : prev;\n            prev = \"\" + curr + prevWithSpace;\n            return prev;\n        }, '');\n        attributeName = 'AuthenticateToServiceConditionAdvice';\n    }\n    else if (txnAuthAdvices) {\n        attributeValue = txnAuthAdvices.reduce(function (prev, curr) {\n            var prevWithSpace = prev ? \" \" + prev : prev;\n            prev = \"\" + curr + prevWithSpace;\n            return prev;\n        }, '');\n        attributeName = 'TransactionConditionAdvice';\n    }\n    var openTags = \"<Advices><AttributeValuePair>\";\n    var nameTag = \"<Attribute name=\\\"\" + attributeName + \"\\\"/>\";\n    var valueTag = \"<Value>\" + attributeValue + \"</Value>\";\n    var endTags = \"</AttributeValuePair></Advices>\";\n    var fullXML = \"\" + openTags + nameTag + valueTag + endTags;\n    var path = getEndpointPath('authenticate', realmPath, customPaths);\n    var queryParams = {\n        authIndexType: 'composite_advice',\n        authIndexValue: fullXML,\n    };\n    var options = {\n        init: {\n            method: 'POST',\n            credentials: 'include',\n            headers: {\n                'Accept-API-Version': 'resource=2.0, protocol=1.0',\n            },\n        },\n        timeout: timeout,\n        url: resolve(baseURL, path + \"?\" + stringify(queryParams)),\n    };\n    return options;\n}\nexport function examineForIGAuthz(res) {\n    var type = res.headers.get('Content-Type') || '';\n    return type.includes('html') && res.url.includes('composite_advice');\n}\nexport function examineForRESTAuthz(res) {\n    return __awaiter(this, void 0, void 0, function () {\n        var clone, json;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    clone = res.clone();\n                    return [4 /*yield*/, clone.json()];\n                case 1:\n                    json = _a.sent();\n                    return [2 /*return*/, !!json.advices];\n            }\n        });\n    });\n}\nfunction getXMLValueFromURL(urlString) {\n    var url = new URL(urlString);\n    var value = url.searchParams.get('authIndexValue') || '';\n    var parser = new DOMParser();\n    var decodedValue = decodeURIComponent(value);\n    var doc = parser.parseFromString(decodedValue, 'application/xml');\n    var el = doc.querySelector('Value');\n    return el ? el.innerHTML : '';\n}\nexport function hasAuthzAdvice(json) {\n    if (json.advices && json.advices.AuthenticateToServiceConditionAdvice) {\n        return (Array.isArray(json.advices.AuthenticateToServiceConditionAdvice) &&\n            json.advices.AuthenticateToServiceConditionAdvice.length > 0);\n    }\n    else if (json.advices && json.advices.TransactionConditionAdvice) {\n        return (Array.isArray(json.advices.TransactionConditionAdvice) &&\n            json.advices.TransactionConditionAdvice.length > 0);\n    }\n    else {\n        return false;\n    }\n}\nexport function isAuthzStep(res) {\n    return __awaiter(this, void 0, void 0, function () {\n        var clone, json;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    clone = res.clone();\n                    return [4 /*yield*/, clone.json()];\n                case 1:\n                    json = _a.sent();\n                    return [2 /*return*/, !!json.callbacks];\n            }\n        });\n    });\n}\nexport function newTokenRequired(res, requiresNewToken) {\n    if (typeof requiresNewToken === 'function') {\n        return requiresNewToken(res);\n    }\n    return res.status === 401;\n}\nexport function normalizeIGJSON(res) {\n    var advices = {};\n    if (res.url.includes('AuthenticateToServiceConditionAdvice')) {\n        advices.AuthenticateToServiceConditionAdvice = [getXMLValueFromURL(res.url)];\n    }\n    else {\n        advices.TransactionConditionAdvice = [getXMLValueFromURL(res.url)];\n    }\n    return {\n        resource: '',\n        actions: {},\n        attributes: {},\n        advices: advices,\n        ttl: 0,\n    };\n}\nexport function normalizeRESTJSON(res) {\n    return __awaiter(this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, res.json()];\n                case 1: return [2 /*return*/, _a.sent()];\n            }\n        });\n    });\n}\n//# sourceMappingURL=util.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport Config from '../config';\nimport { ActionTypes } from '../config/enums';\nimport Dispatcher from '../event';\nimport FRAuth from '../fr-auth';\nimport { StepType } from '../fr-auth/enums';\nimport FRStep from '../fr-auth/fr-step';\nimport TokenManager from '../token-manager';\nimport TokenStorage from '../token-storage';\nimport { withTimeout } from '../util/timeout';\nimport { addAuthzInfoToHeaders, addAuthzInfoToURL, buildAuthzOptions, examineForIGAuthz, examineForRESTAuthz, hasAuthzAdvice, isAuthzStep, newTokenRequired, normalizeIGJSON, normalizeRESTJSON, } from './util';\nimport middlewareWrapper from '../util/middleware';\n/**\n * HTTP client that includes bearer token injection and refresh.\n */\nvar HttpClient = /** @class */ (function (_super) {\n    __extends(HttpClient, _super);\n    function HttpClient() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    /**\n     * Makes a request using the specified options.\n     *\n     * @param options The options to use when making the request\n     */\n    HttpClient.request = function (options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var res, authorizationJSON, hasIG, _a, realmPath, serverConfig, authzOptions, url, type, tree, _b, authUrl, authInit, initialStep, tokens, err_1, err_2;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0: return [4 /*yield*/, this._request(options, false)];\n                    case 1:\n                        res = _c.sent();\n                        hasIG = false;\n                        if (!newTokenRequired(res, options.requiresNewToken)) return [3 /*break*/, 3];\n                        return [4 /*yield*/, this._request(options, true)];\n                    case 2:\n                        res = _c.sent();\n                        _c.label = 3;\n                    case 3:\n                        if (!(options.authorization && options.authorization.handleStep)) return [3 /*break*/, 18];\n                        if (!(res.redirected && examineForIGAuthz(res))) return [3 /*break*/, 4];\n                        hasIG = true;\n                        authorizationJSON = normalizeIGJSON(res);\n                        return [3 /*break*/, 7];\n                    case 4: return [4 /*yield*/, examineForRESTAuthz(res)];\n                    case 5:\n                        if (!_c.sent()) return [3 /*break*/, 7];\n                        return [4 /*yield*/, normalizeRESTJSON(res)];\n                    case 6:\n                        authorizationJSON = _c.sent();\n                        _c.label = 7;\n                    case 7:\n                        if (!(authorizationJSON && authorizationJSON.advices)) return [3 /*break*/, 18];\n                        _a = Config.get(options.authorization.config), realmPath = _a.realmPath, serverConfig = _a.serverConfig;\n                        authzOptions = buildAuthzOptions(authorizationJSON, serverConfig.baseUrl, options.timeout, realmPath, serverConfig.paths);\n                        url = new URL(authzOptions.url);\n                        type = url.searchParams.get('authIndexType');\n                        tree = url.searchParams.get('authIndexValue');\n                        _b = middlewareWrapper({\n                            url: new URL(authzOptions.url),\n                            init: authzOptions.init,\n                        }, ActionTypes.StartAuthenticate, { type: type, tree: tree }), authUrl = _b.url, authInit = _b.init;\n                        authzOptions.url = authUrl.toString();\n                        authzOptions.init = authInit;\n                        return [4 /*yield*/, this._request(authzOptions, false)];\n                    case 8:\n                        initialStep = _c.sent();\n                        return [4 /*yield*/, isAuthzStep(initialStep)];\n                    case 9:\n                        if (!(_c.sent())) {\n                            throw new Error('Error: Initial response from auth server not a \"step\".');\n                        }\n                        if (!hasAuthzAdvice(authorizationJSON)) {\n                            throw new Error(\"Error: Transactional or Service Advice is empty.\");\n                        }\n                        _c.label = 10;\n                    case 10:\n                        _c.trys.push([10, 17, , 18]);\n                        // Walk through auth tree\n                        return [4 /*yield*/, this.stepIterator(initialStep, options.authorization.handleStep, type, tree)];\n                    case 11:\n                        // Walk through auth tree\n                        _c.sent();\n                        tokens = void 0;\n                        _c.label = 12;\n                    case 12:\n                        _c.trys.push([12, 14, , 15]);\n                        return [4 /*yield*/, TokenStorage.get()];\n                    case 13:\n                        tokens = _c.sent();\n                        return [3 /*break*/, 15];\n                    case 14:\n                        err_1 = _c.sent();\n                        return [3 /*break*/, 15];\n                    case 15:\n                        if (hasIG) {\n                            // Update URL with IDs and tokens for IG\n                            options.url = addAuthzInfoToURL(options.url, authorizationJSON.advices, tokens);\n                        }\n                        else {\n                            // Update headers with IDs and tokens for REST API\n                            options.init.headers = addAuthzInfoToHeaders(options.init, authorizationJSON.advices, tokens);\n                        }\n                        return [4 /*yield*/, this._request(options, false)];\n                    case 16:\n                        // Retry original resource request\n                        res = _c.sent();\n                        return [3 /*break*/, 18];\n                    case 17:\n                        err_2 = _c.sent();\n                        throw new Error(err_2);\n                    case 18: return [2 /*return*/, res];\n                }\n            });\n        });\n    };\n    HttpClient.setAuthHeaders = function (headers, forceRenew) {\n        return __awaiter(this, void 0, void 0, function () {\n            var tokens, err_3;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 2, , 3]);\n                        return [4 /*yield*/, TokenStorage.get()];\n                    case 1:\n                        tokens = _a.sent();\n                        return [3 /*break*/, 3];\n                    case 2:\n                        err_3 = _a.sent();\n                        return [3 /*break*/, 3];\n                    case 3:\n                        if (!(tokens && tokens.accessToken)) return [3 /*break*/, 5];\n                        return [4 /*yield*/, TokenManager.getTokens({ forceRenew: forceRenew })];\n                    case 4:\n                        // Access tokens are an OAuth artifact\n                        tokens = _a.sent();\n                        headers.set('Authorization', \"Bearer \" + tokens.accessToken);\n                        _a.label = 5;\n                    case 5: return [2 /*return*/, headers];\n                }\n            });\n        });\n    };\n    HttpClient.stepIterator = function (res, handleStep, type, tree) {\n        return __awaiter(this, void 0, void 0, function () {\n            var jsonRes, initialStep;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, res.json()];\n                    case 1:\n                        jsonRes = _a.sent();\n                        initialStep = new FRStep(jsonRes);\n                        return [2 /*return*/, new Promise(function (resolve, reject) { return __awaiter(_this, void 0, void 0, function () {\n                                function handleNext(step) {\n                                    return __awaiter(this, void 0, void 0, function () {\n                                        var input, output;\n                                        return __generator(this, function (_a) {\n                                            switch (_a.label) {\n                                                case 0: return [4 /*yield*/, handleStep(step)];\n                                                case 1:\n                                                    input = _a.sent();\n                                                    return [4 /*yield*/, FRAuth.next(input, { type: type, tree: tree })];\n                                                case 2:\n                                                    output = _a.sent();\n                                                    if (output.type === StepType.LoginSuccess) {\n                                                        resolve();\n                                                    }\n                                                    else if (output.type === StepType.LoginFailure) {\n                                                        reject('Authentication tree failure.');\n                                                    }\n                                                    else {\n                                                        handleNext(output);\n                                                    }\n                                                    return [2 /*return*/];\n                                            }\n                                        });\n                                    });\n                                }\n                                return __generator(this, function (_a) {\n                                    handleNext(initialStep);\n                                    return [2 /*return*/];\n                                });\n                            }); })];\n                }\n            });\n        });\n    };\n    HttpClient._request = function (options, forceRenew) {\n        return __awaiter(this, void 0, void 0, function () {\n            var url, init, timeout, headers, response, err_4;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        url = options.url, init = options.init, timeout = options.timeout;\n                        headers = new Headers(init.headers || {});\n                        if (!!options.bypassAuthentication) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.setAuthHeaders(headers, forceRenew)];\n                    case 1:\n                        headers = _a.sent();\n                        _a.label = 2;\n                    case 2:\n                        init.headers = headers;\n                        _a.label = 3;\n                    case 3:\n                        _a.trys.push([3, 5, , 7]);\n                        return [4 /*yield*/, withTimeout(fetch(url, init), timeout)];\n                    case 4:\n                        response = _a.sent();\n                        return [3 /*break*/, 7];\n                    case 5:\n                        err_4 = _a.sent();\n                        return [4 /*yield*/, withTimeout(fetch(url, { method: 'GET' }), timeout)];\n                    case 6:\n                        /**\n                         * If the above fetch fails due to the following conditions:\n                         *\n                         * 1. Preflight\n                         * 2. Authorization header\n                         * 3. Redirection\n                         *\n                         * The request will need to be refetched as a \"simple request\".\n                         * For more information, see:\n                         * https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#Preflighted_requests_and_redirects\n                         */\n                        response = _a.sent();\n                        return [3 /*break*/, 7];\n                    case 7: return [2 /*return*/, response];\n                }\n            });\n        });\n    };\n    return HttpClient;\n}(Dispatcher));\nexport default HttpClient;\n//# sourceMappingURL=index.js.map","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport Config from '../config/index';\nimport { REQUESTED_WITH } from '../shared/constants';\nimport { isOkOr4xx } from '../util/http';\nimport { withTimeout } from '../util/timeout';\nimport { ActionTypes } from '../config/enums';\nimport middlewareWrapper from '../util/middleware';\nimport { getEndpointPath, resolve } from '../util/url';\n/**\n * Provides access to the session management API.\n */\nvar SessionManager = /** @class */ (function () {\n    function SessionManager() {\n    }\n    /**\n     * Ends the current session.\n     */\n    SessionManager.logout = function (options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, realmPath, serverConfig, init, path, url, req, response;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = Config.get(options), realmPath = _a.realmPath, serverConfig = _a.serverConfig;\n                        init = {\n                            credentials: 'include',\n                            headers: {\n                                'accept-api-version': 'protocol=1.0,resource=2.0',\n                                'x-requested-with': REQUESTED_WITH,\n                            },\n                            method: 'POST',\n                        };\n                        path = getEndpointPath('sessions', realmPath, serverConfig.paths) + \"?_action=logout\";\n                        url = resolve(serverConfig.baseUrl, path);\n                        req = middlewareWrapper({ url: new URL(url), init: init }, ActionTypes.Logout);\n                        return [4 /*yield*/, withTimeout(fetch(req.url.toString(), req.init), serverConfig.timeout)];\n                    case 1:\n                        response = _b.sent();\n                        if (!isOkOr4xx(response)) {\n                            throw new Error(\"Failed to log out; received \" + response.status);\n                        }\n                        return [2 /*return*/, response];\n                }\n            });\n        });\n    };\n    return SessionManager;\n}());\nexport default SessionManager;\n//# sourceMappingURL=index.js.map","/**\n * Implementation of the Deferred API to simplify handling of Promises.\n */\nvar Deferred = /** @class */ (function () {\n    function Deferred() {\n        var _this = this;\n        this.promise = new Promise(function (resolve, reject) {\n            _this.reject = reject;\n            _this.resolve = resolve;\n        });\n    }\n    return Deferred;\n}());\nexport default Deferred;\n//# sourceMappingURL=deferred.js.map","/** @hidden */\nvar LocalStorage = /** @class */ (function () {\n    function LocalStorage(persist) {\n        if (persist === void 0) { persist = false; }\n        this.storage = persist ? window.localStorage : window.sessionStorage;\n    }\n    LocalStorage.prototype.get = function (key) {\n        var value = this.storage.getItem(key);\n        if (!value) {\n            return undefined;\n        }\n        return JSON.parse(value);\n    };\n    LocalStorage.prototype.set = function (key, value) {\n        this.storage.setItem(key, JSON.stringify(value));\n    };\n    LocalStorage.prototype.remove = function (key) {\n        this.storage.removeItem(key);\n    };\n    return LocalStorage;\n}());\nexport default LocalStorage;\n//# sourceMappingURL=storage.js.map","function el<T extends HTMLElement>(tagName: string, className?: string): T {\n  const d = document.createElement(tagName);\n  if (className) {\n    d.className = className;\n  }\n  return d as T;\n}\n\nexport { el };\n","import { FRStep } from '@forgerock/javascript-sdk';\nimport { FRUIStepHandler } from './interfaces';\nimport Deferred from './util/deferred';\n\n/**\n * Base handler implementation that orchestrates rendering, binding, readiness, etc. Subclasses\n * can override only the methods that require customization.\n */\nabstract class FRStepHandlerBase implements FRUIStepHandler {\n  /**\n   * Performs handler-specific retry actions.\n   */\n  public retry?: () => Promise<FRStep>;\n\n  /**\n   * The deferred Promise that resolves the step when it's ready to submit.\n   */\n  protected deferred: Deferred<FRStep>;\n\n  /**\n   * Instantiates a new handler.\n   *\n   * @param target The DOM element to contain the handler\n   * @param step The step to handle\n   */\n  constructor(protected target: HTMLElement, protected step: FRStep) {\n    this.deferred = new Deferred<FRStep>();\n  }\n\n  /**\n   * Initializes the handler and returns a Promise that will resolve with\n   * the complete step when it's ready to submit.\n   */\n  public completeStep = (): Promise<FRStep> => {\n    this.render();\n    this.getRefs();\n    this.bind();\n    this.ready();\n    return this.deferred.promise;\n  };\n\n  /**\n   * Perform any handler-specific event binding required.\n   */\n  protected bind = (): void => {\n    return;\n  };\n\n  /**\n   * Capture references to handler-specific DOM elements.\n   */\n  protected getRefs = (): void => {\n    return;\n  };\n\n  /**\n   * Return the handler-specific HTML template.\n   */\n  protected getTemplate = (): string => '';\n\n  /**\n   * Perform any required action after the handler's template has been rendered.\n   */\n  protected ready = (): void => {\n    return;\n  };\n\n  /**\n   * Render the handler's template to the target.\n   */\n  protected render = (): void => {\n    this.target.innerHTML = this.getTemplate();\n  };\n\n  /**\n   * Helper for locating a DOM element within the target.\n   */\n  protected findElement = <T extends Element>(selector: string, required = true): T => {\n    const el = this.target.querySelector<T>(selector);\n    if (required && !el) {\n      throw new Error(`Element \"${selector}\" not found`);\n    }\n    return el as T;\n  };\n}\n\nexport default FRStepHandlerBase;\n","class Deferred<T> {\n  public promise: Promise<T>;\n  public resolve!: (value: T) => void;\n  public reject!: (reason: unknown) => void;\n\n  constructor() {\n    this.promise = new Promise<T>((resolve, reject) => {\n      this.reject = reject;\n      this.resolve = resolve;\n    });\n  }\n}\n\nexport default Deferred;\n","class Button {\n  private text: string;\n\n  constructor(protected button: HTMLButtonElement) {\n    this.text = button.innerHTML;\n  }\n\n  public enable = (): void => {\n    this.button.innerHTML = this.text;\n    this.button.disabled = false;\n  };\n\n  public disable = (text?: string): void => {\n    this.button.innerHTML = text || 'Verifying...';\n    this.button.disabled = true;\n  };\n\n  public bind = (onClick: OnClick): void => {\n    this.button.addEventListener('click', onClick);\n  };\n\n  public unbind = (onClick: OnClick): void => {\n    this.button.removeEventListener('click', onClick);\n  };\n}\n\ntype OnClick = (e: MouseEvent) => void | Promise<void>;\n\nexport default Button;\n","import { FRPolicy, PolicyRequirement } from '@forgerock/javascript-sdk';\nimport { el } from '../../util/dom';\n\n/**\n * Returns a UL element containing an LI for each policy failure message.\n *\n * @param failedPolicies The policy requirements that failed validation\n * @param property The object property name the policy applies to\n */\nfunction renderErrors(\n  failedPolicies: PolicyRequirement[],\n  property: string,\n): HTMLUListElement | undefined {\n  if (!failedPolicies || failedPolicies.length === 0) {\n    return undefined;\n  }\n\n  const messages = failedPolicies.map((x) => {\n    return FRPolicy.parsePolicyRequirement(property, x);\n  });\n\n  const list = el<HTMLUListElement>('ul', 'fr-error');\n  messages.forEach((x) => {\n    const item = el('li');\n    item.innerHTML = x;\n    list.appendChild(item);\n  });\n\n  return list;\n}\n\nexport { renderErrors };\n","/**\n * The set of stage values used in Express authentication trees.\n */\nenum ExpressStage {\n  DeviceAuthentication = 'DeviceAuthentication',\n  DeviceRegistration = 'DeviceRegistration',\n  DeviceRegistrationChoice = 'DeviceRegistrationChoice',\n  LoginSuccess = 'LoginSuccess',\n  OneTimePasswordEmail = 'OneTimePasswordEmail',\n  OneTimePasswordSMS = 'OneTimePasswordSMS',\n  Password = 'Password',\n  PasswordlessChoice = 'PasswordlessChoice',\n  RegistrationSuccess = 'RegistrationSuccess',\n  RegistrationUserInfo = 'RegistrationUserInfo',\n  SecondFactorChoice = 'SecondFactorChoice',\n  Username = 'Username',\n  UsernamePassword = 'UsernamePassword',\n  UserPassword = 'UserPassword',\n}\n\nexport { ExpressStage };\n","class PasswordInput {\n  private group: HTMLElement;\n  private toggler: HTMLElement;\n  private togglerIcon: HTMLElement;\n\n  constructor(protected input: HTMLInputElement) {\n    this.group = input.closest('.form-group') as HTMLElement;\n    this.toggler = this.group.querySelector('button') as HTMLElement;\n    this.togglerIcon = this.toggler.querySelector('i') as HTMLElement;\n  }\n\n  public bind = (): void => {\n    this.toggler.addEventListener('click', this.onToggle);\n  };\n\n  public unbind = (): void => {\n    this.toggler.removeEventListener('click', this.onToggle);\n  };\n\n  private onToggle = (): void => {\n    this.input.type = this.input.type === 'text' ? 'password' : 'text';\n    this.togglerIcon.innerText = this.input.type === 'text' ? 'visibility' : 'visibility_off';\n  };\n}\n\nexport default PasswordInput;\n","import { FRStep, FRWebAuthn, WebAuthnStepType } from '@forgerock/javascript-sdk';\nimport { FRUIStepHandlerFactory } from '../interfaces';\nimport { WebAuthnMode } from './enums';\nimport BasicStepHandler from './handlers/basic';\nimport WebAuthnStepHandler from './handlers/webauthn';\nimport { CallbackRendererFactory } from './interfaces';\n\n/**\n * A step handler factory that can process any type of step.\n *\n * @param target The DOM element to contain the generated UI\n * @param step The step to process\n * @param rendererFactory The renderer factory to use when generating UI\n */\nconst basicStepHandlerFactory: FRUIStepHandlerFactory = (\n  target: HTMLElement,\n  step: FRStep,\n  rendererFactory?: CallbackRendererFactory,\n) => {\n  if (!step) {\n    throw new Error('Cannot create handler; no step specified');\n  }\n\n  const webAuthnStepType = FRWebAuthn.getWebAuthnStepType(step);\n  if (webAuthnStepType !== WebAuthnStepType.None) {\n    const isAuth = webAuthnStepType === WebAuthnStepType.Authentication;\n    const webAuthnMode = isAuth ? WebAuthnMode.Authentication : WebAuthnMode.Registration;\n    return new WebAuthnStepHandler(target, step, webAuthnMode);\n  }\n\n  return new BasicStepHandler(target, step, rendererFactory);\n};\n\nexport default basicStepHandlerFactory;\nexport { BasicStepHandler };\n","/** @hidden */\nenum WebAuthnMode {\n  Authentication = 'authentication',\n  Registration = 'registration',\n}\n\nexport { WebAuthnMode };\n","import { AttributeInputCallback } from '@forgerock/javascript-sdk';\nimport { el } from '../../util/dom';\nimport {\n  CallbackRenderer,\n  DestroyableCallbackRenderer,\n  FocusableCallbackRenderer,\n} from '../interfaces';\nimport { renderErrors } from './errors';\n\n/**\n * Renders a labeled checkbox and any policy failure messages.\n */\nclass BooleanAttributeCallbackRenderer\n  implements DestroyableCallbackRenderer, FocusableCallbackRenderer {\n  private input!: HTMLInputElement;\n\n  /**\n   * @param callback The callback to render\n   * @param index The index position in the step's callback array\n   * @param onChange A function to call when the callback value is changed\n   */\n  constructor(\n    private callback: AttributeInputCallback<boolean>,\n    private index: number,\n    private onChange: (renderer: CallbackRenderer) => void,\n  ) {}\n\n  /**\n   * Removes event listeners.\n   */\n  public destroy = (): void => this.input.removeEventListener('change', this.onInput);\n\n  /**\n   * Sets the focus on the checkbox.\n   */\n  public focus = (): void => this.input.focus();\n\n  /**\n   * Creates all required DOM elements and returns the containing element.\n   */\n  public render = (): HTMLDivElement => {\n    const formGroup = el<HTMLDivElement>('div', `fr-callback-${this.index} form-check mb-3`);\n\n    // Add checkbox\n    this.input = el<HTMLInputElement>('input', 'form-check-input');\n    this.input.checked = this.callback.getInputValue() as boolean;\n    this.input.id = `fr-callback-${this.index}`;\n    this.input.type = 'checkbox';\n    this.input.addEventListener('change', this.onInput);\n    formGroup.appendChild(this.input);\n\n    // Add label\n    const prompt = this.callback.getPrompt();\n    if (prompt) {\n      const label = el<HTMLLabelElement>('label', 'form-check-label');\n      label.innerHTML = prompt;\n      label.htmlFor = this.input.id;\n      formGroup.appendChild(label);\n    }\n\n    // Add policy errors\n    const errorList = renderErrors(this.callback.getFailedPolicies(), prompt);\n    if (errorList) {\n      formGroup.appendChild(errorList);\n    }\n\n    return formGroup;\n  };\n\n  private onInput = (): void => {\n    this.callback.setValue(this.input.checked);\n    this.onChange(this);\n  };\n}\n\nexport default BooleanAttributeCallbackRenderer;\n","import { ChoiceCallback } from '@forgerock/javascript-sdk';\nimport { el } from '../../util/dom';\nimport {\n  CallbackRenderer,\n  DestroyableCallbackRenderer,\n  FocusableCallbackRenderer,\n} from '../interfaces';\n\n/**\n * Renders a dropdown of choices.\n */\nclass ChoiceCallbackRenderer implements DestroyableCallbackRenderer, FocusableCallbackRenderer {\n  private input!: HTMLSelectElement;\n\n  /**\n   * @param callback The callback to render\n   * @param index The index position in the step's callback array\n   * @param onChange A function to call when the callback value is changed\n   */\n  constructor(\n    private callback: ChoiceCallback,\n    private index: number,\n    private onChange: (renderer: CallbackRenderer) => void,\n  ) {}\n\n  /**\n   * Removes event listeners.\n   */\n  public destroy = (): void => this.input.removeEventListener('change', this.onInput);\n\n  /**\n   * Sets the focus on the dropdown.\n   */\n  public focus = (): void => this.input.focus();\n\n  /**\n   * Returns true if the dropdown has a value selected.\n   */\n  public isValid = (): boolean => this.input && this.input.value.length > 0;\n\n  /**\n   * Creates all required DOM elements and returns the containing element.\n   */\n  public render = (): HTMLDivElement => {\n    const defaultIndex = this.callback.getInputValue() as number;\n    const formGroup = el<HTMLDivElement>('div', `fr-callback-${this.index} form-group`);\n    const id = `fr-callback-${this.index}`;\n\n    // Add the prompt\n    const prompt = this.callback.getPrompt();\n    if (prompt) {\n      const label = el<HTMLLabelElement>('label');\n      label.innerHTML = prompt;\n      label.htmlFor = id;\n      formGroup.appendChild(label);\n    }\n\n    // Add the dropdown\n    this.input = el<HTMLSelectElement>('select', 'form-control');\n    this.input.id = id;\n    this.input.addEventListener('change', this.onInput);\n    this.callback.getChoices().forEach((x, i) => {\n      const option = el<HTMLOptionElement>('option');\n      option.value = i.toString();\n      option.text = x;\n      option.selected = i === defaultIndex;\n      this.input.appendChild(option);\n    });\n    formGroup.appendChild(this.input);\n\n    return formGroup;\n  };\n\n  private onInput = (): void => {\n    this.callback.setChoiceIndex(Number(this.input.value));\n    this.onChange(this);\n  };\n}\n\nexport default ChoiceCallbackRenderer;\n","import { ConfirmationCallback } from '@forgerock/javascript-sdk';\nimport { el } from '../../util/dom';\nimport {\n  CallbackRenderer,\n  DestroyableCallbackRenderer,\n  FocusableCallbackRenderer,\n} from '../interfaces';\n\n/** @hidden */\ninterface ConfirmationButton {\n  element: HTMLButtonElement;\n  handler: (e: MouseEvent) => void;\n}\n\n/**\n * Renders a message and a set of buttons, one for each option in the callback.\n */\nclass ConfirmationCallbackRenderer\n  implements DestroyableCallbackRenderer, FocusableCallbackRenderer {\n  private buttons!: ConfirmationButton[];\n\n  /**\n   * @param callback The callback to render\n   * @param index The index position in the step's callback array\n   * @param onChange A function to call when the callback value is changed\n   */\n  constructor(\n    private callback: ConfirmationCallback,\n    private index: number,\n    private onChange: (renderer: CallbackRenderer) => void,\n  ) {}\n\n  /**\n   * Removes event listeners.\n   */\n  public destroy = (): void => {\n    this.buttons.forEach((x) => x.element.removeEventListener('click', x.handler));\n    this.buttons = [];\n  };\n\n  /**\n   * Sets the focus on the first button.\n   */\n  public focus = (): void => this.buttons[0].element.focus();\n\n  /**\n   * Creates all required DOM elements and returns the containing element.\n   */\n  public render = (): HTMLDivElement => {\n    const formGroup = el<HTMLDivElement>('div', `fr-callback-${this.index} form-group`);\n\n    // Add the prompt\n    const prompt = this.callback.getPrompt();\n    if (prompt) {\n      const label = el<HTMLLabelElement>('label');\n      label.innerHTML = prompt;\n      formGroup.appendChild(label);\n    }\n\n    // Add the buttons\n    this.buttons = this.callback.getOptions().map((x, i) => {\n      const handler = (): void => this.onInput(i);\n      const element = el<HTMLButtonElement>('button');\n      element.className = 'btn btn-primary mt-3';\n      element.innerHTML = x;\n      element.addEventListener('click', handler);\n      return { element, handler };\n    });\n    this.buttons.forEach((x) => formGroup.appendChild(x.element));\n\n    return formGroup;\n  };\n\n  private onInput = (index: number): void => {\n    this.callback.setInputValue(index);\n    this.onChange(this);\n  };\n}\n\nexport default ConfirmationCallbackRenderer;\n","import { FRCallback, PolicyRequirement } from '@forgerock/javascript-sdk';\nimport { el } from '../../util/dom';\nimport {\n  CallbackRenderer,\n  DestroyableCallbackRenderer,\n  FocusableCallbackRenderer,\n} from '../interfaces';\nimport { renderErrors } from './errors';\n\n/**\n * Renders a labeled text input box and any policy failure messages.\n */\nclass GenericCallbackRenderer implements DestroyableCallbackRenderer, FocusableCallbackRenderer {\n  private input!: HTMLInputElement;\n\n  /**\n   * @param callback The callback to render\n   * @param index The index position in the step's callback array\n   * @param onChange A function to call when the callback value is changed\n   */\n  constructor(\n    private callback: FRCallback,\n    private index: number,\n    private onChange: (renderer: CallbackRenderer) => void,\n  ) {}\n\n  /**\n   * Removes event listeners.\n   */\n  public destroy = (): void => this.input.removeEventListener('keyup', this.onInput);\n\n  /**\n   * Sets the focus on the text input.\n   */\n  public focus = (): void => this.input.focus();\n\n  /**\n   * Returns true if the text input has a value.\n   */\n  public isValid = (): boolean => this.input && this.input.value.length > 0;\n\n  /**\n   * Creates all required DOM elements and returns the containing element.\n   */\n  public render = (): HTMLDivElement => {\n    // Create basic structure\n    const formGroup = el<HTMLDivElement>('div', `fr-callback-${this.index} form-group`);\n    const formLabelGroup = el<HTMLDivElement>('div', 'form-label-group');\n    formGroup.appendChild(formLabelGroup);\n\n    // Add the input element\n    this.input = el<HTMLInputElement>('input', 'form-control');\n    this.input.id = `fr-callback-${this.index}`;\n    this.input.type = 'text';\n    this.input.value = this.callback.getInputValue() as string;\n    this.input.addEventListener('keyup', this.onInput);\n    formLabelGroup.appendChild(this.input);\n\n    // Add the prompt label\n    const prompt = this.callback.getOutputByName('prompt', '');\n    if (prompt) {\n      this.input.placeholder = prompt;\n      const label = el<HTMLLabelElement>('label');\n      label.innerHTML = prompt;\n      label.htmlFor = this.input.id;\n      formLabelGroup.appendChild(label);\n    }\n\n    // Add policy errors\n    const failedPolicies = this.callback.getOutputByName<PolicyRequirement[]>('failedPolicies', []);\n    if (failedPolicies.length > 0) {\n      const errorList = renderErrors(failedPolicies, prompt);\n      if (errorList) {\n        formGroup.appendChild(errorList);\n      }\n    }\n\n    return formGroup;\n  };\n\n  private onInput = (): void => {\n    this.callback.setInputValue(this.input.value);\n    this.onChange(this);\n  };\n}\n\nexport default GenericCallbackRenderer;\n","import { KbaCreateCallback } from '@forgerock/javascript-sdk';\nimport { el } from '../../util/dom';\nimport {\n  CallbackRenderer,\n  DestroyableCallbackRenderer,\n  FocusableCallbackRenderer,\n} from '../interfaces';\n\n/** @hidden */\nconst TEXT = {\n  answerLabel: 'Answer',\n  customLabel: 'Custom Question',\n};\n\n/**\n * Renders a dropdown of suggested questions with an option for \"Custom Question\".  The question\n * that corresponds to the `kbaIndex` constructor parameter value is selected by default.  If\n * the user changes the selection to \"Custom Question\", a text input box is dynamically displayed.\n *\n * This renderer also adds a text input box for capturing an answer to the security question.\n *\n * The callback prompt will only be rendered if this is the first KBA callback in the step.\n */\nclass KbaCreateCallbackRenderer implements DestroyableCallbackRenderer, FocusableCallbackRenderer {\n  private select!: HTMLSelectElement;\n  private custom!: HTMLInputElement;\n  private customWrap!: HTMLDivElement;\n  private answer!: HTMLInputElement;\n\n  /**\n   * @param callback The callback to render\n   * @param index The index position in the step's callback array\n   * @param kbaIndex The index position in the step's array of only KBA callbacks\n   * @param onChange A function to call when the callback value is changed\n   */\n  constructor(\n    private callback: KbaCreateCallback,\n    private index: number,\n    private kbaIndex: number,\n    private onChange: (renderer: CallbackRenderer) => void,\n  ) {}\n\n  /**\n   * Removes event listeners.\n   */\n  public destroy = (): void => {\n    this.select.removeEventListener('change', this.onQuestionChange);\n    this.custom.removeEventListener('keyup', this.onInput);\n    this.answer.removeEventListener('keyup', this.onInput);\n  };\n\n  /**\n   * Sets the focus on the dropdown.\n   */\n  public focus = (): void => this.select.focus();\n\n  /**\n   * Returns true if a KBA question has been selected/entered and an answer is provided.\n   */\n  public isValid = (): boolean => {\n    if (!this.select || !this.custom || !this.answer) return false;\n    const hasQuestion = !this.isCustomQuestion() || this.custom.value.length > 0;\n    const hasAnswer = this.answer.value.length > 0;\n    return hasQuestion && hasAnswer;\n  };\n\n  /**\n   * Creates all required DOM elements and returns the containing element.\n   */\n  public render = (): HTMLDivElement => {\n    const formGroup = el<HTMLDivElement>('div', `fr-callback-${this.index} form-group`);\n\n    // Only add the prompt to the first KBA question\n    if (this.kbaIndex === 0) {\n      const p = el<HTMLParagraphElement>('p');\n      p.innerHTML = this.callback.getPrompt();\n      formGroup.appendChild(p);\n    }\n\n    // Determine the list of options and selected index\n    const predefinedQuestions = this.callback.getPredefinedQuestions();\n    const questionText =\n      (this.callback.getInputValue(0) as string) || predefinedQuestions[this.kbaIndex];\n    const isCustomQuestion = !predefinedQuestions.includes(questionText);\n    const allOptions = [...predefinedQuestions, TEXT.customLabel];\n    const selectedIndex = allOptions.indexOf(isCustomQuestion ? TEXT.customLabel : questionText);\n\n    // Add the dropdown\n    const selectWrap = el<HTMLDivElement>('div', 'mb-1');\n    this.select = el<HTMLSelectElement>('select', 'form-control custom-select');\n    this.select.required = true;\n    allOptions.forEach((x, i) => {\n      const option = this.createOption(x, i === selectedIndex);\n      this.select.appendChild(option);\n    });\n    this.select.addEventListener('change', this.onQuestionChange);\n    selectWrap.appendChild(this.select);\n    formGroup.appendChild(selectWrap);\n\n    // Create the \"custom question\" input\n    this.customWrap = el<HTMLDivElement>('div', 'form-label-group fr-kba-custom-wrap mb-1 d-none');\n    this.custom = el<HTMLInputElement>('input', 'form-control fr-kba-custom');\n    this.custom.id = `fr-callback-${this.index}-custom`;\n    this.custom.type = 'text';\n    this.custom.value = isCustomQuestion ? questionText : '';\n    this.custom.addEventListener('keyup', this.onInput);\n    this.customWrap.appendChild(this.custom);\n    const customLabel = el<HTMLLabelElement>('label');\n    customLabel.htmlFor = this.custom.id;\n    customLabel.innerHTML = TEXT.customLabel;\n    this.customWrap.appendChild(customLabel);\n    formGroup.appendChild(this.customWrap);\n\n    // Create an input for the answer\n    const answerWrap = el<HTMLDivElement>('div', 'form-label-group mb-0');\n    this.answer = el<HTMLInputElement>('input', 'form-control fr-kba-answer');\n    this.answer.id = `fr-callback-${this.index}-answer`;\n    this.answer.placeholder = TEXT.answerLabel;\n    this.answer.type = 'text';\n    this.answer.value = this.callback.getInputValue(1) as string;\n    this.answer.addEventListener('keyup', this.onInput);\n    answerWrap.appendChild(this.answer);\n    const answerLabel = el<HTMLLabelElement>('label');\n    answerLabel.htmlFor = this.answer.id;\n    answerLabel.innerHTML = TEXT.answerLabel;\n    answerWrap.appendChild(answerLabel);\n    formGroup.appendChild(answerWrap);\n\n    this.setView();\n\n    return formGroup;\n  };\n\n  private createOption = (text: string, selected: boolean): HTMLOptionElement => {\n    const option = el<HTMLOptionElement>('option');\n    option.value = text;\n    option.text = text;\n    option.selected = selected;\n    return option;\n  };\n\n  private isCustomQuestion = (): boolean => {\n    return this.select.value === TEXT.customLabel;\n  };\n\n  private onQuestionChange = (): void => {\n    this.setView();\n    this.onInput();\n  };\n\n  private setView = (): void => {\n    if (this.isCustomQuestion()) {\n      this.customWrap.classList.remove('d-none');\n    } else {\n      this.customWrap.classList.add('d-none');\n    }\n  };\n\n  private onInput = (): void => {\n    if (this.isCustomQuestion()) {\n      this.callback.setQuestion(this.custom.value);\n    } else {\n      this.callback.setQuestion(this.select.value);\n    }\n    this.callback.setAnswer(this.answer.value);\n    this.onChange(this);\n  };\n}\n\nexport default KbaCreateCallbackRenderer;\n","import { PasswordCallback, ValidatedCreatePasswordCallback } from '@forgerock/javascript-sdk';\nimport { el } from '../../util/dom';\nimport {\n  CallbackRenderer,\n  DestroyableCallbackRenderer,\n  FocusableCallbackRenderer,\n} from '../interfaces';\nimport { renderErrors } from './errors';\n\n/**\n * Renders a labeled password input box and any policy failure messages.  The password\n * input box contains a toggle button to hide/show the password.\n */\nclass PasswordCallbackRenderer implements DestroyableCallbackRenderer, FocusableCallbackRenderer {\n  private input!: HTMLInputElement;\n  private toggle!: HTMLButtonElement;\n  private toggleIcon!: HTMLElement;\n\n  /**\n   * @param callback The callback to render\n   * @param index The index position in the step's callback array\n   * @param onChange A function to call when the callback value is changed\n   */\n  constructor(\n    private callback: PasswordCallback | ValidatedCreatePasswordCallback,\n    private index: number,\n    private onChange: (renderer: CallbackRenderer) => void,\n  ) {}\n\n  /**\n   * Removes event listeners.\n   */\n  public destroy = (): void => {\n    this.input.removeEventListener('keyup', this.onInput);\n    this.toggle.removeEventListener('click', this.toggleView);\n  };\n\n  /**\n   * Sets the focus on the password input.\n   */\n  public focus = (): void => this.input.focus();\n\n  /**\n   * Returns true if the password input has a value.\n   */\n  public isValid = (): boolean => this.input && this.input.value.length > 0;\n\n  /**\n   * Creates all required DOM elements and returns the containing element.\n   */\n  public render = (): HTMLDivElement => {\n    // Create the basic structure\n    const formGroup = el<HTMLDivElement>('div', `fr-callback-${this.index} form-group`);\n    const formLabelGroup = el<HTMLDivElement>('div', 'form-label-group form-label-group-password');\n    const formLabelGroupInput = el<HTMLDivElement>('div', 'form-label-group-input');\n    const formInputGroupAppend = el<HTMLDivElement>('div', 'input-group-append');\n    formLabelGroup.appendChild(formLabelGroupInput);\n    formLabelGroup.appendChild(formInputGroupAppend);\n    formGroup.appendChild(formLabelGroup);\n\n    // Add the input\n    this.input = el<HTMLInputElement>('input', 'form-control');\n    this.input.id = `fr-callback-${this.index}`;\n    this.input.addEventListener('keyup', this.onInput);\n    formLabelGroupInput.appendChild(this.input);\n\n    // Add the prompt\n    const prompt = this.callback.getPrompt();\n    if (prompt) {\n      this.input.placeholder = prompt;\n      const label = el<HTMLLabelElement>('label');\n      label.innerHTML = prompt;\n      label.htmlFor = this.input.id;\n      formLabelGroupInput.appendChild(label);\n    }\n\n    // Add the view/hide toggle\n    this.toggle = el<HTMLButtonElement>('button', 'btn btn-outline-secondary');\n    this.toggle.type = 'button';\n    this.toggle.addEventListener('click', this.toggleView);\n    this.toggleIcon = el<HTMLElement>('i', 'material-icons material-icons-outlined');\n    this.toggle.appendChild(this.toggleIcon);\n    formInputGroupAppend.appendChild(this.toggle);\n\n    // Add policy errors\n    const errorList = renderErrors(this.callback.getFailedPolicies(), prompt);\n    if (errorList) {\n      formGroup.appendChild(errorList);\n    }\n\n    this.setView(false);\n\n    return formGroup;\n  };\n\n  private setView = (showPassword: boolean): void => {\n    this.input.type = showPassword ? 'text' : 'password';\n    this.toggleIcon.innerHTML = showPassword ? 'visibility_off' : 'visibility';\n  };\n\n  private toggleView = (): void => {\n    this.setView(this.input.type === 'password');\n  };\n\n  private onInput = (): void => {\n    this.callback.setPassword(this.input.value);\n    this.onChange(this);\n  };\n}\n\nexport default PasswordCallbackRenderer;\n","import { PollingWaitCallback } from '@forgerock/javascript-sdk';\nimport { el } from '../../util/dom';\nimport { CallbackRenderer } from '../interfaces';\n\n/**\n * Renders no visible elements.  Automatically triggers a \"change\" event after the\n * callback's wait time.\n */\nclass PollingWaitCallbackRenderer implements CallbackRenderer {\n  /**\n   * @param callback The callback to render\n   * @param index The index position in the step's callback array\n   * @param onChange A function to call when the callback value is changed\n   */\n  constructor(\n    private callback: PollingWaitCallback,\n    private index: number,\n    private onChange: (renderer: CallbackRenderer) => void,\n  ) {}\n\n  /**\n   * Creates all required DOM elements and returns the containing element.\n   */\n  public render = (): HTMLDivElement => {\n    const formGroup = el<HTMLDivElement>('div', `fr-callback-${this.index} form-group`);\n    formGroup.innerHTML = this.callback.getMessage();\n    return formGroup;\n  };\n\n  /**\n   * Starts the timeout after which `onChange` will be called.\n   */\n  public onInjected = (): void => {\n    const waitTime = this.callback.getWaitTime();\n    window.setTimeout(() => this.onChange(this), waitTime);\n  };\n}\n\nexport default PollingWaitCallbackRenderer;\n","import { ReCaptchaCallback } from '@forgerock/javascript-sdk';\nimport { el } from '../../util/dom';\nimport { CallbackRenderer } from '../interfaces';\n\n/* eslint-disable max-len */\n/**\n * Invokes the reCAPTCHA API, which should be added to the page as an external\n * script with explicit rendering enabled. Refer to the\n * [reCAPTCHA documentation](https://developers.google.com/recaptcha/docs/display#explicitly_render_the_recaptcha_widget)\n * for more information.\n */\n/* eslint-enable max-len */\nclass ReCaptchaCallbackRenderer implements CallbackRenderer {\n  private container: HTMLDivElement;\n  private result = '';\n\n  /**\n   * @param callback The callback to render\n   * @param index The index position in the step's callback array\n   * @param onChange A function to call when the callback value is changed\n   */\n  constructor(\n    private callback: ReCaptchaCallback,\n    private index: number,\n    private onChange: (renderer: CallbackRenderer) => void,\n  ) {\n    this.container = el<HTMLDivElement>('div', 'g-recaptcha');\n  }\n\n  /**\n   * Returns true if a successful reCAPTCHA result has been captured.\n   */\n  public isValid = (): boolean => this.result.length > 0;\n\n  /**\n   * Creates all required DOM elements and returns the containing element.\n   */\n  public render = (): HTMLDivElement => {\n    const formGroup = el<HTMLDivElement>('div', `fr-callback-${this.index} form-group`);\n    formGroup.appendChild(this.container);\n    return formGroup;\n  };\n\n  /**\n   * Instructs reCAPTCHA to render its UI.\n   */\n  public onInjected = (): void => {\n    if (!window.grecaptcha || typeof window.grecaptcha.render !== 'function') {\n      return console.error('reCAPTCHA is not present');\n    }\n\n    window.grecaptcha.render(this.container, {\n      callback: (result: string) => {\n        this.setResult(result);\n      },\n      'expired-callback': () => {\n        this.setResult('');\n      },\n      sitekey: this.callback.getSiteKey(),\n    });\n  };\n\n  private setResult = (result: string): void => {\n    this.result = result;\n    this.callback.setResult(result);\n    this.onChange(this);\n  };\n}\n\nexport default ReCaptchaCallbackRenderer;\n","import { TermsAndConditionsCallback } from '@forgerock/javascript-sdk';\nimport { el } from '../../util/dom';\nimport {\n  CallbackRenderer,\n  DestroyableCallbackRenderer,\n  FocusableCallbackRenderer,\n} from '../interfaces';\n\n/**\n * Renders the content of the Terms and Conditions, along with a labeled checkbox\n * that indicates agreement.\n */\nclass TermsAndConditionsCallbackRenderer\n  implements DestroyableCallbackRenderer, FocusableCallbackRenderer {\n  private input!: HTMLInputElement;\n\n  /**\n   * @param callback The callback to render\n   * @param index The index position in the step's callback array\n   * @param onChange A function to call when the callback value is changed\n   */\n  constructor(\n    private callback: TermsAndConditionsCallback,\n    private index: number,\n    private onChange: (renderer: CallbackRenderer) => void,\n  ) {}\n\n  /**\n   * Removes event listeners.\n   */\n  public destroy = (): void => this.input.removeEventListener('change', this.onInput);\n\n  /**\n   * Sets the focus on the checkbox.\n   */\n  public focus = (): void => this.input.focus();\n\n  /**\n   * Returns true if the checkbox is checked.\n   */\n  public isValid = (): boolean => this.input && this.input.checked;\n\n  /**\n   * Creates all required DOM elements and returns the containing element.\n   */\n  public render = (): HTMLDivElement => {\n    const formGroup = el<HTMLDivElement>('div', `fr-callback-${this.index} form-group`);\n\n    // Add the terms\n    const p = el<HTMLParagraphElement>('p');\n    p.innerHTML = this.callback.getTerms();\n    formGroup.appendChild(p);\n\n    // Add the checkbox and label\n    const formCheck = el<HTMLDivElement>('div', 'form-check mb-3');\n    formGroup.appendChild(formCheck);\n    this.input = el<HTMLInputElement>('input', 'form-check-input');\n    this.input.checked = this.callback.getInputValue() as boolean;\n    this.input.id = `fr-callback-${this.index}`;\n    this.input.type = 'checkbox';\n    this.input.addEventListener('change', this.onInput);\n    formCheck.appendChild(this.input);\n    const label = el<HTMLLabelElement>('label', 'form-check-label');\n    label.innerHTML = 'I have read and agree to the terms and conditions';\n    label.htmlFor = this.input.id;\n    formCheck.appendChild(label);\n\n    return formGroup;\n  };\n\n  private onInput = (): void => {\n    this.callback.setAccepted(this.input.checked);\n    this.onChange(this);\n  };\n}\n\nexport default TermsAndConditionsCallbackRenderer;\n","import {\n  AttributeInputCallback,\n  Auth,\n  AuthResponse,\n  Callback,\n  CallbackContainer,\n  CallbackType,\n  ChoiceCallback,\n  Config,\n  ConfigOptions,\n  ConfirmationCallback,\n  defaultMessageCreator,\n  Dispatcher,\n  ErrorCode,\n  FailureDetail,\n  FRAuth,\n  FRCallback,\n  FRCallbackFactory,\n  FRLoginFailure,\n  FRLoginSuccess,\n  FRPolicy,\n  FRStep,\n  FRStepHandler,\n  FRUser,\n  FRWebAuthn,\n  GetAuthorizationUrlOptions,\n  GetOAuth2TokensOptions,\n  GetTokensOptions,\n  HiddenValueCallback,\n  HttpClient,\n  KbaCreateCallback,\n  Listener,\n  LocalStorage,\n  MessageCreator,\n  MetadataCallback,\n  NameCallback,\n  NameValue,\n  OAuth2Client,\n  OAuth2Tokens,\n  PasswordCallback,\n  PKCE,\n  PolicyKey,\n  PolicyRequirement,\n  PollingWaitCallback,\n  ProcessedPropertyError,\n  ReCaptchaCallback,\n  RelyingParty,\n  SessionManager,\n  Step,\n  StepDetail,\n  StepType,\n  TermsAndConditionsCallback,\n  TextOutputCallback,\n  TokenManager,\n  Tokens,\n  TokenStorage,\n  UserManager,\n  ValidatedCreatePasswordCallback,\n  ValidatedCreateUsernameCallback,\n  ValidConfigOptions,\n  WebAuthnAuthenticationMetadata,\n  WebAuthnCallbacks,\n  WebAuthnOutcome,\n  WebAuthnRegistrationMetadata,\n  WebAuthnStepType,\n} from '@forgerock/javascript-sdk';\nimport basicStepHandlerFactory, { BasicStepHandler } from './basic';\nimport { CallbackRenderer } from './basic/interfaces';\nimport BooleanAttributeCallbackRenderer from './basic/renderers/boolean';\nimport ChoiceCallbackRenderer from './basic/renderers/choice';\nimport ConfirmationCallbackRenderer from './basic/renderers/confirmation';\nimport GenericCallbackRenderer from './basic/renderers/generic';\nimport KbaCreateCallbackRenderer from './basic/renderers/kba-create';\nimport PasswordCallbackRenderer from './basic/renderers/password';\nimport PollingWaitCallbackRenderer from './basic/renderers/polling-wait';\nimport ReCaptchaCallbackRenderer from './basic/renderers/recaptcha';\nimport TermsAndConditionsCallbackRenderer from './basic/renderers/terms';\nimport expressStepHandlerFactory from './express';\nimport FRStepHandlerBase from './fr-step-handler-base';\nimport FRUI, { FRUIOptions } from './fr-ui';\nimport {\n  FRAnyStep,\n  FREndStep,\n  FREvent,\n  FRUIStepHandler,\n  FRUIStepHandlerFactory,\n  StepChangeEvent,\n} from './interfaces';\n\nexport {\n  basicStepHandlerFactory,\n  defaultMessageCreator,\n  expressStepHandlerFactory,\n  AttributeInputCallback,\n  Auth,\n  AuthResponse,\n  BasicStepHandler,\n  BooleanAttributeCallbackRenderer,\n  Callback,\n  CallbackContainer,\n  CallbackRenderer,\n  CallbackType,\n  ChoiceCallback,\n  ChoiceCallbackRenderer,\n  Config,\n  ConfigOptions,\n  ConfirmationCallback,\n  ConfirmationCallbackRenderer,\n  Dispatcher,\n  ErrorCode,\n  FailureDetail,\n  FRAnyStep,\n  FRAuth,\n  FRCallback,\n  FRCallbackFactory,\n  FREndStep,\n  FREvent,\n  FRLoginFailure,\n  FRLoginSuccess,\n  FRPolicy,\n  FRStep,\n  FRStepHandler,\n  FRStepHandlerBase,\n  FRUI,\n  FRUIOptions,\n  FRUIStepHandler,\n  FRUIStepHandlerFactory,\n  FRUser,\n  FRWebAuthn,\n  GenericCallbackRenderer,\n  GetAuthorizationUrlOptions,\n  GetOAuth2TokensOptions,\n  GetTokensOptions,\n  HiddenValueCallback,\n  HttpClient,\n  KbaCreateCallback,\n  KbaCreateCallbackRenderer,\n  Listener,\n  LocalStorage,\n  MessageCreator,\n  MetadataCallback,\n  NameCallback,\n  NameValue,\n  OAuth2Client,\n  OAuth2Tokens,\n  PasswordCallback,\n  PasswordCallbackRenderer,\n  PKCE,\n  PolicyKey,\n  PolicyRequirement,\n  PollingWaitCallback,\n  PollingWaitCallbackRenderer,\n  ProcessedPropertyError,\n  ReCaptchaCallback,\n  ReCaptchaCallbackRenderer,\n  RelyingParty,\n  SessionManager,\n  Step,\n  StepChangeEvent,\n  StepDetail,\n  StepType,\n  TermsAndConditionsCallback,\n  TermsAndConditionsCallbackRenderer,\n  TextOutputCallback,\n  TokenManager,\n  Tokens,\n  TokenStorage,\n  UserManager,\n  ValidatedCreatePasswordCallback,\n  ValidatedCreateUsernameCallback,\n  ValidConfigOptions,\n  WebAuthnAuthenticationMetadata,\n  WebAuthnCallbacks,\n  WebAuthnOutcome,\n  WebAuthnRegistrationMetadata,\n  WebAuthnStepType,\n};\n","import {\n  AttributeInputCallback,\n  CallbackType,\n  ChoiceCallback,\n  ConfirmationCallback,\n  FRCallback,\n  FRStep,\n  KbaCreateCallback,\n  PasswordCallback,\n  PollingWaitCallback,\n  ReCaptchaCallback,\n  TermsAndConditionsCallback,\n  TextOutputCallback,\n  ValidatedCreatePasswordCallback,\n} from '@forgerock/javascript-sdk';\nimport { FRUIStepHandler } from '../../interfaces';\nimport Deferred from '../../util/deferred';\nimport { el } from '../../util/dom';\nimport {\n  CallbackRenderer,\n  CallbackRendererFactory,\n  DestroyableCallbackRenderer,\n  FocusableCallbackRenderer,\n} from '../interfaces';\nimport BooleanAttributeCallbackRenderer from '../renderers/boolean';\nimport ChoiceCallbackRenderer from '../renderers/choice';\nimport ConfirmationCallbackRenderer from '../renderers/confirmation';\nimport GenericCallbackRenderer from '../renderers/generic';\nimport KbaCreateCallbackRenderer from '../renderers/kba-create';\nimport PasswordCallbackRenderer from '../renderers/password';\nimport PollingWaitCallbackRenderer from '../renderers/polling-wait';\nimport ReCaptchaCallbackRenderer from '../renderers/recaptcha';\nimport TermsAndConditionsCallbackRenderer from '../renderers/terms';\nimport TextOutputCallbackRenderer from '../renderers/text';\nimport template from '../views/form.html';\n\n/**\n * Handler that creates generic renderers for each supported callback.  This is the default\n * when creating a new `FRUI` instance.\n */\nclass BasicStepHandler implements FRUIStepHandler {\n  private submit?: HTMLButtonElement;\n  private container: HTMLDivElement;\n  private renderers!: CallbackRenderer[];\n\n  private callbacksThatDontRequireSubmitButton = [\n    CallbackType.ConfirmationCallback,\n    CallbackType.PollingWaitCallback,\n    // TODO: Update when core SDK supports this callback type\n    'RedirectCallback',\n  ];\n\n  /**\n   * The deferred Promise that resolves the step when it's ready to submit.\n   */\n  protected deferred: Deferred<FRStep>;\n\n  /**\n   * Creates a new BasicStepHandler object.\n   *\n   * @param target The HTML element to render callbacks into\n   * @param step The step that contains callbacks to render\n   * @param rendererFactory A factory to override rendering of specific callbacks\n   */\n  constructor(\n    private target: HTMLElement,\n    private step: FRStep,\n    private rendererFactory?: CallbackRendererFactory,\n  ) {\n    this.container = el('div');\n    this.container.innerHTML = template;\n    this.deferred = new Deferred<FRStep>();\n  }\n\n  /**\n   * Renders all callbacks in the step and returns a Promise that is resolved when the step is\n   * ready to be submitted.\n   */\n  public completeStep = (): Promise<FRStep> => {\n    // Start with the HTML template\n    this.target.innerHTML = '';\n    this.container = el('div');\n    this.container.innerHTML = template;\n\n    // Locate containers for input fields and buttons\n    const formTarget = this.container.querySelector('.fr-form');\n    const buttonTarget = this.container.querySelector('.fr-buttons');\n    if (!formTarget || !buttonTarget) {\n      throw new Error(`Required form targets not found in basic handler view`);\n    }\n\n    this.setHeader();\n\n    // Render callbacks\n    this.renderers = this.createRenderers();\n    this.renderers.forEach((x) => {\n      formTarget.appendChild(x.render());\n    });\n\n    // Add everything to the DOM\n    this.target.appendChild(this.container);\n\n    // Focus on the first relevant callback\n    const firstFocusable = this.renderers.find((x) => !!x.focus);\n    if (firstFocusable !== undefined) {\n      (firstFocusable as FocusableCallbackRenderer).focus();\n    }\n\n    // Notify renderers to perform any post-injection actions\n    this.renderers.filter((x) => !!x.onInjected).forEach((x) => x.onInjected && x.onInjected());\n\n    // Add the submit button if necessary\n    if (this.requiresSubmitButton()) {\n      this.submit = this.createSubmitButton();\n      buttonTarget.appendChild(this.submit);\n    }\n\n    return this.deferred.promise;\n  };\n\n  private setHeader = (): void => {\n    const h1 = this.container.querySelector('h1');\n    if (h1) {\n      h1.innerHTML = this.step.getHeader() || '';\n    }\n  };\n\n  private createRenderers = (): CallbackRenderer[] => {\n    const renderers = this.step.callbacks.map(this.createRenderer);\n    return renderers;\n  };\n\n  private createRenderer = (cb: FRCallback, index: number): CallbackRenderer => {\n    if (this.rendererFactory) {\n      const renderer = this.rendererFactory(cb, index, this.step, this.onChange);\n      if (renderer) return renderer;\n    }\n\n    switch (cb.getType()) {\n      case CallbackType.BooleanAttributeInputCallback:\n        const attrCallback = cb as AttributeInputCallback<boolean>;\n        return new BooleanAttributeCallbackRenderer(attrCallback, index, this.onChange);\n\n      case CallbackType.ChoiceCallback:\n        const choiceCallback = cb as ChoiceCallback;\n        return new ChoiceCallbackRenderer(choiceCallback, index, this.onChange);\n\n      case CallbackType.ConfirmationCallback:\n        return new ConfirmationCallbackRenderer(cb as ConfirmationCallback, index, this.onChange);\n\n      case CallbackType.PasswordCallback:\n        return new PasswordCallbackRenderer(cb as PasswordCallback, index, this.onChange);\n\n      case CallbackType.ValidatedCreatePasswordCallback:\n        const passwordCallback = cb as ValidatedCreatePasswordCallback;\n        return new PasswordCallbackRenderer(passwordCallback, index, this.onChange);\n\n      case CallbackType.PollingWaitCallback:\n        return new PollingWaitCallbackRenderer(cb as PollingWaitCallback, index, this.onChange);\n\n      case CallbackType.ReCaptchaCallback:\n        return new ReCaptchaCallbackRenderer(cb as ReCaptchaCallback, index, this.onChange);\n\n      case CallbackType.TermsAndConditionsCallback:\n        const termsCallback = cb as TermsAndConditionsCallback;\n        return new TermsAndConditionsCallbackRenderer(termsCallback, index, this.onChange);\n\n      case CallbackType.TextOutputCallback:\n        return new TextOutputCallbackRenderer(cb as TextOutputCallback, index);\n\n      case CallbackType.KbaCreateCallback:\n        const kbaCreateCallback = cb as KbaCreateCallback;\n        const kbaIndex = this.step\n          .getCallbacksOfType<KbaCreateCallback>(CallbackType.KbaCreateCallback)\n          .filter((x) => x.getPrompt() === kbaCreateCallback.getPrompt())\n          .indexOf(kbaCreateCallback);\n        return new KbaCreateCallbackRenderer(kbaCreateCallback, index, kbaIndex, this.onChange);\n\n      default:\n        return new GenericCallbackRenderer(cb, index, this.onChange);\n    }\n  };\n\n  private onChange = (): void => {\n    const isValid = this.isValid();\n    this.setSubmitButton(isValid);\n\n    /**\n     * Automatically resolve if there's no submit button and a callback change occurs.\n     * This is expected for callbacks like polling wait.\n     */\n    if (!this.submit && isValid) {\n      this.resolve();\n    }\n  };\n\n  private requiresSubmitButton = (): boolean => {\n    const intersection = this.step.callbacks.filter((x) =>\n      this.callbacksThatDontRequireSubmitButton.includes(x.getType()),\n    );\n    return intersection.length === 0;\n  };\n\n  private createSubmitButton = (): HTMLButtonElement => {\n    const button = el<HTMLButtonElement>('button', 'btn btn-primary');\n    button.disabled = !this.isValid();\n    button.id = 'fr-submit';\n    button.innerText = 'Next';\n    button.addEventListener('click', this.resolve);\n    return button;\n  };\n\n  private isValid = (): boolean => {\n    const isInvalid = (x: CallbackRenderer): boolean => x.isValid !== undefined && !x.isValid();\n    return !this.renderers.some(isInvalid);\n  };\n\n  private setSubmitButton = (isValid?: boolean): void => {\n    if (this.submit) {\n      this.submit.disabled = isValid !== undefined ? !isValid : !this.isValid();\n    }\n  };\n\n  private resolve = (): void => {\n    this.renderers\n      .filter((x) => !!x.destroy)\n      .forEach((x) => (x as DestroyableCallbackRenderer).destroy());\n\n    if (this.submit) {\n      this.submit.disabled = true;\n      this.submit.removeEventListener('click', this.resolve);\n    }\n\n    this.deferred.resolve(this.step);\n  };\n}\n\nexport default BasicStepHandler;\n","import { TextOutputCallback } from '@forgerock/javascript-sdk';\nimport { el } from '../../util/dom';\n\n/**\n * Renders the content of the Terms and Conditions, along with a labeled checkbox\n * that indicates agreement.\n */\nclass TextOutputCallbackRenderer {\n  /**\n   * @param callback The callback to render\n   * @param index The index position in the step's callback array\n   * @param onChange A function to call when the callback value is changed\n   */\n  constructor(private callback: TextOutputCallback, private index: number) {}\n\n  /**\n   * Creates all required DOM elements and returns the containing element.\n   */\n  public render = (): HTMLDivElement => {\n    const formGroup = el<HTMLDivElement>('div', `fr-callback-${this.index} form-group`);\n\n    // Add the message\n    const p = el<HTMLParagraphElement>('p');\n    p.innerHTML = this.callback.getMessage();\n    formGroup.appendChild(p);\n\n    return formGroup;\n  };\n}\n\nexport default TextOutputCallbackRenderer;\n","export default \"<main class=\\\"fr-step\\\">\\n  <section class=\\\"fr-main\\\">\\n    <header class=\\\"fr-header\\\">\\n      <h1></h1>\\n    </header>\\n    <section class=\\\"fr-form\\\">\\n    </section>\\n    <div class=\\\"fr-buttons\\\"></div>\\n  </section>\\n</main>\\n\"","import { FRStep, FRWebAuthn } from '@forgerock/javascript-sdk';\nimport { FRUIStepHandler } from '../../interfaces';\nimport Deferred from '../../util/deferred';\nimport { WebAuthnMode } from '../enums';\nimport template from '../views/webauthn.html';\n\nclass WebAuthnStepHandler implements FRUIStepHandler {\n  private message!: HTMLDivElement;\n  protected deferred: Deferred<FRStep>;\n\n  constructor(private target: HTMLElement, private step: FRStep, private mode: WebAuthnMode) {\n    this.target.innerHTML = template;\n    const messageDiv = this.target.querySelector<HTMLDivElement>('.fr-message');\n    if (!messageDiv) {\n      throw new Error(`Required targets not found in webauthn handler view`);\n    }\n\n    this.message = messageDiv;\n    this.deferred = new Deferred<FRStep>();\n  }\n\n  public completeStep = async (): Promise<FRStep> => {\n    switch (this.mode) {\n      case WebAuthnMode.Authentication:\n        this.message.innerHTML = 'Please authenticate using your device...';\n        await FRWebAuthn.authenticate(this.step);\n        this.deferred.resolve(this.step);\n        break;\n\n      case WebAuthnMode.Registration:\n        this.message.innerHTML = 'Please register your device...';\n        await FRWebAuthn.register(this.step);\n        this.deferred.resolve(this.step);\n        break;\n\n      default:\n        throw new Error(`Invalid WebAuthn mode \"${this.mode}\"`);\n    }\n\n    return this.deferred.promise;\n  };\n}\n\nexport default WebAuthnStepHandler;\n","export default \"<main class=\\\"fr-step\\\">\\n  <section class=\\\"fr-main\\\">\\n    <div class=\\\"fr-message\\\">\\n      Waiting for device...\\n    </div>\\n  </section>\\n</main>\\n\"","import { FRStep } from '@forgerock/javascript-sdk';\nimport { FRUIStepHandlerFactory } from '../interfaces';\nimport { ExpressStage } from './enums';\nimport ChoiceStepHandler from './handlers/choice';\nimport DeviceAuthenticationStepHandler from './handlers/device-authentication';\nimport DeviceRegistrationStepHandler from './handlers/device-registration';\nimport PasswordStepHandler from './handlers/password';\nimport RegistrationUserInfoStepHandler from './handlers/registration-user-info';\nimport UsernameStepHandler from './handlers/username';\nimport UsernamePasswordStepHandler from './handlers/username-password';\n\n/**\n * A factory for creating a step handler for the provided Express step.\n *\n * @param target The DOM element in which to render the step\n * @param step The step to render\n */\nconst expressStepHandlerFactory: FRUIStepHandlerFactory = (target: HTMLElement, step: FRStep) => {\n  if (!step) {\n    throw new Error('Cannot create handler; no step specified');\n  }\n\n  const stage = step.getStage();\n\n  switch (stage) {\n    case ExpressStage.DeviceRegistrationChoice:\n    case ExpressStage.PasswordlessChoice:\n    case ExpressStage.SecondFactorChoice:\n      return new ChoiceStepHandler(target, step);\n    case ExpressStage.OneTimePasswordEmail:\n    case ExpressStage.OneTimePasswordSMS:\n    case ExpressStage.UserPassword:\n      return new PasswordStepHandler(target, step);\n    case ExpressStage.Username:\n      return new UsernameStepHandler(target, step);\n    case ExpressStage.UsernamePassword:\n      return new UsernamePasswordStepHandler(target, step);\n    case ExpressStage.DeviceAuthentication:\n      return new DeviceAuthenticationStepHandler(target, step);\n    case ExpressStage.DeviceRegistration:\n      return new DeviceRegistrationStepHandler(target, step);\n    case ExpressStage.RegistrationUserInfo:\n      return new RegistrationUserInfoStepHandler(target, step);\n    default:\n      throw new Error(`Unsupported stage \"${stage}\"`);\n  }\n};\n\nexport default expressStepHandlerFactory;\n","import { CallbackType, ChoiceCallback } from '@forgerock/javascript-sdk';\nimport FRStepHandlerBase from '../../fr-step-handler-base';\nimport { replaceTokens } from '../../util/template';\nimport { ExpressStage } from '../enums';\nimport deviceRegistrationTemplate from '../views/device-registration-choice.html';\nimport passwordlessTemplate from '../views/passwordless-choice.html';\nimport secondFactorTemplate from '../views/second-factor-choice.html';\n\n/** @hidden */\nconst ATTR_NAME = 'data-choice';\n\n/** @hidden */\ninterface IconText {\n  icon: string;\n  text: string;\n}\n\n/**\n * Handler that renders the three different uses of a choice collector in Express:\n * - Prompt to register a security device\n * - Prompt to \"go passwordless\"\n * - Prompt to select method to receive second factor\n */\nclass ChoiceStepHandler extends FRStepHandlerBase {\n  /** @hidden */\n  public retry = undefined;\n\n  protected bind = (): void => {\n    this.target.addEventListener('click', this.onClick);\n  };\n\n  protected unbind = (): void => {\n    this.target.removeEventListener('click', this.onClick);\n  };\n\n  protected getTemplate = (): string => {\n    switch (this.step.getStage()) {\n      case ExpressStage.DeviceRegistrationChoice:\n        return deviceRegistrationTemplate;\n      case ExpressStage.PasswordlessChoice:\n        return passwordlessTemplate;\n      case ExpressStage.SecondFactorChoice:\n        return this.renderSecondFactorChoiceTemplate(secondFactorTemplate);\n    }\n    throw new Error(`Unsupported choice type \"${this.step.getStage()}\"`);\n  };\n\n  private onClick = (e: MouseEvent): void => {\n    const attributeValue = (e.srcElement as HTMLElement).getAttribute(ATTR_NAME);\n    if (attributeValue === null) {\n      return;\n    }\n\n    const choiceIndex = Number(attributeValue);\n    const callback = this.getCallback();\n    callback.setChoiceIndex(choiceIndex);\n    this.unbind();\n    this.deferred.resolve(this.step);\n  };\n\n  private renderSecondFactorChoiceTemplate = (template: string): string => {\n    const callback = this.getCallback();\n    const choices = callback.getChoices();\n    const model = this.updateChoiceStrings(choices);\n    const choicesMarkup = this.getChoicesMarkup(model);\n    const subtitleMarkup = this.getSubtitleMarkup(model.length);\n    const dataTemplate = replaceTokens(template, {\n      CHOICES: choicesMarkup,\n      SUBTITLE: subtitleMarkup,\n    });\n    return dataTemplate;\n  };\n\n  private getSubtitleMarkup(numChoices: number): string {\n    return numChoices === 3\n      ? \"<p>You'll need to verify it's you to continue signing in to your account.</p>\"\n      : \"<p>You'll need a verification code to continue signing in to your account.</p>\";\n  }\n\n  private getChoicesMarkup(choices: IconText[]): string {\n    return `<ul class=\"fr-list\">\n    ${choices\n      .map(\n        (x: IconText, i: number) =>\n          `<li class=\"fr-list-item fr-icon-list-${x.icon}\" data-choice=\"${i}\">${x.text}</li>`,\n      )\n      .join('')}</ul>`;\n  }\n\n  private updateChoiceStrings(choices: string[]): IconText[] {\n    const twoChoices = choices.length === 2 ? true : false;\n    return choices.map((choice) => {\n      const icon = choice.toLowerCase();\n      switch (choice) {\n        case 'Device':\n          return { icon, text: 'Use your device' };\n        case 'Email':\n          return { icon, text: `${twoChoices ? 'Receive an email' : 'Email a code'}` };\n        case 'SMS':\n          return { icon, text: `${twoChoices ? 'Receive a text' : 'Text a code'}` };\n        default:\n          throw new Error(`Unsupported choice \"${choice}\"`);\n      }\n    });\n  }\n\n  private getCallback = (): ChoiceCallback => {\n    return this.step.getCallbackOfType<ChoiceCallback>(CallbackType.ChoiceCallback);\n  };\n}\n\nexport default ChoiceStepHandler;\n","const replaceTokens = (s: string, tokens: { [key: string]: string }): string => {\n  for (const k in tokens) {\n    if (tokens.hasOwnProperty(k)) {\n      s = s.replace(new RegExp(`{${k}}`, 'g'), tokens[k]);\n    }\n  }\n  return s;\n};\n\nexport { replaceTokens };\n","export default \"<main class=\\\"fr-step fr-choice\\\">\\n  <section class=\\\"fr-main\\\">\\n    <header class=\\\"fr-header\\\">\\n      <h1>Use device sign-in</h1>\\n      <i class=\\\"fr-icon fr-icon-web-authn\\\"></i>\\n      <p>Use your device's security features to sign in.</p>\\n    </header>\\n    <section class=\\\"fr-form\\\">\\n      <div class=\\\"fr-input-group\\\">\\n        <button type=\\\"button\\\" class=\\\"btn btn-primary\\\" data-choice=\\\"0\\\">\\n          Turn on device sign in\\n        </button>\\n      </div>\\n      <button type=\\\"button\\\" class=\\\"btn btn-primary mt-3\\\" data-choice=\\\"1\\\">\\n        More ways to sign in\\n      </button>\\n    </section>\\n  </section>\\n</main>\"","export default \"<main class=\\\"fr-step fr-choice\\\">\\n  <section class=\\\"fr-main\\\">\\n    <header class=\\\"fr-header\\\">\\n      <h1>Go passwordless</h1>\\n      <i class=\\\"fr-icon fr-icon-web-authn\\\"></i>\\n      <p>Never enter your password again by using your device's security features to sign in.</p>\\n    </header>\\n    <section class=\\\"fr-form\\\">\\n      <div class=\\\"fr-input-group\\\">\\n        <button type=\\\"button\\\" class=\\\"btn btn-primary\\\" data-choice=\\\"0\\\">\\n          Set up passwordless\\n        </button>\\n      </div>\\n      <button type=\\\"button\\\" class=\\\"btn btn-primary mt-3\\\" data-choice=\\\"1\\\">\\n        Skip this\\n      </button>\\n    </section>\\n  </section>\\n</main>\\n\"","export default \"<main class=\\\"fr-step fr-choice\\\">\\n  <section class=\\\"fr-main\\\">\\n    <header class=\\\"fr-header\\\">\\n      <h1>2-step verification</h1>\\n      <i class=\\\"fr-icon fr-icon-check-user\\\"></i>\\n      {SUBTITLE}\\n    </header>\\n  </section>\\n  <section class=\\\"fr-form\\\">\\n    <section>\\n      {CHOICES}\\n    </section>\\n  </section>\\n</main>\\n\"","import { FRWebAuthn } from '@forgerock/javascript-sdk';\nimport FRStepHandlerBase from '../../fr-step-handler-base';\nimport template from '../views/device-authentication.html';\n\n/**\n * Handler that renders a WebAuthn authentication step in Express.\n */\nclass DeviceAuthenticationStepHandler extends FRStepHandlerBase {\n  private heading!: HTMLHeadingElement;\n\n  /** @hidden */\n  public retry = undefined;\n\n  protected getRefs = (): void => {\n    this.heading = this.findElement('h2');\n  };\n\n  protected render = (): void => {\n    this.target.innerHTML = template;\n    this.invokeWebAuthn();\n  };\n\n  protected invokeWebAuthn = async (): Promise<void> => {\n    this.heading.innerHTML = 'Confirming device credentials...';\n    const result = await FRWebAuthn.authenticate(this.step);\n    this.deferred.resolve(result);\n  };\n}\n\nexport default DeviceAuthenticationStepHandler;\n","export default \"<main class=\\\"fr-step fr-device-authentication\\\">\\n  <section class=\\\"fr-main\\\">\\n    <header class=\\\"fr-header\\\">\\n      <div class=\\\"fr-spinner\\\"></div>\\n      <h2>Waiting for device...</h2>\\n    </header>\\n  </section>\\n</main>\\n\"","import { FRWebAuthn } from '@forgerock/javascript-sdk';\nimport FRStepHandlerBase from '../../fr-step-handler-base';\nimport template from '../views/device-registration.html';\n\n/**\n * Handler that renders a WebAuthn registration step in Express.\n */\nclass DeviceRegistrationStepHandler extends FRStepHandlerBase {\n  private heading!: HTMLHeadingElement;\n\n  /** @hidden */\n  public retry = undefined;\n\n  protected getRefs = (): void => {\n    this.heading = this.findElement('h2');\n  };\n\n  protected render = (): void => {\n    this.target.innerHTML = template;\n    this.invokeWebAuthn();\n  };\n\n  protected invokeWebAuthn = async (): Promise<void> => {\n    this.heading.innerHTML = 'Acquiring device credentials...';\n    const result = await FRWebAuthn.register(this.step);\n    this.deferred.resolve(result);\n  };\n}\n\nexport default DeviceRegistrationStepHandler;\n","export default \"<main class=\\\"fr-step fr-device-registration\\\">\\n  <section class=\\\"fr-main\\\">\\n    <header class=\\\"fr-header\\\">\\n      <div class=\\\"fr-spinner\\\"></div>\\n      <h2>Waiting for device...</h2>\\n    </header>\\n  </section>\\n</main>\\n\"","import { CallbackType, FRStep } from '@forgerock/javascript-sdk';\nimport Button from '../../components/button';\nimport PasswordInput from '../../components/password-input';\nimport FRStepHandlerBase from '../../fr-step-handler-base';\nimport Deferred from '../../util/deferred';\nimport { ExpressStage } from '../enums';\nimport oneTimeEmailTemplate from '../views/one-time-password-email.html';\nimport oneTimeSMSTemplate from '../views/one-time-password-sms.html';\nimport userPasswordTemplate from '../views/user-password.html';\n\n/**\n * Handler that renders a password input box for the following Express steps:\n * - User password\n * - One-time password via SMS\n * - One-time password via email\n */\nclass PasswordStepHandler extends FRStepHandlerBase {\n  private password!: HTMLInputElement;\n  private submit!: Button;\n  private retryMessage!: HTMLParagraphElement;\n  private passwordInput!: PasswordInput;\n\n  /**\n   * Displays a retry message and enables the submit button.\n   */\n  public retry = (): Promise<FRStep> => {\n    this.deferred = new Deferred<FRStep>();\n    this.retryMessage.style.display = 'block';\n    this.submit.enable();\n    this.bind();\n    return this.deferred.promise;\n  };\n\n  protected bind = (): void => {\n    this.submit.bind(this.onSubmit);\n    this.passwordInput.bind();\n  };\n\n  protected unbind = (): void => {\n    this.submit.unbind(this.onSubmit);\n    this.passwordInput.unbind();\n  };\n\n  protected getRefs = (): void => {\n    this.password = this.findElement('#fr-password');\n    this.submit = new Button(this.findElement('.btn-primary'));\n    this.retryMessage = this.findElement('.fr-retry');\n    this.passwordInput = new PasswordInput(this.password);\n  };\n\n  protected getTemplate = (): string => {\n    switch (this.step.getStage()) {\n      case ExpressStage.OneTimePasswordEmail:\n        return oneTimeEmailTemplate;\n      case ExpressStage.OneTimePasswordSMS:\n        return oneTimeSMSTemplate;\n      case ExpressStage.UserPassword:\n        return userPasswordTemplate;\n    }\n    throw new Error(`Unsupported password stage \"${this.step.getStage()}\"`);\n  };\n\n  protected ready = (): void => {\n    this.password.focus();\n  };\n\n  protected onSubmit = (): void => {\n    this.submit.disable();\n    this.step.setCallbackValue(CallbackType.PasswordCallback, this.password.value);\n    this.unbind();\n    this.deferred.resolve(this.step);\n  };\n}\n\nexport default PasswordStepHandler;\n","export default \"<main class=\\\"fr-step fr-one-time-password-email\\\">\\n  <section class=\\\"fr-main\\\">\\n    <header class=\\\"fr-header\\\">\\n      <h1>2-step verification</h1>\\n      <i class=\\\"fr-icon fr-icon-twofa-email\\\"></i>\\n      <p>We've sent a code to your email</p>\\n    </header>\\n    <section class=\\\"fr-form\\\">\\n      <div class=\\\"form-group\\\">\\n        <div class=\\\"form-label-group form-label-group-password\\\">\\n          <div class=\\\"form-label-group-input\\\">\\n            <input type=\\\"password\\\" id=\\\"fr-password\\\" class=\\\"form-control\\\" placeholder=\\\"Enter code\\\" autofocus />\\n            <label for=\\\"fr-password\\\">Enter code</label>\\n          </div>\\n          <div class=\\\"input-group-append\\\">\\n            <button class=\\\"btn btn-outline-secondary\\\" type=\\\"button\\\"><i\\n                class=\\\"material-icons material-icons-outlined\\\">visibility_off</i></button>\\n          </div>\\n        </div>\\n      </div>\\n    </section>\\n    <button type=\\\"button\\\" class=\\\"btn btn-primary\\\">Next</button>\\n  </section>\\n  <div class=\\\"fr-error fr-retry\\\">\\n    <div class=\\\"fr-alert\\\">Sorry that isnt right. Try again.</div>\\n  </div>\\n  <footer class=\\\"fr-footer\\\">\\n    <nav>\\n      <ul>\\n        <li><a href=\\\"#\\\">More ways to sign in</a></li>\\n      </ul>\\n    </nav>\\n  </footer>\\n</main>\"","export default \"<main class=\\\"fr-step fr-one-time-password-sms\\\">\\n  <section class=\\\"fr-main\\\">\\n    <header class=\\\"fr-header\\\">\\n      <h1>2-step verification</h1>\\n      <i class=\\\"fr-icon fr-icon-twofa-sms\\\"></i>\\n      <p>We've sent a code to your phone</p>\\n    </header>\\n    <section class=\\\"fr-form\\\">\\n      <div class=\\\"form-group\\\">\\n        <div class=\\\"form-label-group form-label-group-password\\\">\\n          <div class=\\\"form-label-group-input\\\">\\n            <input type=\\\"password\\\" id=\\\"fr-password\\\" class=\\\"form-control\\\" placeholder=\\\"Enter code\\\" autofocus />\\n            <label for=\\\"fr-password\\\">Enter code</label>\\n          </div>\\n          <div class=\\\"input-group-append\\\">\\n            <button class=\\\"btn btn-outline-secondary\\\" type=\\\"button\\\">\\n              <i class=\\\"material-icons material-icons-outlined\\\">visibility_off</i>\\n            </button>\\n          </div>\\n        </div>\\n      </div>\\n    </section>\\n    <button type=\\\"button\\\" class=\\\"btn btn-primary\\\">Next</button>\\n  </section>\\n  <div class=\\\"fr-error fr-retry\\\">\\n    <div class=\\\"fr-alert\\\">Sorry that isnt right. Try again.</div>\\n  </div>\\n  <footer class=\\\"fr-footer\\\">\\n    <nav>\\n      <ul>\\n        <li><a href=\\\"#\\\">More ways to sign in</a></li>\\n      </ul>\\n    </nav>\\n  </footer>\\n</main>\\n\"","export default \"<main class=\\\"fr-step fr-username-password\\\">\\n  <section class=\\\"fr-main\\\">\\n    <header class=\\\"fr-header\\\">\\n      <h1>Sign in</h1>\\n    </header>\\n    <section class=\\\"fr-form\\\">\\n      <div class=\\\"form-group\\\">\\n        <div class=\\\"form-label-group form-label-group-password\\\">\\n          <div class=\\\"form-label-group-input\\\">\\n            <input type=\\\"password\\\" id=\\\"fr-password\\\" class=\\\"form-control\\\" placeholder=\\\"Password\\\" autofocus />\\n            <label for=\\\"fr-password\\\">Password</label>\\n          </div>\\n          <div class=\\\"input-group-append\\\">\\n            <button class=\\\"btn btn-outline-secondary\\\" type=\\\"button\\\"><i\\n                class=\\\"material-icons material-icons-outlined\\\">visibility_off</i></button>\\n          </div>\\n        </div>\\n      </div>\\n    </section>\\n    <button type=\\\"button\\\" class=\\\"btn btn-primary\\\">Next</button>\\n    <div class=\\\"fr-error fr-retry\\\">\\n      <div class=\\\"fr-alert\\\">Sorry that isnt right. Try again.</div>\\n    </div>\\n  </section>\\n</main>\"","import { AttributeInputCallback, CallbackType, FRStep } from '@forgerock/javascript-sdk';\nimport Button from '../../components/button';\nimport PasswordInput from '../../components/password-input';\nimport FRStepHandlerBase from '../../fr-step-handler-base';\nimport Deferred from '../../util/deferred';\nimport template from '../views/registration.html';\n\n/**\n * Handler that renders inputs for username and password in an Express step, as well as\n * inputs for each optional attribute being collected.\n */\nclass RegistrationUserInfoStepHandler extends FRStepHandlerBase {\n  private username!: HTMLInputElement;\n  private password!: HTMLInputElement;\n  private passwordInput!: PasswordInput;\n  private retryMessage!: HTMLParagraphElement;\n  private submit!: Button;\n\n  /**\n   * Displays a retry message and enables the submit button.\n   */\n  public retry = (): Promise<FRStep> => {\n    this.deferred = new Deferred<FRStep>();\n    this.retryMessage.style.display = 'block';\n    this.submit.enable();\n    this.bind();\n    return this.deferred.promise;\n  };\n\n  protected bind = (): void => {\n    this.passwordInput.bind();\n    this.submit.bind(this.onSubmit);\n  };\n\n  protected unbind = (): void => {\n    this.passwordInput.unbind();\n    this.submit.unbind(this.onSubmit);\n  };\n\n  protected getRefs = (): void => {\n    this.username = this.findElement('#fr-username');\n    this.password = this.findElement('#fr-password');\n    this.passwordInput = new PasswordInput(this.password);\n    this.retryMessage = this.findElement('.fr-retry');\n    this.submit = new Button(this.findElement('.btn-primary'));\n    this.addAttributeInputs();\n  };\n\n  protected getTemplate = (): string => {\n    return template;\n  };\n\n  protected ready = (): void => {\n    this.username.focus();\n  };\n\n  protected addAttributeInputs = (): void => {\n    const container = this.findElement('#fr-attributes');\n    const callbacks = this.step.getCallbacksOfType<AttributeInputCallback<string>>(\n      CallbackType.StringAttributeInputCallback,\n    );\n\n    const formGroups: HTMLDivElement[] = [];\n    for (const cb of callbacks) {\n      const name = cb.getName();\n      const prompt = cb.getPrompt();\n      if (name && prompt) {\n        const formGroup = document.createElement('div');\n        formGroup.className = 'form-group';\n\n        const formLabel = document.createElement('div');\n        formLabel.className = 'form-label-group mb-0';\n\n        const input = document.createElement('input');\n        input.className = 'form-control';\n        input.id = `fr-${name}`;\n        input.name = name;\n        input.placeholder = prompt;\n        input.required = true;\n        input.type = 'text';\n\n        const label = document.createElement('label');\n        label.htmlFor = input.id;\n        label.innerHTML = prompt;\n\n        formLabel.append(input);\n        formLabel.append(label);\n        formGroup.append(formLabel);\n\n        formGroups.push(formGroup);\n      }\n    }\n\n    while (container.firstChild) {\n      container.removeChild(container.firstChild);\n    }\n\n    container.append(...formGroups);\n  };\n\n  protected onSubmit = async (): Promise<void> => {\n    this.submit.disable('Registering...');\n\n    this.step.setCallbackValue(CallbackType.ValidatedCreateUsernameCallback, this.username.value);\n    this.step.setCallbackValue(CallbackType.ValidatedCreatePasswordCallback, this.password.value);\n\n    const callbacks = this.step.getCallbacksOfType<AttributeInputCallback<string>>(\n      CallbackType.StringAttributeInputCallback,\n    );\n\n    for (const cb of callbacks) {\n      const name = cb.getName();\n      if (name) {\n        const elem = this.findElement<HTMLInputElement>(`#fr-${name}`);\n        if (elem) {\n          cb.setInputValue(elem.value);\n        }\n      }\n    }\n\n    this.unbind();\n    this.deferred.resolve(this.step);\n  };\n}\n\nexport default RegistrationUserInfoStepHandler;\n","export default \"<main class=\\\"fr-user\\\">\\n  <section class=\\\"fr-main\\\">\\n    <header class=\\\"fr-header\\\">\\n      <h1>Create an Account</h1>\\n    </header>\\n    <form class=\\\"fr-form\\\">\\n      <div class=\\\"form-group\\\">\\n        <div class=\\\"form-label-group mb-0\\\">\\n          <input required class=\\\"form-control\\\" id=\\\"fr-username\\\" type=\\\"text\\\" name=\\\"username\\\" placeholder=\\\"Username\\\"\\n            autofocus />\\n          <label for=\\\"fr-username\\\">Username</label>\\n        </div>\\n      </div>\\n      <div class=\\\"form-group\\\">\\n        <div class=\\\"form-label-group form-label-group-password\\\">\\n          <div class=\\\"form-label-group-input\\\">\\n            <input type=\\\"password\\\" id=\\\"fr-password\\\" class=\\\"form-control\\\" placeholder=\\\"Password\\\" />\\n            <label for=\\\"fr-password\\\">Password</label>\\n          </div>\\n          <div class=\\\"input-group-append\\\">\\n            <button class=\\\"btn btn-outline-secondary\\\" type=\\\"button\\\"><i\\n                class=\\\"material-icons material-icons-outlined\\\">visibility_off</i></button>\\n          </div>\\n        </div>\\n      </div>\\n      <div id=\\\"fr-attributes\\\"></div>\\n    </form>\\n    <button type=\\\"button\\\" class=\\\"btn btn-primary\\\">Register</button>\\n    <div class=\\\"fr-error fr-retry\\\">\\n      <div class=\\\"fr-alert\\\">Sorry that isnt right. Try again.</div>\\n    </div>\\n  </section>\\n</main>\"","import { CallbackType, FRStep } from '@forgerock/javascript-sdk';\nimport Button from '../../components/button';\nimport FRStepHandlerBase from '../../fr-step-handler-base';\nimport Deferred from '../../util/deferred';\nimport template from '../views/username.html';\n\n/**\n * Handler that renders an input for username in an Express step.\n */\nclass UsernameStepHandler extends FRStepHandlerBase {\n  private username!: HTMLInputElement;\n  private retryMessage!: HTMLParagraphElement;\n  private submit!: Button;\n\n  /**\n   * Displays a retry message and enables the submit button.\n   */\n  public retry = (): Promise<FRStep> => {\n    this.deferred = new Deferred<FRStep>();\n    this.retryMessage.style.display = 'block';\n    this.submit.enable();\n    this.bind();\n    return this.deferred.promise;\n  };\n\n  protected bind = (): void => {\n    this.submit.bind(this.onSubmit);\n  };\n\n  protected unbind = (): void => {\n    this.submit.unbind(this.onSubmit);\n  };\n\n  protected getRefs = (): void => {\n    this.retryMessage = this.findElement('.fr-retry');\n    this.submit = new Button(this.findElement('.btn-primary'));\n    this.username = this.findElement('#fr-username');\n  };\n\n  protected getTemplate = (): string => {\n    return template;\n  };\n\n  protected ready = (): void => {\n    this.username.focus();\n  };\n\n  protected onSubmit = (): void => {\n    this.submit.disable();\n    this.step.setCallbackValue(CallbackType.NameCallback, this.username.value);\n    this.unbind();\n    this.deferred.resolve(this.step);\n  };\n}\n\nexport default UsernameStepHandler;\n","export default \"<main class=\\\"fr-step fr-username\\\">\\n  <section class=\\\"fr-main\\\">\\n    <header class=\\\"fr-header\\\">\\n      <h1>Sign in</h1>\\n    </header>\\n    <section class=\\\"fr-form\\\">\\n      <div class=\\\"form-group\\\">\\n        <div class=\\\"form-label-group mb-0\\\">\\n          <input required class=\\\"form-control\\\" id=\\\"fr-username\\\" type=\\\"text\\\" name=\\\"username\\\" placeholder=\\\"Username\\\"\\n            autofocus />\\n          <label for=\\\"fr-username\\\">Username</label>\\n        </div>\\n      </div>\\n    </section>\\n    <button type=\\\"button\\\" class=\\\"btn btn-primary\\\">Next</button>\\n    <div class=\\\"fr-error fr-retry\\\">\\n      <div class=\\\"fr-alert\\\">Sorry that isnt right. Try again.</div>\\n    </div>\\n  </section>\\n</main>\"","import { CallbackType, FRStep } from '@forgerock/javascript-sdk';\nimport Button from '../../components/button';\nimport PasswordInput from '../../components/password-input';\nimport FRStepHandlerBase from '../../fr-step-handler-base';\nimport Deferred from '../../util/deferred';\nimport template from '../views/username-password.html';\n\n/**\n * Handler that renders inputs for username and password in an Express step.\n */\nclass UsernamePasswordStepHandler extends FRStepHandlerBase {\n  private password!: HTMLInputElement;\n  private retryMessage!: HTMLParagraphElement;\n  private submit!: Button;\n  private username!: HTMLInputElement;\n  private passwordInput!: PasswordInput;\n\n  /**\n   * Displays a retry message and enables the submit button.\n   */\n  public retry = (): Promise<FRStep> => {\n    this.deferred = new Deferred<FRStep>();\n    this.retryMessage.style.display = 'block';\n    this.submit.enable();\n    this.bind();\n    return this.deferred.promise;\n  };\n\n  protected bind = (): void => {\n    this.submit.bind(this.onSubmit);\n    this.passwordInput.bind();\n  };\n\n  protected unbind = (): void => {\n    this.submit.unbind(this.onSubmit);\n    this.passwordInput.unbind();\n  };\n\n  protected getRefs = (): void => {\n    this.username = this.findElement('#fr-username');\n    this.password = this.findElement('#fr-password');\n    this.retryMessage = this.findElement('.fr-retry');\n    this.submit = new Button(this.findElement('.btn-primary'));\n    this.passwordInput = new PasswordInput(this.password);\n  };\n\n  protected getTemplate = (): string => {\n    return template;\n  };\n\n  protected ready = (): void => {\n    this.username.focus();\n  };\n\n  protected onSubmit = (): void => {\n    this.submit.disable();\n    this.step.setCallbackValue(CallbackType.NameCallback, this.username.value);\n    this.step.setCallbackValue(CallbackType.PasswordCallback, this.password.value);\n    this.unbind();\n\n    this.deferred.resolve(this.step);\n  };\n}\n\nexport default UsernamePasswordStepHandler;\n","export default \"<main class=\\\"fr-step fr-username-password\\\">\\n  <section class=\\\"fr-main\\\">\\n    <header class=\\\"fr-header\\\">\\n      <h1>Sign in</h1>\\n    </header>\\n    <section class=\\\"fr-form\\\">\\n      <div class=\\\"form-group\\\">\\n        <div class=\\\"form-label-group mb-0\\\">\\n          <input required class=\\\"form-control\\\" id=\\\"fr-username\\\" type=\\\"text\\\" name=\\\"username\\\" placeholder=\\\"Username\\\"\\n            autofocus />\\n          <label for=\\\"fr-username\\\">Username</label>\\n        </div>\\n      </div>\\n      <div class=\\\"form-group\\\">\\n        <div class=\\\"form-label-group form-label-group-password\\\">\\n          <div class=\\\"form-label-group-input\\\">\\n            <input type=\\\"password\\\" id=\\\"fr-password\\\" class=\\\"form-control\\\" placeholder=\\\"Password\\\" />\\n            <label for=\\\"fr-password\\\">Password</label>\\n          </div>\\n          <div class=\\\"input-group-append\\\">\\n            <button class=\\\"btn btn-outline-secondary\\\" type=\\\"button\\\"><i\\n                class=\\\"material-icons material-icons-outlined\\\">visibility_off</i></button>\\n          </div>\\n        </div>\\n      </div>\\n    </section>\\n    <button type=\\\"button\\\" class=\\\"btn btn-primary\\\">Sign In</button>\\n  </section>\\n  <div class=\\\"fr-error fr-retry\\\">\\n    <div class=\\\"fr-alert\\\">Sorry that isnt right. Try again.</div>\\n  </div>\\n</main>\"","import {\n  Dispatcher,\n  ErrorCode,\n  FRAuth,\n  FRLoginFailure,\n  FRStep,\n  StepType,\n} from '@forgerock/javascript-sdk';\nimport { ConfigOptions } from 'index';\nimport basicStepHandlerFactory from './basic';\nimport { TARGET_ID } from './constants';\nimport { FREventType } from './enums';\nimport { FREndStep, FRUIOptions, FRUIStepHandler } from './interfaces';\n\n/**\n * Orchestrates the flow through an authentication tree using `FRAuth`, generating\n * a handler for each step using the default or provided handler factory.\n *\n * Example:\n *\n * ```js\n * const ui = new forgerock.FRUI();\n * const result = await ui.getSession();\n * ```\n */\nclass FRUI extends Dispatcher {\n  private el: HTMLElement;\n  private options: FRUIOptions = {\n    handlerFactory: basicStepHandlerFactory,\n    targetId: TARGET_ID,\n  };\n  private handler: FRUIStepHandler | undefined;\n  private successfulStages: FRStep[] = [];\n\n  constructor(options: FRUIOptions) {\n    super();\n\n    Object.assign(this.options, options);\n\n    // Ensure we have a handler factory\n    if (typeof this.options.handlerFactory !== 'function') {\n      throw new Error('No step handler factory is specified');\n    }\n\n    // Ensure we have a valid target\n    const targetId = this.options.targetId || TARGET_ID;\n    const el = document.getElementById(targetId);\n    if (el === null) {\n      throw new Error(`No element with id \"${targetId}\" found`);\n    }\n    this.el = el;\n  }\n\n  /**\n   * Completes an authentication tree and returns the success or failure response.\n   *\n   * @param options Default configuration overrides\n   */\n  public getSession = async (options?: ConfigOptions): Promise<FREndStep> => {\n    this.successfulStages = [];\n    return this.nextStep(undefined, options);\n  };\n\n  /**\n   * Reserved for future use.  Returns the current instance of FRUI for chaining.\n   */\n  public clearState = (): FRUI => {\n    return this;\n  };\n\n  private async nextStep(previousStep?: FRStep, options?: ConfigOptions): Promise<FREndStep> {\n    try {\n      let thisStep = await FRAuth.next(previousStep, options);\n\n      this.dispatchEvent({ step: thisStep, type: FREventType.StepChange });\n\n      switch (thisStep.type) {\n        case StepType.LoginSuccess:\n          // Login successful\n          return thisStep;\n\n        case StepType.LoginFailure:\n          // If the first step timed out, get a new authId and resubmit\n          if (previousStep && this.firstStepTimedOut(thisStep)) {\n            previousStep.payload.authId = await this.getNewFirstAuthId();\n            return this.nextStep(previousStep);\n          }\n\n          // If the handler supports retry, give it a shot\n          if (this.handler && this.handler.retry) {\n            previousStep = await this.handler.retry();\n            return this.nextStep(previousStep);\n          }\n\n          // Login failed\n          return thisStep;\n\n        default:\n          if (previousStep) {\n            this.successfulStages.push(previousStep);\n          }\n\n          // Get a handler for this step and use it to complete the step\n          if (!this.options.handlerFactory) {\n            throw new Error('No handler factory is configured');\n          }\n          this.handler = this.options.handlerFactory(this.el, thisStep);\n          if (!this.handler) {\n            throw new Error('Handler factory failed to produce a handler');\n          }\n          thisStep = await this.handler.completeStep();\n\n          // Keep going to the next step\n          return this.nextStep(thisStep);\n      }\n    } catch (error) {\n      this.dispatchEvent({ step: previousStep, type: FREventType.StepError, error });\n      const failure = new FRLoginFailure({\n        code: 0,\n        detail: undefined,\n        message: error.message || 'Unknown',\n        reason: 'Unknown',\n      });\n      return failure;\n    }\n  }\n\n  private firstStepTimedOut = (step: FRLoginFailure): boolean => {\n    const isFirstStep = this.successfulStages.length === 0;\n    const isTimeoutError = step.getReason() === ErrorCode.Timeout;\n    return isFirstStep && isTimeoutError;\n  };\n\n  private getNewFirstAuthId = async (): Promise<string | undefined> => {\n    const firstStep = await FRAuth.next();\n    return firstStep.payload.authId;\n  };\n}\n\nexport default FRUI;\nexport { FRUIOptions };\n","/** @hidden */\nconst TARGET_ID = 'fr-ui';\n\nexport { TARGET_ID };\n","/**\n * The types of events raised during authentication.\n */\nenum FREventType {\n  StepChange = 'step_change',\n  StepError = 'step_error',\n}\n\nexport { FREventType };\n"],"sourceRoot":""}